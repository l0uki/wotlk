{"version":3,"file":"index-85d39163.entry.js","sources":["../../../ui/core/components/raid_target_picker.ts","../../../ui/raid/presets.ts","../../../ui/raid/buff_bot.ts","../../../ui/raid/assignments_picker.ts","../../../ui/raid/blessings_picker.ts","../../../ui/raid/import_export.ts","../../../ui/raid/raid_picker.ts","../../../ui/raid/tanks_picker.ts","../../../ui/raid/raid_sim_ui.ts","../../../ui/raid/index.ts"],"sourcesContent":["import { Component } from '../components/component.js';\nimport { Input, InputConfig } from '../components/input.js';\nimport { Player } from '../player.js';\nimport { Raid } from '../raid.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { RaidTarget } from '../proto/common.js';\nimport { Spec } from '../proto/common.js';\nimport { newRaidTarget, emptyRaidTarget } from '../proto_utils/utils.js';\n\ndeclare var tippy: any;\n\nexport interface RaidTargetPickerConfig<ModObject> extends InputConfig<ModObject, RaidTarget> {\n\tnoTargetLabel: string,\n\tcompChangeEmitter: TypedEvent<void>,\n}\n\nexport interface RaidTargetElemOption {\n\ticonUrl: string,\n\ttext: string,\n\tcolor: string,\n\tisDropdown: boolean,\n};\n\nexport interface RaidTargetOption extends RaidTargetElemOption {\n\tvalue: Player<any> | null,\n};\n\n// Dropdown menu for selecting a player.\nexport class RaidTargetPicker<ModObject> extends Input<ModObject, RaidTarget> {\n\tprivate readonly config: RaidTargetPickerConfig<ModObject>;\n\tprivate readonly raid: Raid;\n\tprivate readonly noTargetOption: RaidTargetOption;\n\n\tprivate curPlayer: Player<any> | null;\n\tprivate curRaidTarget: RaidTarget;\n\n\tprivate currentOptions: Array<RaidTargetOption>;\n\n\tprivate readonly buttonElem: HTMLElement;\n\tprivate readonly dropdownElem: HTMLElement;\n\n\tconstructor(parent: HTMLElement, raid: Raid, modObj: ModObject, config: RaidTargetPickerConfig<ModObject>) {\n\t\tsuper(parent, 'raid-target-picker-root', modObj, config);\n\t\tthis.rootElem.classList.add('dropdown-root');\n\t\tthis.config = config;\n\t\tthis.raid = raid;\n\t\tthis.curPlayer = this.raid.getPlayerFromRaidTarget(config.getValue(modObj));\n\t\tthis.curRaidTarget = this.getInputValue();\n\n\t\tthis.noTargetOption = {\n\t\t\ticonUrl: '',\n\t\t\ttext: config.noTargetLabel,\n\t\t\tcolor: 'black',\n\t\t\tvalue: null,\n\t\t\tisDropdown: true,\n\t\t};\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"dropdown-button raid-target-picker-button\"></div>\n\t\t\t<div class=\"dropdown-panel raid-target-picker-dropdown\"></div>\n    `;\n\n\t\tthis.buttonElem = this.rootElem.getElementsByClassName('raid-target-picker-button')[0] as HTMLElement;\n\t\tthis.dropdownElem = this.rootElem.getElementsByClassName('raid-target-picker-dropdown')[0] as HTMLElement;\n\n\t\tthis.buttonElem.addEventListener('click', event => {\n\t\t\tevent.preventDefault();\n\t\t});\n\n\t\tthis.currentOptions = [];\n\t\tthis.updateOptions(TypedEvent.nextEventID());\n\t\tconfig.compChangeEmitter.on(eventID => {\n\t\t\tthis.updateOptions(eventID);\n\t\t});\n\n\t\tthis.init();\n\t}\n\n\tprivate makeTargetOptions(): Array<RaidTargetOption> {\n\t\tconst playerOptions = this.raid.getPlayers().filter(player => player != null).map(player => {\n\t\t\treturn {\n\t\t\t\ticonUrl: player!.getTalentTreeIcon(),\n\t\t\t\ttext: player!.getLabel(),\n\t\t\t\tcolor: player!.getClassColor(),\n\t\t\t\tisDropdown: true,\n\t\t\t\tvalue: player,\n\t\t\t};\n\t\t});\n\t\treturn [this.noTargetOption].concat(playerOptions);\n\t}\n\n\tprivate updateOptions(eventID: EventID) {\n\t\tthis.currentOptions = this.makeTargetOptions();\n\n\t\tthis.dropdownElem.innerHTML = '';\n\t\tthis.currentOptions.forEach(option => this.dropdownElem.appendChild(this.makeOption(option)));\n\n\t\tconst prevRaidTarget = this.curRaidTarget;\n\t\tthis.curRaidTarget = this.getInputValue();\n\t\tif (!RaidTarget.equals(prevRaidTarget, this.curRaidTarget)) {\n\t\t\tthis.inputChanged(eventID);\n\t\t} else {\n\t\t\tthis.setInputValue(this.curRaidTarget);\n\t\t}\n\t}\n\n\tprivate makeOption(data: RaidTargetOption): HTMLElement {\n\t\tconst option = RaidTargetPicker.makeOptionElem(data);\n\n\t\toption.addEventListener('click', event => {\n\t\t\tevent.preventDefault();\n\t\t\tthis.curPlayer = data.value;\n\t\t\tthis.curRaidTarget = this.getInputValue();\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t});\n\n\t\treturn option;\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.buttonElem;\n\t}\n\n\tgetInputValue(): RaidTarget {\n\t\tif (this.curPlayer) {\n\t\t\treturn this.curPlayer.makeRaidTarget();\n\t\t} else {\n\t\t\treturn emptyRaidTarget();\n\t\t}\n\t}\n\n\tsetInputValue(newValue: RaidTarget) {\n\t\tthis.curRaidTarget = RaidTarget.clone(newValue);\n\t\tthis.curPlayer = this.raid.getPlayerFromRaidTarget(this.curRaidTarget);\n\n\t\tconst optionData = this.currentOptions.find(optionData => optionData.value == this.curPlayer);\n\t\tif (!optionData) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buttonElem.innerHTML = '';\n\t\tthis.buttonElem.appendChild(RaidTargetPicker.makeOptionElem(optionData));\n\t}\n\n\tstatic makeOptionElem(data: RaidTargetElemOption): HTMLElement {\n\t\tconst optionContainer = document.createElement('div');\n\t\toptionContainer.classList.add('dropdown-option-container');\n\n\t\tconst option = document.createElement('div');\n\t\toption.classList.add('raid-target-picker-option');\n\t\toptionContainer.appendChild(option);\n\t\tif (data.isDropdown) {\n\t\t\toption.classList.add('dropdown-option');\n\t\t}\n\n\t\tif (data.color) {\n\t\t\toption.style.backgroundColor = data.color;\n\t\t}\n\n\t\tif (data.iconUrl) {\n\t\t\tconst icon = document.createElement('img');\n\t\t\ticon.src = data.iconUrl;\n\t\t\ticon.classList.add('raid-target-picker-icon');\n\t\t\toption.appendChild(icon);\n\t\t}\n\n\t\tif (data.text) {\n\t\t\tconst label = document.createElement('span');\n\t\t\tlabel.textContent = data.text;\n\t\t\tlabel.classList.add('raid-target-picker-label');\n\t\t\toption.appendChild(label);\n\t\t}\n\n\t\treturn optionContainer;\n\t}\n}\n","import { IndividualSimUI, OtherDefaults } from '../core/individual_sim_ui.js';\nimport { Raid as RaidProto } from '../core/proto/api.js';\nimport { Party as PartyProto } from '../core/proto/api.js';\nimport { Class } from '../core/proto/common.js';\nimport { Consumes } from '../core/proto/common.js';\n\nimport { Encounter as EncounterProto } from '../core/proto/common.js';\nimport { EquipmentSpec } from '../core/proto/common.js';\nimport { Race } from '../core/proto/common.js';\nimport { Spec } from '../core/proto/common.js';\nimport { TristateEffect } from '../core/proto/common.js';\nimport { Faction } from '../core/proto/common.js';\nimport { SavedTalents } from '../core/proto/ui.js';\nimport { SpecOptions } from '../core/proto_utils/utils.js';\nimport { SpecRotation } from '../core/proto_utils/utils.js';\nimport { playerToSpec } from '../core/proto_utils/utils.js';\nimport { specIconsLarge } from '../core/proto_utils/utils.js';\nimport { specNames } from '../core/proto_utils/utils.js';\nimport { talentTreeIcons } from '../core/proto_utils/utils.js';\nimport { NO_TARGET } from '../core/proto_utils/utils.js';\nimport { Player } from '../core/player.js';\n\nimport { BuffBot } from './buff_bot.js';\n\nimport * as DeathknightPresets from '../deathknight/presets.js';\nimport * as BalanceDruidPresets from '../balance_druid/presets.js';\nimport * as FeralDruidPresets from '../feral_druid/presets.js';\nimport * as FeralTankDruidPresets from '../feral_tank_druid/presets.js';\nimport * as ElementalShamanPresets from '../elemental_shaman/presets.js';\nimport * as EnhancementShamanPresets from '../enhancement_shaman/presets.js';\nimport * as HunterPresets from '../hunter/presets.js';\nimport * as MagePresets from '../mage/presets.js';\nimport * as RoguePresets from '../rogue/presets.js';\nimport * as RetributionPaladinPresets from '../retribution_paladin/presets.js';\nimport * as ProtectionPaladinPresets from '../protection_paladin/presets.js';\nimport * as ShadowPriestPresets from '../shadow_priest/presets.js';\nimport * as SmitePriestPresets from '../smite_priest/presets.js';\nimport * as WarriorPresets from '../warrior/presets.js';\nimport * as ProtectionWarriorPresets from '../protection_warrior/presets.js';\nimport * as WarlockPresets from '../warlock/presets.js';\n\n\nimport { BalanceDruidSimUI } from '../balance_druid/sim.js';\nimport { FeralDruidSimUI } from '../feral_druid/sim.js';\nimport { FeralTankDruidSimUI } from '../feral_tank_druid/sim.js';\nimport { EnhancementShamanSimUI } from '../enhancement_shaman/sim.js';\nimport { ElementalShamanSimUI } from '../elemental_shaman/sim.js';\nimport { HunterSimUI } from '../hunter/sim.js';\nimport { MageSimUI } from '../mage/sim.js';\nimport { RogueSimUI } from '../rogue/sim.js';\nimport { RetributionPaladinSimUI } from '../retribution_paladin/sim.js';\nimport { ProtectionPaladinSimUI } from '../protection_paladin/sim.js';\nimport { ShadowPriestSimUI } from '../shadow_priest/sim.js';\nimport { SmitePriestSimUI } from '../smite_priest/sim.js';\nimport { WarriorSimUI } from '../warrior/sim.js';\nimport { ProtectionWarriorSimUI } from '../protection_warrior/sim.js';\nimport { WarlockSimUI } from '../warlock/sim.js';\nimport { DeathknightSimUI } from '../deathknight/sim.js';\n\nexport const specSimFactories: Partial<Record<Spec, (parentElem: HTMLElement, player: Player<any>) => IndividualSimUI<any>>> = {\n    [Spec.SpecDeathknight]: (parentElem: HTMLElement, player: Player<any>) => new DeathknightSimUI(parentElem, player),\n\t[Spec.SpecBalanceDruid]: (parentElem: HTMLElement, player: Player<any>) => new BalanceDruidSimUI(parentElem, player),\n    [Spec.SpecFeralDruid]: (parentElem: HTMLElement, player: Player<any>) => new FeralDruidSimUI(parentElem, player),\n    [Spec.SpecFeralTankDruid]: (parentElem: HTMLElement, player: Player<any>) => new FeralTankDruidSimUI(parentElem, player),\n    [Spec.SpecElementalShaman]: (parentElem: HTMLElement, player: Player<any>) => new ElementalShamanSimUI(parentElem, player),\n    [Spec.SpecEnhancementShaman]: (parentElem: HTMLElement, player: Player<any>) => new EnhancementShamanSimUI(parentElem, player),\n    [Spec.SpecHunter]: (parentElem: HTMLElement, player: Player<any>) => new HunterSimUI(parentElem, player),\n    [Spec.SpecMage]: (parentElem: HTMLElement, player: Player<any>) => new MageSimUI(parentElem, player),\n    [Spec.SpecRogue]: (parentElem: HTMLElement, player: Player<any>) => new RogueSimUI(parentElem, player),\n    [Spec.SpecRetributionPaladin]: (parentElem: HTMLElement, player: Player<any>) => new RetributionPaladinSimUI(parentElem, player),\n    [Spec.SpecProtectionPaladin]: (parentElem: HTMLElement, player: Player<any>) => new ProtectionPaladinSimUI(parentElem, player),\n    [Spec.SpecShadowPriest]: (parentElem: HTMLElement, player: Player<any>) => new ShadowPriestSimUI(parentElem, player),\n    [Spec.SpecSmitePriest]: (parentElem: HTMLElement, player: Player<any>) => new SmitePriestSimUI(parentElem, player),\n    [Spec.SpecWarrior]: (parentElem: HTMLElement, player: Player<any>) => new WarriorSimUI(parentElem, player),\n    [Spec.SpecProtectionWarrior]: (parentElem: HTMLElement, player: Player<any>) => new ProtectionWarriorSimUI(parentElem, player),\n    [Spec.SpecWarlock]: (parentElem: HTMLElement, player: Player<any>) => new WarlockSimUI(parentElem, player),\n};\n\n// Configuration necessary for creating new players.\nexport interface PresetSpecSettings<SpecType extends Spec> {\n    spec: Spec,\n    rotation: SpecRotation<SpecType>,\n    talents: SavedTalents,\n    specOptions: SpecOptions<SpecType>,\n    consumes: Consumes,\n\n    defaultName: string,\n    defaultFactionRaces: Record<Faction, Race>,\n    defaultGear: Record<Faction, Record<number, EquipmentSpec>>,\n\t\totherDefaults?: OtherDefaults,\n\n    tooltip: string,\n    iconUrl: string,\n}\n\n// Configuration necessary for creating new BuffBots.\nexport interface BuffBotSettings {\n    // The value of this field must never change, to preserve local storage data.\n    buffBotId: string,\n\n    // Set this to true to remove a buff bot option after launching a real sim.\n    // This will allow users with saved settings to properly load the buffbot but\n    // also remove the buffbot as an option from the UI.\n    deprecated?: boolean,\n\n    spec: Spec,\n    name: string,\n    tooltip: string,\n    iconUrl: string,\n\n    // Callback to apply buffs from this buff bot.\n    modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => void,\n}\n\nexport const playerPresets: Array<PresetSpecSettings<any>> = [\n\t{\n\t\tspec: Spec.SpecDeathknight,\n\t\trotation: DeathknightPresets.DefaultFrostRotation,\n\t\ttalents: DeathknightPresets.FrostTalents.data,\n\t\tspecOptions: DeathknightPresets.DefaultFrostOptions,\n\t\tconsumes: DeathknightPresets.DefaultConsumes,\n\t\tdefaultName: 'Frost DK',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceTroll,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: DeathknightPresets.P1_FROST_BIS_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: DeathknightPresets.P1_FROST_BIS_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\totherDefaults: DeathknightPresets.OtherDefaults,\n\t\ttooltip: 'Frost Death Knight',\n\t\ticonUrl: talentTreeIcons[Class.ClassDeathknight][1],\n\t},\n\t{\n\t\tspec: Spec.SpecDeathknight,\n\t\trotation: DeathknightPresets.DefaultUnholyRotation,\n\t\ttalents: DeathknightPresets.UnholyDualWieldTalents.data,\n\t\tspecOptions: DeathknightPresets.DefaultUnholyOptions,\n\t\tconsumes: DeathknightPresets.DefaultConsumes,\n\t\tdefaultName: 'DW Unholy DK',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceTroll,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: DeathknightPresets.P1_UNHOLY_DW_BIS_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: DeathknightPresets.P1_UNHOLY_DW_BIS_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\totherDefaults: DeathknightPresets.OtherDefaults,\n\t\ttooltip: 'Dual Wield Unholy DK',\n\t\ticonUrl: talentTreeIcons[Class.ClassDeathknight][2],\n\t},\n\t{\n\t\tspec: Spec.SpecDeathknight,\n\t\trotation: DeathknightPresets.DefaultBloodRotation,\n\t\ttalents: DeathknightPresets.BloodTalents.data,\n\t\tspecOptions: DeathknightPresets.DefaultBloodOptions,\n\t\tconsumes: DeathknightPresets.DefaultConsumes,\n\t\tdefaultName: 'Blood Dps DK',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceTroll,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: DeathknightPresets.P1_BLOOD_BIS_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: DeathknightPresets.P1_BLOOD_BIS_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\totherDefaults: DeathknightPresets.OtherDefaults,\n\t\ttooltip: 'Blood Dps DK',\n\t\ticonUrl: talentTreeIcons[Class.ClassDeathknight][0],\n\t},\n\t{\n\t\tspec: Spec.SpecBalanceDruid,\n\t\trotation: BalanceDruidPresets.DefaultRotation,\n\t\ttalents: BalanceDruidPresets.StandardTalents.data,\n\t\tspecOptions: BalanceDruidPresets.DefaultOptions,\n\t\tconsumes: BalanceDruidPresets.DefaultConsumes,\n\t\tdefaultName: 'Balance Druid',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceNightElf,\n\t\t\t[Faction.Horde]: Race.RaceTauren,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: BalanceDruidPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: BalanceDruidPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: specNames[Spec.SpecBalanceDruid],\n\t\ticonUrl: specIconsLarge[Spec.SpecBalanceDruid],\n\t},\n\t{\n\t\tspec: Spec.SpecFeralDruid,\n\t\trotation: FeralDruidPresets.DefaultRotation,\n\t\ttalents: FeralDruidPresets.StandardTalents.data,\n\t\tspecOptions: FeralDruidPresets.DefaultOptions,\n\t\tconsumes: FeralDruidPresets.DefaultConsumes,\n\t\tdefaultName: 'Cat Druid',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceNightElf,\n\t\t\t[Faction.Horde]: Race.RaceTauren,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: FeralDruidPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: FeralDruidPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: specNames[Spec.SpecFeralDruid],\n\t\ticonUrl: specIconsLarge[Spec.SpecFeralDruid],\n\t},\n\t{\n\t\tspec: Spec.SpecFeralTankDruid,\n\t\trotation: FeralTankDruidPresets.DefaultRotation,\n\t\ttalents: FeralTankDruidPresets.StandardTalents.data,\n\t\tspecOptions: FeralTankDruidPresets.DefaultOptions,\n\t\tconsumes: FeralTankDruidPresets.DefaultConsumes,\n\t\tdefaultName: 'Bear Druid',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceNightElf,\n\t\t\t[Faction.Horde]: Race.RaceTauren,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: FeralTankDruidPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: FeralTankDruidPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: specNames[Spec.SpecFeralTankDruid],\n\t\ticonUrl: specIconsLarge[Spec.SpecFeralTankDruid],\n\t},\n\t{\n\t\tspec: Spec.SpecHunter,\n\t\trotation: HunterPresets.DefaultRotation,\n\t\ttalents: HunterPresets.BeastMasteryTalents.data,\n\t\tspecOptions: HunterPresets.BMDefaultOptions,\n\t\tconsumes: HunterPresets.DefaultConsumes,\n\t\tdefaultName: 'BM Hunter',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceNightElf,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: HunterPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: HunterPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'BM Hunter',\n\t\ticonUrl: talentTreeIcons[Class.ClassHunter][0],\n\t},\n\t{\n\t\tspec: Spec.SpecHunter,\n\t\trotation: HunterPresets.DefaultRotation,\n\t\ttalents: HunterPresets.MarksmanTalents.data,\n\t\tspecOptions: HunterPresets.DefaultOptions,\n\t\tconsumes: HunterPresets.DefaultConsumes,\n\t\tdefaultName: 'MM Hunter',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceNightElf,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: HunterPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: HunterPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'MM Hunter',\n\t\ticonUrl: talentTreeIcons[Class.ClassHunter][1],\n\t},\n\t{\n\t\tspec: Spec.SpecHunter,\n\t\trotation: HunterPresets.DefaultRotation,\n\t\ttalents: HunterPresets.SurvivalTalents.data,\n\t\tspecOptions: HunterPresets.DefaultOptions,\n\t\tconsumes: HunterPresets.DefaultConsumes,\n\t\tdefaultName: 'SV Hunter',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceNightElf,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: HunterPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: HunterPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'SV Hunter',\n\t\ticonUrl: talentTreeIcons[Class.ClassHunter][2],\n\t},\n\t{\n\t\tspec: Spec.SpecMage,\n\t\trotation: MagePresets.DefaultArcaneRotation,\n\t\ttalents: MagePresets.ArcaneTalents.data,\n\t\tspecOptions: MagePresets.DefaultArcaneOptions,\n\t\tconsumes: MagePresets.DefaultArcaneConsumes,\n\t\tdefaultName: 'Arcane Mage',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceGnome,\n\t\t\t[Faction.Horde]: Race.RaceTroll,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: MagePresets.P1_ARCANE_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: MagePresets.P1_ARCANE_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Arcane Mage',\n\t\ticonUrl: talentTreeIcons[Class.ClassMage][0],\n\t},\n\t{\n\t\tspec: Spec.SpecMage,\n\t\trotation: MagePresets.DefaultFireRotation,\n\t\ttalents: MagePresets.FireTalents.data,\n\t\tspecOptions: MagePresets.DefaultFireOptions,\n\t\tconsumes: MagePresets.DefaultFireConsumes,\n\t\tdefaultName: 'Fire Mage',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceGnome,\n\t\t\t[Faction.Horde]: Race.RaceTroll,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: MagePresets.P1_FIRE_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: MagePresets.P1_FIRE_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Fire Mage',\n\t\ticonUrl: talentTreeIcons[Class.ClassMage][1],\n\t},\n\t{\n\t\tspec: Spec.SpecMage,\n\t\trotation: MagePresets.DefaultFrostRotation,\n\t\ttalents: MagePresets.FrostTalents.data,\n\t\tspecOptions: MagePresets.DefaultFrostOptions,\n\t\tconsumes: MagePresets.DefaultFrostConsumes,\n\t\tdefaultName: 'Frost Mage',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceGnome,\n\t\t\t[Faction.Horde]: Race.RaceTroll,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: MagePresets.P1_FROST_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: MagePresets.P1_FROST_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Frost Mage',\n\t\ticonUrl: talentTreeIcons[Class.ClassMage][2],\n\t},\n\t{\n\t\tspec: Spec.SpecRogue,\n\t\trotation: RoguePresets.DefaultRotation,\n\t\ttalents: RoguePresets.CombatTalents.data,\n\t\tspecOptions: RoguePresets.DefaultOptions,\n\t\tconsumes: RoguePresets.DefaultConsumes,\n\t\tdefaultName: 'Combat Rogue',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: RoguePresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: RoguePresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Combat Rogue',\n\t\ticonUrl: specIconsLarge[Spec.SpecRogue],\n\t},\n\t{\n\t\tspec: Spec.SpecElementalShaman,\n\t\trotation: ElementalShamanPresets.DefaultRotation,\n\t\ttalents: ElementalShamanPresets.StandardTalents.data,\n\t\tspecOptions: ElementalShamanPresets.DefaultOptions,\n\t\tconsumes: ElementalShamanPresets.DefaultConsumes,\n\t\tdefaultName: 'Ele Shaman',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceDraenei,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: ElementalShamanPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: ElementalShamanPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: specNames[Spec.SpecElementalShaman],\n\t\ticonUrl: specIconsLarge[Spec.SpecElementalShaman],\n\t},\n\t{\n\t\tspec: Spec.SpecEnhancementShaman,\n\t\trotation: EnhancementShamanPresets.DefaultRotation,\n\t\ttalents: EnhancementShamanPresets.StandardTalents.data,\n\t\tspecOptions: EnhancementShamanPresets.DefaultOptions,\n\t\tconsumes: EnhancementShamanPresets.DefaultConsumes,\n\t\tdefaultName: 'Enh Shaman',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceDraenei,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: EnhancementShamanPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: EnhancementShamanPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: specNames[Spec.SpecEnhancementShaman],\n\t\ticonUrl: specIconsLarge[Spec.SpecEnhancementShaman],\n\t},\n\t{\n\t\tspec: Spec.SpecShadowPriest,\n\t\trotation: ShadowPriestPresets.DefaultRotation,\n\t\ttalents: ShadowPriestPresets.StandardTalents.data,\n\t\tspecOptions: ShadowPriestPresets.DefaultOptions,\n\t\tconsumes: ShadowPriestPresets.DefaultConsumes,\n\t\tdefaultName: 'Shadow Priest',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceDwarf,\n\t\t\t[Faction.Horde]: Race.RaceUndead,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: ShadowPriestPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: ShadowPriestPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: specNames[Spec.SpecShadowPriest],\n\t\ticonUrl: specIconsLarge[Spec.SpecShadowPriest],\n\t},\n\t{\n\t\tspec: Spec.SpecSmitePriest,\n\t\trotation: SmitePriestPresets.DefaultRotation,\n\t\ttalents: SmitePriestPresets.StandardTalents.data,\n\t\tspecOptions: SmitePriestPresets.DefaultOptions,\n\t\tconsumes: SmitePriestPresets.DefaultConsumes,\n\t\tdefaultName: 'Smite Priest',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceDwarf,\n\t\t\t[Faction.Horde]: Race.RaceUndead,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: SmitePriestPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: SmitePriestPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: specNames[Spec.SpecSmitePriest],\n\t\ticonUrl: specIconsLarge[Spec.SpecSmitePriest],\n\t},\n\t{\n\t\tspec: Spec.SpecWarrior,\n\t\trotation: WarriorPresets.ArmsRotation,\n\t\ttalents: WarriorPresets.ArmsTalents.data,\n\t\tspecOptions: WarriorPresets.DefaultOptions,\n\t\tconsumes: WarriorPresets.DefaultConsumes,\n\t\tdefaultName: 'Arms Warrior',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: WarriorPresets.P1_ARMS_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: WarriorPresets.P1_ARMS_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Arms Warrior',\n\t\ticonUrl: talentTreeIcons[Class.ClassWarrior][0],\n\t},\n\t{\n\t\tspec: Spec.SpecWarrior,\n\t\trotation: WarriorPresets.DefaultRotation,\n\t\ttalents: WarriorPresets.FuryTalents.data,\n\t\tspecOptions: WarriorPresets.DefaultOptions,\n\t\tconsumes: WarriorPresets.DefaultConsumes,\n\t\tdefaultName: 'Fury Warrior',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: WarriorPresets.P1_FURY_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: WarriorPresets.P1_FURY_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Fury Warrior',\n\t\ticonUrl: talentTreeIcons[Class.ClassWarrior][1],\n\t},\n\t{\n\t\tspec: Spec.SpecProtectionWarrior,\n\t\trotation: ProtectionWarriorPresets.DefaultRotation,\n\t\ttalents: ProtectionWarriorPresets.StandardTalents.data,\n\t\tspecOptions: ProtectionWarriorPresets.DefaultOptions,\n\t\tconsumes: ProtectionWarriorPresets.DefaultConsumes,\n\t\tdefaultName: 'Prot Warrior',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: ProtectionWarriorPresets.P1_BALANCED_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: ProtectionWarriorPresets.P1_BALANCED_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Protection Warrior',\n\t\ticonUrl: talentTreeIcons[Class.ClassWarrior][2],\n\t},\n\t{\n\t\tspec: Spec.SpecRetributionPaladin,\n\t\trotation: RetributionPaladinPresets.DefaultRotation,\n\t\ttalents: RetributionPaladinPresets.AuraMasteryTalents.data,\n\t\tspecOptions: RetributionPaladinPresets.DefaultOptions,\n\t\tconsumes: RetributionPaladinPresets.DefaultConsumes,\n\t\tdefaultName: 'Ret Paladin',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceBloodElf,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: RetributionPaladinPresets.P1_PRESET.gear,\n\t\t\t\t2: RetributionPaladinPresets.P2_PRESET.gear,\n\t\t\t\t3: RetributionPaladinPresets.P3_PRESET.gear,\n\t\t\t\t4: RetributionPaladinPresets.P4_PRESET.gear,\n\t\t\t\t5: RetributionPaladinPresets.P5_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: RetributionPaladinPresets.P1_PRESET.gear,\n\t\t\t\t2: RetributionPaladinPresets.P2_PRESET.gear,\n\t\t\t\t3: RetributionPaladinPresets.P3_PRESET.gear,\n\t\t\t\t4: RetributionPaladinPresets.P4_PRESET.gear,\n\t\t\t\t5: RetributionPaladinPresets.P5_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Ret Paladin',\n\t\ticonUrl: talentTreeIcons[Class.ClassPaladin][2],\n\t},\n\t{\n\t\tspec: Spec.SpecProtectionPaladin,\n\t\trotation: ProtectionPaladinPresets.DefaultRotation,\n\t\ttalents: ProtectionPaladinPresets.GenericAoeTalents.data,\n\t\tspecOptions: ProtectionPaladinPresets.DefaultOptions,\n\t\tconsumes: ProtectionPaladinPresets.DefaultConsumes,\n\t\tdefaultName: 'Prot Paladin',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceBloodElf,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: ProtectionPaladinPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: ProtectionPaladinPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Protection Paladin',\n\t\ticonUrl: talentTreeIcons[Class.ClassPaladin][1],\n\t},\n\t{\n\t\tspec: Spec.SpecWarlock,\n\t\trotation: WarlockPresets.DestructionRotation,\n\t\ttalents: WarlockPresets.DestructionTalents.data,\n\t\tspecOptions: WarlockPresets.DestructionOptions,\n\t\tconsumes: WarlockPresets.DefaultConsumes,\n\t\tdefaultName: 'Destro Warlock',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {\n\t\t\t\t1: WarlockPresets.P1_Preset_Demo_Destro.gear,\n\t\t\t\t2: WarlockPresets.P1_PreBiS_14.gear,\n\t\t\t},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: WarlockPresets.P1_Preset_Demo_Destro.gear,\n\t\t\t\t2: WarlockPresets.P1_PreBiS_14.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: WarlockPresets.P1_Preset_Demo_Destro.gear,\n\t\t\t\t2: WarlockPresets.P1_PreBiS_14.gear,\n\t\t\t},\n\t\t},\n\t\totherDefaults: WarlockPresets.OtherDefaults,\n\t\ttooltip: 'Destruction Warlock: Adds Improved Soul Leech and Blood Pact',\n\t\ticonUrl: talentTreeIcons[Class.ClassWarlock][2],\n\t},\n\t{\n\t\tspec: Spec.SpecWarlock,\n\t\trotation: WarlockPresets.AfflictionRotation,\n\t\ttalents: WarlockPresets.AfflictionTalents.data,\n\t\tspecOptions: WarlockPresets.AfflictionOptions,\n\t\tconsumes: WarlockPresets.DefaultConsumes,\n\t\tdefaultName: 'Affli Warlock',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {\n\t\t\t\t1: WarlockPresets.P1_Preset_Affliction.gear,\n\t\t\t\t2: WarlockPresets.P1_PreBiS_11.gear,\n\t\t\t},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: WarlockPresets.P1_Preset_Affliction.gear,\n\t\t\t\t2: WarlockPresets.P1_PreBiS_11.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: WarlockPresets.P1_Preset_Affliction.gear,\n\t\t\t\t2: WarlockPresets.P1_PreBiS_11.gear,\n\t\t\t},\n\t\t},\n\t\totherDefaults: WarlockPresets.OtherDefaults,\n\t\ttooltip: 'Affliction Warlock: Adds Improved Fel Intelligence',\n\t\ticonUrl: talentTreeIcons[Class.ClassWarlock][0],\n\t},\n\t{\n\t\tspec: Spec.SpecWarlock,\n\t\trotation: WarlockPresets.DemonologyRotation,\n\t\ttalents: WarlockPresets.DemonologyTalents.data,\n\t\tspecOptions: WarlockPresets.DemonologyOptions,\n\t\tconsumes: WarlockPresets.DefaultConsumes,\n\t\tdefaultName: 'Demo Warlock',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {\n\t\t\t\t1: WarlockPresets.P1_Preset_Demo_Destro.gear,\n\t\t\t\t2: WarlockPresets.P1_PreBiS_14.gear,\n\t\t\t},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: WarlockPresets.P1_Preset_Demo_Destro.gear,\n\t\t\t\t2: WarlockPresets.P1_PreBiS_14.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: WarlockPresets.P1_Preset_Demo_Destro.gear,\n\t\t\t\t2: WarlockPresets.P1_PreBiS_14.gear,\n\t\t\t},\n\t\t},\n\t\totherDefaults: WarlockPresets.OtherDefaults,\n\t\ttooltip: 'Demonology Warlock: Adds Demonic Pact',\n\t\ticonUrl: talentTreeIcons[Class.ClassWarlock][1],\n\t},\n];\n\nexport const implementedSpecs: Array<Spec> = [...new Set(playerPresets.map(preset => preset.spec))];\n\nexport const buffBotPresets: Array<BuffBotSettings> = [\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Bear',\n        deprecated: true,\n        spec: Spec.SpecBalanceDruid,\n        name: 'Bear',\n        tooltip: 'Bear: Adds Gift of the Wild, an Innervate, Faerie Fire, and Leader of the Pack.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_racial_bearform.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.giftOfTheWild = Math.max(raidProto.buffs!.giftOfTheWild, TristateEffect.TristateEffectRegular);\n            raidProto.buffs!.thorns = Math.max(raidProto.buffs!.thorns, TristateEffect.TristateEffectRegular);\n            raidProto.debuffs!.faerieFire = Math.max(raidProto.debuffs!.faerieFire, TristateEffect.TristateEffectRegular);\n            raidProto.buffs!.leaderOfThePack = Math.max(raidProto.buffs!.leaderOfThePack, TristateEffect.TristateEffectRegular);\n\n            const innervateIndex = buffBot.getInnervateAssignment().targetIndex;\n            if (innervateIndex != NO_TARGET) {\n                const partyIndex = Math.floor(innervateIndex / 5);\n                const playerIndex = innervateIndex % 5;\n                const playerProto = raidProto.parties[partyIndex].players[playerIndex];\n                if (playerProto.buffs) {\n                    playerProto.buffs.innervates++;\n                }\n            }\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Resto Druid',\n        spec: Spec.SpecBalanceDruid,\n        name: 'Resto Druid',\n        tooltip: 'Resto Druid: Adds Improved Gift of the Wild, and an Innervate.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingtouch.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.giftOfTheWild = TristateEffect.TristateEffectImproved;\n            raidProto.buffs!.thorns = Math.max(raidProto.buffs!.thorns, TristateEffect.TristateEffectRegular);\n\n            const innervateIndex = buffBot.getInnervateAssignment().targetIndex;\n            if (innervateIndex != NO_TARGET) {\n                const partyIndex = Math.floor(innervateIndex / 5);\n                const playerIndex = innervateIndex % 5;\n                const playerProto = raidProto.parties[partyIndex].players[playerIndex];\n                if (playerProto.buffs) {\n                    playerProto.buffs.innervates++;\n                }\n            }\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Dreamstate',\n        spec: Spec.SpecBalanceDruid,\n        name: 'Dreamstate',\n        tooltip: 'Dreamstate: Adds Improved Gift of the Wild, an Innervate, and Improved Faerie Fire.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_faeriefire.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.giftOfTheWild = TristateEffect.TristateEffectImproved;\n            raidProto.buffs!.thorns = TristateEffect.TristateEffectImproved;\n            raidProto.debuffs!.faerieFire = TristateEffect.TristateEffectImproved;\n\n            const innervateIndex = buffBot.getInnervateAssignment().targetIndex;\n            if (innervateIndex != NO_TARGET) {\n                const partyIndex = Math.floor(innervateIndex / 5);\n                const playerIndex = innervateIndex % 5;\n                const playerProto = raidProto.parties[partyIndex].players[playerIndex];\n                if (playerProto.buffs) {\n                    playerProto.buffs.innervates++;\n                }\n            }\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Mage',\n        deprecated: true,\n        spec: Spec.SpecMage,\n        name: 'Mage',\n        tooltip: 'Mage: Adds Arcane Brilliance.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_arcaneintellect.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.arcaneBrilliance = true;\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Paladin',\n        spec: Spec.SpecRetributionPaladin,\n        name: 'Holy Paladin',\n        tooltip: 'Holy Paladin: Adds a set of blessings.',\n        iconUrl: talentTreeIcons[Class.ClassPaladin][0],\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            // Do nothing, blessings are handled elswhere.\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'JoW Paladin',\n        spec: Spec.SpecRetributionPaladin,\n        name: 'JoW Paladin',\n        tooltip: 'JoW Paladin: Adds a set of blessings and Judgement of Wisdom.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_righteousnessaura.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            // Blessings are handled elswhere.\n            raidProto.debuffs!.judgementOfWisdom = true;\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Holy Priest',\n        spec: Spec.SpecShadowPriest,\n        name: 'Holy Priest',\n        tooltip: 'Holy Priest: Adds Improved PW Fortitude and Shadow Protection.',\n        iconUrl: talentTreeIcons[Class.ClassPriest][1],\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.shadowProtection = true;\n            raidProto.buffs!.powerWordFortitude = TristateEffect.TristateEffectImproved;\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Divine Spirit Priest',\n        spec: Spec.SpecShadowPriest,\n        name: 'Disc Priest',\n        tooltip: 'Disc Priest: Adds Improved PW Fort, Shadow Protection, Improved Divine Spirit and a Power Infusion.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/medium/spell_holy_powerinfusion.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.shadowProtection = true;\n            raidProto.buffs!.powerWordFortitude = TristateEffect.TristateEffectImproved;\n            raidProto.buffs!.divineSpirit = true;\n\n\t\t\tconst powerInfusionIndex = buffBot.getPowerInfusionAssignment().targetIndex;\n\t\t\tif (powerInfusionIndex != NO_TARGET) {\n\t\t\t\tconst partyIndex = Math.floor(powerInfusionIndex / 5);\n\t\t\t\tconst playerIndex = powerInfusionIndex % 5;\n\t\t\t\tconst playerProto = raidProto.parties[partyIndex].players[playerIndex];\n\t\t\t\tif (playerProto.buffs) {\n\t\t\t\t\tplayerProto.buffs.powerInfusions++;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\t{\n\t\t// The value of this field must never change, to preserve local storage data.\n\t\tbuffBotId: 'Rogue',\n\t\tspec: Spec.SpecShadowPriest,\n\t\tname: 'Rogue',\n\t\ttooltip: 'Rogue: Adds TotT.',\n\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_tricksofthetrade.jpg',\n\t\tmodifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n\t\t\tconst tricksOfTheTradeIndex = buffBot.getTricksOfTheTradeAssignment().targetIndex;\n\t\t\tif (tricksOfTheTradeIndex != NO_TARGET) {\n\t\t\t\tconst partyIndex = Math.floor(tricksOfTheTradeIndex / 5);\n\t\t\t\tconst playerIndex = tricksOfTheTradeIndex % 5;\n\t\t\t\tconst playerProto = raidProto.parties[partyIndex].players[playerIndex];\n\t\t\t\tif (playerProto.buffs) {\n\t\t\t\t\tplayerProto.buffs.tricksOfTheTrades++;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\t{\n\t\t// The value of this field must never change, to preserve local storage data.\n\t\tbuffBotId: 'Resto Shaman',\n\t\tspec: Spec.SpecElementalShaman,\n\t\tname: 'Resto Shaman',\n\t\ttooltip: 'Resto Shaman: Adds Bloodlust, Mana Spring Totem, Mana Tide Totem, Strength of Earth Totem. Chooses air totem based on party composition.',\n\t\ticonUrl: talentTreeIcons[Class.ClassShaman][2],\n\t\tmodifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n\t\t\traidProto.buffs!.bloodlust = true;\n\t\t\traidProto.buffs!.manaSpringTotem = TristateEffect.TristateEffectImproved;\n\t\t\tpartyProto.buffs!.manaTideTotems++;\n\n            // Choose which air totem to drop based on party composition.\n            const woaSpecs = [\n                Spec.SpecBalanceDruid,\n                Spec.SpecMage,\n                Spec.SpecShadowPriest,\n                Spec.SpecSmitePriest,\n                Spec.SpecEnhancementShaman,\n                Spec.SpecElementalShaman,\n                Spec.SpecWarlock,\n            ];\n            const wfSpecs = [\n                Spec.SpecRetributionPaladin,\n                Spec.SpecRogue,\n                Spec.SpecWarrior,\n                Spec.SpecProtectionWarrior,\n                Spec.SpecFeralDruid,\n                Spec.SpecFeralTankDruid,\n            ];\n            const [woaVotes, wfVotes] = [woaSpecs, wfSpecs]\n                .map(specs => partyProto.players\n                    .filter(player => player.class != Class.ClassUnknown)\n                    .map(player => playerToSpec(player))\n                    .filter(playerSpec => specs.includes(playerSpec))\n                    .length);\n\n            if (woaVotes >= wfVotes) {\n                raidProto.buffs!.wrathOfAirTotem = true;\n            } else {\n                raidProto.buffs!.windfuryTotem = TristateEffect.TristateEffectRegular;\n            }\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Arms Warrior',\n        deprecated: true,\n        spec: Spec.SpecWarrior,\n        name: 'Arms Warrior',\n        tooltip: 'Arms Warrior: Adds Sunder Armor, Blood Frenzy, and Improved Battle Shout.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/medium/ability_warrior_savageblow.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.battleShout = TristateEffect.TristateEffectImproved;\n            const debuffs = raidProto.debuffs!;\n            debuffs.sunderArmor = true;\n            debuffs.bloodFrenzy = true;\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Fury Warrior',\n        deprecated: true,\n        spec: Spec.SpecWarrior,\n        name: 'Fury Warrior',\n        tooltip: 'Fury Warrior: Adds Sunder Armor and Improved Battle Shout.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/medium/ability_warrior_innerrage.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.battleShout = TristateEffect.TristateEffectImproved;\n            const debuffs = raidProto.debuffs!;\n            debuffs.sunderArmor = true;\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Prot Warrior',\n        deprecated: true,\n        spec: Spec.SpecWarrior,\n        name: 'Prot Warrior',\n        tooltip: 'Prot Warrior: Adds Sunder Armor.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/medium/inv_shield_06.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            const debuffs = raidProto.debuffs!;\n            debuffs.sunderArmor = true;\n        },\n    },\n\t{\n\t\t// The value of this field must never change, to preserve local storage data.\n\t\tbuffBotId: 'Unholy Frenzy Dk',\n\t\tspec: Spec.SpecDeathknight,\n\t\tname: 'Blood DK',\n\t\ttooltip: 'Deathknight: Adds Unholy Frenzy.',\n\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_bladedarmor.jpg',\n\t\tmodifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n\t\t\tconst unholyFrenzyIndex = buffBot.getUnholyFrenzyAssignment().targetIndex;\n\t\t\tif (unholyFrenzyIndex != NO_TARGET) {\n\t\t\t\tconst partyIndex = Math.floor(unholyFrenzyIndex / 5);\n\t\t\t\tconst playerIndex = unholyFrenzyIndex % 5;\n\t\t\t\tconst playerProto = raidProto.parties[partyIndex].players[playerIndex];\n\t\t\t\tif (playerProto.buffs) {\n\t\t\t\t\tplayerProto.buffs.unholyFrenzy++;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n];\n","import { Class } from '../core/proto/common.js';\nimport { RaidTarget } from '../core/proto/common.js';\nimport { Spec } from '../core/proto/common.js';\nimport { BuffBot as BuffBotProto } from '../core/proto/ui.js';\nimport { classColors } from '../core/proto_utils/utils.js';\nimport { emptyRaidTarget } from '../core/proto_utils/utils.js';\nimport { specToClass } from '../core/proto_utils/utils.js';\nimport { Sim } from '../core/sim.js';\nimport { EventID, TypedEvent } from '../core/typed_event.js';\nimport { BuffBotSettings, buffBotPresets } from './presets.js';\n\nexport const NO_ASSIGNMENT = -1;\n\n// Represents a buff bot in a raid.\nexport class BuffBot {\n\tsettings: BuffBotSettings;\n\tspec: Spec = 0;\n\tname: string = '';\n\n\tprivate raidIndex: number = NO_ASSIGNMENT;\n\tprivate innervateAssignment: RaidTarget = emptyRaidTarget();\n\tprivate powerInfusionAssignment: RaidTarget = emptyRaidTarget();\n\tprivate tricksOfTheTradeAssignment: RaidTarget = emptyRaidTarget();\n\tprivate unholyFrenzyAssignment: RaidTarget = emptyRaidTarget();\n\n\treadonly raidIndexChangeEmitter = new TypedEvent<void>();\n\treadonly innervateAssignmentChangeEmitter = new TypedEvent<void>();\n\treadonly powerInfusionAssignmentChangeEmitter = new TypedEvent<void>();\n\treadonly tricksOfTheTradeAssignmentChangeEmitter = new TypedEvent<void>();\n\treadonly unholyFrenzyAssignmentChangeEmitter = new TypedEvent<void>();\n\treadonly changeEmitter = new TypedEvent<void>();\n\n\tprivate readonly sim: Sim;\n\n\tconstructor(id: string, sim: Sim) {\n\t\tconst settings = buffBotPresets.find(preset => preset.buffBotId == id);\n\t\tif (!settings) {\n\t\t\tthrow new Error('No buff bot config with id \\'' + id + '\\'!');\n\t\t}\n\n\t\tthis.sim = sim;\n\t\tthis.settings = settings;\n\t\tthis.updateSettings();\n\n\t\t[\n\t\t\tthis.raidIndexChangeEmitter,\n\t\t\tthis.innervateAssignmentChangeEmitter,\n\t\t\tthis.powerInfusionAssignmentChangeEmitter,\n\t\t\tthis.tricksOfTheTradeAssignmentChangeEmitter,\n\t\t\tthis.unholyFrenzyAssignmentChangeEmitter,\n\t\t].forEach(emitter => emitter.on(eventID => this.changeEmitter.emit(eventID)));\n\n\t\tthis.changeEmitter.on(eventID => sim.raid.getParty(this.getPartyIndex()).changeEmitter.emit(eventID));\n\t}\n\n\tprivate updateSettings() {\n\t\tthis.spec = this.settings.spec;\n\t\tthis.name = this.settings.name;\n\t}\n\n\tgetLabel(): string {\n\t\treturn `${this.name} (#${this.getRaidIndex() + 1})`;\n\t}\n\n\tgetClass(): Class {\n\t\treturn specToClass[this.settings.spec];\n\t}\n\n\tgetClassColor(): string {\n\t\treturn classColors[this.getClass()];\n\t}\n\n\tgetRaidIndex(): number {\n\t\treturn this.raidIndex;\n\t}\n\tsetRaidIndex(eventID: EventID, newRaidIndex: number) {\n\t\tif (newRaidIndex != this.raidIndex) {\n\t\t\tthis.raidIndex = newRaidIndex;\n\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\tthis.raidIndexChangeEmitter.emit(eventID);\n\t\t\t\tthis.sim.raid.compChangeEmitter.emit(eventID);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetPartyIndex(): number {\n\t\treturn Math.floor(this.getRaidIndex() / 5);\n\t}\n\n\tgetInnervateAssignment(): RaidTarget {\n\t\t// Defensive copy.\n\t\treturn RaidTarget.clone(this.innervateAssignment);\n\t}\n\tsetInnervateAssignment(eventID: EventID, newInnervateAssignment: RaidTarget) {\n\t\tif (RaidTarget.equals(newInnervateAssignment, this.innervateAssignment))\n\t\t\treturn;\n\n\t\t// Defensive copy.\n\t\tthis.innervateAssignment = RaidTarget.clone(newInnervateAssignment);\n\t\tthis.innervateAssignmentChangeEmitter.emit(eventID);\n\t}\n\n\tgetPowerInfusionAssignment(): RaidTarget {\n\t\t// Defensive copy.\n\t\treturn RaidTarget.clone(this.powerInfusionAssignment);\n\t}\n\tsetPowerInfusionAssignment(eventID: EventID, newPowerInfusionAssignment: RaidTarget) {\n\t\tif (RaidTarget.equals(newPowerInfusionAssignment, this.powerInfusionAssignment))\n\t\t\treturn;\n\n\t\t// Defensive copy.\n\t\tthis.powerInfusionAssignment = RaidTarget.clone(newPowerInfusionAssignment);\n\t\tthis.powerInfusionAssignmentChangeEmitter.emit(eventID);\n\t}\n\n\tgetTricksOfTheTradeAssignment(): RaidTarget {\n\t\t// Defensive copy.\n\t\treturn RaidTarget.clone(this.tricksOfTheTradeAssignment);\n\t}\n\tsetTricksOfTheTradeAssignment(eventID: EventID, newTricksOfTheTradeAssignment: RaidTarget) {\n\t\tif (RaidTarget.equals(newTricksOfTheTradeAssignment, this.tricksOfTheTradeAssignment))\n\t\t\treturn;\n\n\t\t// Defensive copy.\n\t\tthis.tricksOfTheTradeAssignment = RaidTarget.clone(newTricksOfTheTradeAssignment);\n\t\tthis.tricksOfTheTradeAssignmentChangeEmitter.emit(eventID);\n\t}\n\n\tgetUnholyFrenzyAssignment(): RaidTarget {\n\t\t// Defensive copy.\n\t\treturn RaidTarget.clone(this.unholyFrenzyAssignment);\n\t}\n\tsetUnholyFrenzyAssignment(eventID: EventID, newUnholyFrenzyAssignment: RaidTarget) {\n\t\tif (RaidTarget.equals(newUnholyFrenzyAssignment, this.unholyFrenzyAssignment))\n\t\t\treturn;\n\n\t\t// Defensive copy.\n\t\tthis.unholyFrenzyAssignment = RaidTarget.clone(newUnholyFrenzyAssignment);\n\t\tthis.unholyFrenzyAssignmentChangeEmitter.emit(eventID);\n\t}\n\n\ttoProto(): BuffBotProto {\n\t\treturn BuffBotProto.create({\n\t\t\tid: this.settings.buffBotId,\n\t\t\traidIndex: this.getRaidIndex(),\n\t\t\tinnervateAssignment: this.getInnervateAssignment(),\n\t\t\tpowerInfusionAssignment: this.getPowerInfusionAssignment(),\n\t\t\ttricksOfTheTradeAssignment: this.getTricksOfTheTradeAssignment(),\n\t\t\tunholyFrenzyAssignment: this.getUnholyFrenzyAssignment(),\n\t\t});\n\t}\n\n\tfromProto(eventID: EventID, proto: BuffBotProto) {\n\t\tconst settings = buffBotPresets.find(preset => preset.buffBotId == proto.id);\n\t\tif (!settings) {\n\t\t\tthrow new Error('No buff bot config with id \\'' + proto.id + '\\'!');\n\t\t}\n\t\tthis.settings = settings;\n\t\tthis.updateSettings();\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.setRaidIndex(eventID, proto.raidIndex);\n\t\t\tthis.setInnervateAssignment(eventID, proto.innervateAssignment || emptyRaidTarget());\n\t\t\tthis.setPowerInfusionAssignment(eventID, proto.powerInfusionAssignment || emptyRaidTarget());\n\t\t\tthis.setTricksOfTheTradeAssignment(eventID, proto.tricksOfTheTradeAssignment || emptyRaidTarget());\n\t\t\tthis.setUnholyFrenzyAssignment(eventID, proto.unholyFrenzyAssignment || emptyRaidTarget());\n\t\t});\n\t}\n\n\tclone(eventID: EventID): BuffBot {\n\t\tconst newBuffBot = new BuffBot(this.settings.buffBotId, this.sim);\n\t\tnewBuffBot.fromProto(eventID, this.toProto());\n\t\treturn newBuffBot;\n\t}\n}\n","import { Component } from '../core/components/component.js';\nimport { Input, InputConfig } from '../core/components/input.js';\nimport { RaidTargetPicker } from '../core/components/raid_target_picker.js';\nimport { Player } from '../core/player.js';\nimport { Raid } from '../core/raid.js';\nimport { EventID, TypedEvent } from '../core/typed_event.js';\nimport { Class } from '../core/proto/common.js';\nimport { RaidTarget } from '../core/proto/common.js';\nimport { Spec } from '../core/proto/common.js';\nimport { getEnumValues } from '../core/utils.js';\nimport { wait } from '../core/utils.js';\nimport { emptyRaidTarget } from '../core/proto_utils/utils.js';\n\nimport { BuffBot } from './buff_bot.js';\nimport { RaidSimUI } from './raid_sim_ui.js';\n\ndeclare var tippy: any;\n\nexport class AssignmentsPicker extends Component {\n    readonly raidSimUI: RaidSimUI;\n    readonly changeEmitter: TypedEvent<void> = new TypedEvent<void>();\n\n\tprivate readonly innervatesPicker: InnervatesPicker;\n\tprivate readonly powerInfusionsPicker: PowerInfusionsPicker;\n\tprivate readonly tricksOfTheTradesPicker: TricksOfTheTradesPicker;\n\tprivate readonly unholyFrenzyPicker: UnholyFrenzyPicker;\n\n\tconstructor(parentElem: HTMLElement, raidSimUI: RaidSimUI) {\n\t\tsuper(parentElem, 'assignments-picker-root');\n\t\tthis.raidSimUI = raidSimUI;\n\t\tthis.innervatesPicker = new InnervatesPicker(this.rootElem, raidSimUI);\n\t\tthis.powerInfusionsPicker = new PowerInfusionsPicker(this.rootElem, raidSimUI);\n\t\tthis.tricksOfTheTradesPicker = new TricksOfTheTradesPicker(this.rootElem, raidSimUI);\n\t\tthis.unholyFrenzyPicker = new UnholyFrenzyPicker(this.rootElem, raidSimUI);\n\t}\n}\n\ninterface AssignmentTargetPicker {\n    playerOrBot: Player<any> | BuffBot,\n    targetPicker: RaidTargetPicker<Player<any>> | RaidTargetPicker<BuffBot>,\n    targetPlayer: Player<any> | null;\n};\n\nabstract class AssignedBuffPicker extends Component {\n    readonly raidSimUI: RaidSimUI;\n    readonly changeEmitter: TypedEvent<void> = new TypedEvent<void>();\n\n    private readonly playersContainer: HTMLElement;\n\n    private targetPickers: Array<AssignmentTargetPicker>;\n\n    constructor(parentElem: HTMLElement, raidSimUI: RaidSimUI) {\n        super(parentElem, 'assigned-buff-picker-root');\n        this.raidSimUI = raidSimUI;\n        this.targetPickers = [];\n\n        this.playersContainer = document.createElement('fieldset');\n        this.playersContainer.classList.add('assigned-buff-players-container', 'settings-section');\n        this.rootElem.appendChild(this.playersContainer);\n\n        this.update();\n        this.raidSimUI.changeEmitter.on(eventID => {\n            this.update();\n        });\n    }\n\n    private update() {\n        this.playersContainer.innerHTML = `\n\t\t\t<legend>${this.getTitle().toUpperCase()}</legend>\n\t\t`;\n\n        const sourcePlayers = this.getSourcePlayers();\n        if (sourcePlayers.length == 0) {\n            this.rootElem.style.display = 'none';\n        } else {\n            this.rootElem.style.display = 'initial';\n        }\n\n        this.targetPickers = sourcePlayers.map((sourcePlayer, sourcePlayerIndex) => {\n            const row = document.createElement('div');\n            row.classList.add('assigned-buff-player');\n            this.playersContainer.appendChild(row);\n\n            const sourceElem = RaidTargetPicker.makeOptionElem({\n                iconUrl: sourcePlayer instanceof Player ? sourcePlayer.getTalentTreeIcon() : sourcePlayer.settings.iconUrl,\n                text: sourcePlayer.getLabel(),\n                color: sourcePlayer.getClassColor(),\n                isDropdown: false,\n            });\n            sourceElem.classList.add('raid-target-picker-root');\n            row.appendChild(sourceElem);\n\n            const arrow = document.createElement('span');\n            arrow.classList.add('assigned-buff-arrow', 'fa', 'fa-arrow-right');\n            row.appendChild(arrow);\n\n            let raidTargetPicker: RaidTargetPicker<Player<any>> | RaidTargetPicker<BuffBot> | null = null;\n            if (sourcePlayer instanceof Player) {\n                raidTargetPicker = new RaidTargetPicker<Player<any>>(row, this.raidSimUI.sim.raid, sourcePlayer, {\n                    extraCssClasses: [\n                        'assigned-buff-target-picker',\n                    ],\n                    noTargetLabel: 'Unassigned',\n                    compChangeEmitter: this.raidSimUI.sim.raid.compChangeEmitter,\n\n                    changedEvent: (player: Player<any>) => player.specOptionsChangeEmitter,\n                    getValue: (player: Player<any>) => this.getPlayerValue(player),\n                    setValue: (eventID: EventID, player: Player<any>, newValue: RaidTarget) => this.setPlayerValue(eventID, player, newValue),\n                });\n            } else {\n                raidTargetPicker = new RaidTargetPicker<BuffBot>(row, this.raidSimUI.sim.raid, sourcePlayer, {\n                    extraCssClasses: [\n                        'assigned-buff-target-picker',\n                    ],\n                    noTargetLabel: 'Unassigned',\n                    compChangeEmitter: this.raidSimUI.sim.raid.compChangeEmitter,\n\n                    changedEvent: (buffBot: BuffBot) => buffBot.changeEmitter,\n                    getValue: (buffBot: BuffBot) => this.getBuffBotValue(buffBot),\n                    setValue: (eventID: EventID, buffBot: BuffBot, newValue: RaidTarget) => this.setBuffBotValue(eventID, buffBot, newValue),\n                });\n            }\n\n            const targetPickerData = {\n                playerOrBot: sourcePlayer,\n                targetPicker: raidTargetPicker!,\n                targetPlayer: this.raidSimUI.sim.raid.getPlayerFromRaidTarget(raidTargetPicker!.getInputValue()),\n            };\n\n            raidTargetPicker!.changeEmitter.on(eventID => {\n                targetPickerData.targetPlayer = this.raidSimUI.sim.raid.getPlayerFromRaidTarget(raidTargetPicker!.getInputValue());\n            });\n\n            return targetPickerData;\n        });\n    }\n\n    abstract getTitle(): string;\n    abstract getSourcePlayers(): Array<Player<any> | BuffBot>;\n\n    abstract getPlayerValue(player: Player<any>): RaidTarget;\n    abstract setPlayerValue(eventID: EventID, player: Player<any>, newValue: RaidTarget): void;\n\n    abstract getBuffBotValue(buffBot: BuffBot): RaidTarget;\n    abstract setBuffBotValue(eventID: EventID, buffBot: BuffBot, newValue: RaidTarget): void;\n}\n\nclass InnervatesPicker extends AssignedBuffPicker {\n    getTitle(): string {\n        return 'Innervates';\n    }\n\n    getSourcePlayers(): Array<Player<any> | BuffBot> {\n        return this.raidSimUI.getPlayersAndBuffBots().filter(playerOrBot => playerOrBot?.getClass() == Class.ClassDruid) as Array<Player<any> | BuffBot>;\n    }\n\n    getPlayerValue(player: Player<any>): RaidTarget {\n        return (player as Player<Spec.SpecBalanceDruid>).getSpecOptions().innervateTarget || emptyRaidTarget();\n    }\n\n    setPlayerValue(eventID: EventID, player: Player<any>, newValue: RaidTarget) {\n        const newOptions = (player as Player<Spec.SpecBalanceDruid>).getSpecOptions();\n        newOptions.innervateTarget = newValue;\n        player.setSpecOptions(eventID, newOptions);\n    }\n\n    getBuffBotValue(buffBot: BuffBot): RaidTarget {\n        return buffBot.getInnervateAssignment();\n    }\n\n    setBuffBotValue(eventID: EventID, buffBot: BuffBot, newValue: RaidTarget) {\n        buffBot.setInnervateAssignment(eventID, newValue);\n    }\n}\n\nclass PowerInfusionsPicker extends AssignedBuffPicker {\n    getTitle(): string {\n        return 'Power Infusions';\n    }\n\n    getSourcePlayers(): Array<Player<any> | BuffBot> {\n        return this.raidSimUI.getPlayersAndBuffBots()\n            .filter(playerOrBot => playerOrBot?.getClass() == Class.ClassPriest)\n            .filter(playerOrBot => {\n                if (playerOrBot instanceof BuffBot) {\n                    return playerOrBot.settings.buffBotId == 'Divine Spirit Priest';\n                } else {\n                    const player = playerOrBot as Player<any>;\n                    if (!(player as Player<Spec.SpecSmitePriest>).getTalents().powerInfusion) {\n                        return false;\n                    }\n                    // Don't include shadow priests even if they have the talent, because they\n                    // don't have a raid target option for this.\n                    return player.spec == Spec.SpecSmitePriest;\n                }\n            }) as Array<Player<any> | BuffBot>;\n    }\n\n    getPlayerValue(player: Player<any>): RaidTarget {\n        return (player as Player<Spec.SpecSmitePriest>).getSpecOptions().powerInfusionTarget || emptyRaidTarget();\n    }\n\n    setPlayerValue(eventID: EventID, player: Player<any>, newValue: RaidTarget) {\n        const newOptions = (player as Player<Spec.SpecSmitePriest>).getSpecOptions();\n        newOptions.powerInfusionTarget = newValue;\n        player.setSpecOptions(eventID, newOptions);\n    }\n\n    getBuffBotValue(buffBot: BuffBot): RaidTarget {\n        return buffBot.getPowerInfusionAssignment();\n    }\n\n    setBuffBotValue(eventID: EventID, buffBot: BuffBot, newValue: RaidTarget) {\n        buffBot.setPowerInfusionAssignment(eventID, newValue);\n    }\n}\n\nclass TricksOfTheTradesPicker extends AssignedBuffPicker {\n\tgetTitle(): string {\n\t\treturn 'Tricks of the Trades';\n\t}\n\n\tgetSourcePlayers(): Array<Player<any> | BuffBot> {\n\t\treturn this.raidSimUI.getPlayersAndBuffBots().filter(playerOrBot => playerOrBot?.getClass() == Class.ClassRogue) as Array<Player<any> | BuffBot>;\n\t}\n\n\tgetPlayerValue(player: Player<any>): RaidTarget {\n\t\treturn (player as Player<Spec.SpecRogue>).getSpecOptions().tricksOfTheTradeTarget || emptyRaidTarget();\n\t}\n\n\tsetPlayerValue(eventID: EventID, player: Player<any>, newValue: RaidTarget) {\n\t\tconst newOptions = (player as Player<Spec.SpecRogue>).getSpecOptions();\n\t\tnewOptions.tricksOfTheTradeTarget = newValue;\n\t\tplayer.setSpecOptions(eventID, newOptions);\n\t}\n\n\tgetBuffBotValue(buffBot: BuffBot): RaidTarget {\n\t\treturn buffBot.getTricksOfTheTradeAssignment();\n\t}\n\n\tsetBuffBotValue(eventID: EventID, buffBot: BuffBot, newValue: RaidTarget) {\n\t\tbuffBot.setTricksOfTheTradeAssignment(eventID, newValue);\n\t}\n}\n\nclass UnholyFrenzyPicker extends AssignedBuffPicker {\n    getTitle(): string {\n        return 'Unholy Frenzy';\n    }\n\n    getSourcePlayers(): Array<Player<any> | BuffBot> {\n        return this.raidSimUI.getPlayersAndBuffBots()\n            .filter(playerOrBot => playerOrBot?.getClass() == Class.ClassDeathknight)\n            .filter(playerOrBot => {\n                if (playerOrBot instanceof BuffBot) {\n                    return playerOrBot.settings.buffBotId == 'Unholy Frenzy Dk';\n                } else {\n                    const player = playerOrBot as Player<Spec.SpecDeathknight>;\n                    return player.getTalents().hysteria;\n                }\n            }) as Array<Player<any> | BuffBot>;\n    }\n\n    getPlayerValue(player: Player<any>): RaidTarget {\n        return (player as Player<Spec.SpecDeathknight>).getSpecOptions().unholyFrenzyTarget || emptyRaidTarget();\n    }\n\n    setPlayerValue(eventID: EventID, player: Player<any>, newValue: RaidTarget) {\n        const newOptions = (player as Player<Spec.SpecDeathknight>).getSpecOptions();\n        newOptions.unholyFrenzyTarget = newValue;\n        player.setSpecOptions(eventID, newOptions);\n    }\n\n    getBuffBotValue(buffBot: BuffBot): RaidTarget {\n        return buffBot.getUnholyFrenzyAssignment();\n    }\n\n    setBuffBotValue(eventID: EventID, buffBot: BuffBot, newValue: RaidTarget) {\n        buffBot.setUnholyFrenzyAssignment(eventID, newValue);\n    }\n}\n","import { Component } from '../core/components/component.js';\nimport { IconEnumPicker } from '../core/components/icon_enum_picker.js';\nimport { EventID, TypedEvent } from '../core/typed_event.js';\nimport { Class } from '../core/proto/common.js';\nimport { Spec } from '../core/proto/common.js';\nimport { Blessings } from '../core/proto/paladin.js';\nimport { BlessingsAssignment } from '../core/proto/ui.js';\nimport { BlessingsAssignments } from '../core/proto/ui.js';\nimport { ActionId } from '../core/proto_utils/action_id.js';\nimport { memeSpecs } from '../core/launched_sims.js';\nimport {\n\tmakeDefaultBlessings,\n\tclassColors,\n\tnaturalSpecOrder,\n\tspecNames,\n\ttitleIcons,\n} from '../core/proto_utils/utils.js';\nimport { getEnumValues } from '../core/utils.js';\n\nimport { RaidSimUI } from './raid_sim_ui.js';\nimport { implementedSpecs } from './presets.js';\n\ndeclare var tippy: any;\n\nconst MAX_PALADINS = 4;\n\nexport class BlessingsPicker extends Component {\n\treadonly raidSimUI: RaidSimUI;\n\treadonly changeEmitter: TypedEvent<void> = new TypedEvent<void>();\n\n\tprivate readonly rows: Array<HTMLTableRowElement>;\n\tprivate readonly cols: Array<Array<HTMLElement>>;\n\n\tprivate assignments: BlessingsAssignments;\n\n\tconstructor(parentElem: HTMLElement, raidSimUI: RaidSimUI) {\n\t\tsuper(parentElem, 'blessings-picker-root');\n\t\tthis.raidSimUI = raidSimUI;\n\t\tthis.assignments = BlessingsAssignments.clone(makeDefaultBlessings(4));\n\n\t\tthis.rootElem.innerHTML = `\n\t\t<table class=\"blessings-table\">\n\t\t\t<tbody class=\"blessings-table-body\">\n\t\t\t</tbody>\n\t\t</table>\n\t\t`;\n\n\t\tconst headerRow = this.rootElem.getElementsByClassName('blessings-table-header-row')[0] as HTMLTableRowElement;\n\t\tconst bodyElem = this.rootElem.getElementsByClassName('blessings-table-body')[0] as HTMLTableSectionElement;\n\n\t\tconst specs = naturalSpecOrder\n\t\t\t.filter(spec => implementedSpecs.includes(spec))\n\t\t\t.filter(spec => !memeSpecs.includes(spec));\n\t\tconst paladinIndexes = [...Array(MAX_PALADINS).keys()];\n\n\t\tthis.cols = [];\n\t\tthis.rows = specs.map(spec => {\n\t\t\tconst row = document.createElement('tr');\n\t\t\trow.classList.add('blessings-table-row');\n\t\t\tbodyElem.appendChild(row);\n\n\t\t\tconst headerCell = document.createElement('th');\n\t\t\theaderCell.classList.add('blessings-table-header-cell');\n\t\t\trow.appendChild(headerCell);\n\n\t\t\tconst icon = document.createElement('img');\n\t\t\ticon.src = titleIcons[spec];\n\t\t\theaderCell.appendChild(icon);\n\n\t\t\ttippy(icon, {\n\t\t\t\t'content': specNames[spec],\n\t\t\t\t'allowHTML': true,\n\t\t\t});\n\n\t\t\tpaladinIndexes.forEach(paladinIdx => {\n\t\t\t\tconst cell = document.createElement('td');\n\t\t\t\tcell.classList.add('blessings-table-cell');\n\t\t\t\trow.appendChild(cell);\n\n\t\t\t\tif (!this.cols[paladinIdx]) {\n\t\t\t\t\tthis.cols.push([]);\n\t\t\t\t}\n\t\t\t\tthis.cols[paladinIdx].push(cell);\n\n\t\t\t\tconst blessingPicker = new IconEnumPicker(cell, this, {\n\t\t\t\t\textraCssClasses: [\n\t\t\t\t\t\t'blessing-picker',\n\t\t\t\t\t],\n\t\t\t\t\tnumColumns: 1,\n\t\t\t\t\tvalues: [\n\t\t\t\t\t\t{ color: classColors[Class.ClassPaladin], value: Blessings.BlessingUnknown },\n\t\t\t\t\t\t{ actionId: ActionId.fromSpellId(25898), value: Blessings.BlessingOfKings },\n\t\t\t\t\t\t{ actionId: ActionId.fromSpellId(48934), value: Blessings.BlessingOfMight },\n\t\t\t\t\t\t{ actionId: ActionId.fromSpellId(48938), value: Blessings.BlessingOfWisdom },\n\t\t\t\t\t\t{ actionId: ActionId.fromSpellId(25899), value: Blessings.BlessingOfSanctuary },\n\t\t\t\t\t],\n\t\t\t\t\tequals: (a: Blessings, b: Blessings) => a == b,\n\t\t\t\t\tzeroValue: Blessings.BlessingUnknown,\n\t\t\t\t\tchangedEvent: (picker: BlessingsPicker) => picker.changeEmitter,\n\t\t\t\t\tgetValue: (picker: BlessingsPicker) => picker.assignments.paladins[paladinIdx]?.blessings[spec] || Blessings.BlessingUnknown,\n\t\t\t\t\tsetValue: (eventID: EventID, picker: BlessingsPicker, newValue: number) => {\n\t\t\t\t\t\tconst currentValue = picker.assignments.paladins[paladinIdx].blessings[spec];\n\t\t\t\t\t\tif (currentValue != newValue) {\n\t\t\t\t\t\t\tpicker.assignments.paladins[paladinIdx].blessings[spec] = newValue;\n\t\t\t\t\t\t\tthis.changeEmitter.emit(eventID);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn row;\n\t\t});\n\n\t\tthis.setNumPaladins(raidSimUI.getClassCount(Class.ClassPaladin));\n\t\traidSimUI.compChangeEmitter.on(eventID => {\n\t\t\tthis.setNumPaladins(raidSimUI.getClassCount(Class.ClassPaladin));\n\t\t});\n\t}\n\n\tprivate setNumPaladins(numPaladins: number) {\n\t\tnumPaladins = Math.min(numPaladins, MAX_PALADINS);\n\n\t\tfor (let i = 0; i < numPaladins; i++) {\n\t\t\tthis.cols[i].forEach(elem => elem.classList.add('paladin-active'));\n\t\t}\n\t\tfor (let i = numPaladins; i < MAX_PALADINS; i++) {\n\t\t\tthis.cols[i].forEach(elem => elem.classList.remove('paladin-active'));\n\t\t}\n\t}\n\n\tgetAssignments(): BlessingsAssignments {\n\t\t// Defensive copy.\n\t\treturn BlessingsAssignments.clone(this.assignments);\n\t}\n\n\tsetAssignments(eventID: EventID, newAssignments: BlessingsAssignments) {\n\t\tthis.assignments = BlessingsAssignments.clone(newAssignments);\n\t\tthis.changeEmitter.emit(eventID);\n\t}\n}\n","import { Exporter } from '../core/components/exporters.js';\nimport { Importer } from '../core/components/importers.js';\nimport { MAX_PARTY_SIZE } from '../core/party.js';\nimport { BuffBot, RaidSimSettings } from '../core/proto/ui.js';\nimport { TypedEvent } from '../core/typed_event.js';\nimport { Party as PartyProto, Player as PlayerProto, Raid as RaidProto } from '../core/proto/api.js';\nimport { Encounter as EncounterProto, EquipmentSpec, ItemSpec, MobType, Spec, Target as TargetProto, RaidTarget, Faction } from '../core/proto/common.js';\nimport { nameToClass } from '../core/proto_utils/names.js';\nimport { makeDefaultBlessings, specTypeFunctions, withSpecProto, isTankSpec, playerToSpec } from '../core/proto_utils/utils.js';\nimport { MAX_NUM_PARTIES } from '../core/raid.js';\nimport { Player } from '../core/player.js';\nimport { Target } from '../core/target.js';\n\nimport { playerPresets, PresetSpecSettings } from './presets.js';\nimport { RaidSimUI } from './raid_sim_ui.js';\n\ndeclare var $: any;\ndeclare var tippy: any;\n\nexport function newRaidImporters(simUI: RaidSimUI): HTMLElement {\n\tconst importSettings = document.createElement('div');\n\timportSettings.classList.add('import-settings', 'sim-dropdown-menu');\n\timportSettings.innerHTML = `\n\t\t<span id='importMenuLink' class='dropdown-toggle fas fa-file-import' role='button' data-toggle='dropdown' aria-haspopup='true' arai-expanded='false'></span>\n\t\t<div class='dropdown-menu dropdown-menu-right' aria-labelledby='importMenuLink'>\n\t\t</div>\n\t`;\n\tconst linkElem = importSettings.getElementsByClassName('dropdown-toggle')[0] as HTMLElement;\n\ttippy(linkElem, {\n\t\t'content': 'Import',\n\t\t'allowHTML': true,\n\t});\n\n\tconst menuElem = importSettings.getElementsByClassName('dropdown-menu')[0] as HTMLElement;\n\tconst addMenuItem = (label: string, experimental: boolean, onClick: () => void) => {\n\t\tconst itemElem = document.createElement('span');\n\t\titemElem.classList.add('dropdown-item');\n\t\titemElem.textContent = label;\n\t\titemElem.addEventListener('click', onClick);\n\t\tmenuElem.appendChild(itemElem);\n\t};\n\n\taddMenuItem('Json', false, () => new RaidJsonImporter(menuElem, simUI));\n\taddMenuItem('WCL', true, () => new RaidWCLImporter(menuElem, simUI));\n\n\treturn importSettings;\n}\n\nexport function newRaidExporters(simUI: RaidSimUI): HTMLElement {\n\tconst exportSettings = document.createElement('div');\n\texportSettings.classList.add('export-settings', 'sim-dropdown-menu');\n\texportSettings.innerHTML = `\n\t\t<span id='exportMenuLink' class='dropdown-toggle fas fa-file-export' role='button' data-toggle='dropdown' aria-haspopup='true' arai-expanded='false'></span>\n\t\t<div class='dropdown-menu dropdown-menu-right' aria-labelledby='exportMenuLink'>\n\t\t</div>\n\t`;\n\tconst linkElem = exportSettings.getElementsByClassName('dropdown-toggle')[0] as HTMLElement;\n\ttippy(linkElem, {\n\t\t'content': 'Export',\n\t\t'allowHTML': true,\n\t});\n\n\tconst menuElem = exportSettings.getElementsByClassName('dropdown-menu')[0] as HTMLElement;\n\tconst addMenuItem = (label: string, onClick: () => void) => {\n\t\tconst itemElem = document.createElement('span');\n\t\titemElem.classList.add('dropdown-item');\n\t\titemElem.textContent = label;\n\t\titemElem.addEventListener('click', onClick);\n\t\tmenuElem.appendChild(itemElem);\n\t};\n\n\taddMenuItem('Json', () => new RaidJsonExporter(menuElem, simUI));\n\n\treturn exportSettings;\n}\n\nclass RaidJsonImporter extends Importer {\n\tprivate readonly simUI: RaidSimUI;\n\tconstructor(parent: HTMLElement, simUI: RaidSimUI) {\n\t\tsuper(parent, 'JSON Import', true);\n\t\tthis.simUI = simUI;\n\n\t\tthis.descriptionElem.innerHTML = `\n\t\t\t<p>\n\t\t\t\tImport settings from a JSON text file, which can be created using the JSON Export feature of this site.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the JSON text below and click, 'Import'.\n\t\t\t</p>\n\t\t`;\n\t}\n\n\tonImport(data: string) {\n\t\tconst settings = RaidSimSettings.fromJsonString(data);\n\t\tthis.simUI.fromProto(TypedEvent.nextEventID(), settings);\n\t\tthis.close();\n\t}\n}\n\nclass RaidJsonExporter extends Exporter {\n\tprivate readonly simUI: RaidSimUI;\n\n\tconstructor(parent: HTMLElement, simUI: RaidSimUI) {\n\t\tsuper(parent, 'JSON Export', true);\n\t\tthis.simUI = simUI;\n\t\tthis.init();\n\t}\n\n\tgetData(): string {\n\t\treturn JSON.stringify(RaidSimSettings.toJson(this.simUI.toProto()), null, 2);\n\t}\n}\n\nclass RaidWCLImporter extends Importer {\n\n\tprivate queryCounter: number = 0;\n\n\tprivate readonly simUI: RaidSimUI;\n\tconstructor(parent: HTMLElement, simUI: RaidSimUI) {\n\t\tsuper(parent, 'WCL Import', false);\n\t\tthis.simUI = simUI;\n\t\tthis.descriptionElem.innerHTML = `\n\t\t\t<p>\n\t\t\t\tImport entire raid from a WCL report.<br>\n\t\t\t\tParties are a best guess based on buffs.<br>\n\t\t\t\tDouble check innervate/PI and paladin buffs in the settings after import.<br>\n\t\t\t\tDoes not support fight=last currently (will default any non-numeric fight ID to be 0)<br>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the WCL report and fight link (https://classic.warcraftlogs.com/reports/REPORTID#fight=FIGHTID).<br>\n\t\t\t\tInclude the fight ID or else first found fight will be used.<br>\n\t\t\t</p>\n\t\t`;\n\t}\n\n\tprivate getWCLBearerToken(): Promise<string> {\n\n\t\treturn fetch('https://classic.warcraftlogs.com/oauth/token', {\n\t\t\t'method': 'POST',\n\t\t\t'headers': {\n\t\t\t\t'Authorization': 'Basic ' + btoa('963d31c8-7efa-4dde-87cf-1b254a8a2f8c:lRJVhujEEnF96xfUoxVHSpnqKN9v8bTqGEjutsO3'),\n\t\t\t},\n\t\t\tbody: new URLSearchParams({\n\t\t\t\t'grant_type': 'client_credentials',\n\t\t\t}),\n\t\t}).then(response => response.json())\n\t\t\t.then(res => res.access_token)\n\t\t\t.catch(err => { // TODO: handle error\n\t\t\t\tconsole.error(err);\n\t\t\t});\n\t}\n\n\tprivate queryWCL(query: string, token: string): Promise<any> {\n\t\tconst headers = {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'Authorization': `Bearer ${token}`,\n\t\t\t'Accept': 'application/json',\n\t\t};\n\n\t\tconst queryURL = `https://classic.warcraftlogs.com/api/v2/client?query=${query}`;\n\n\t\tthis.queryCounter++;\n\n\t\t// Query WCL\n\t\treturn fetch(encodeURI(queryURL), {\n\t\t\t'method': 'GET',\n\t\t\t'headers': headers,\n\t\t}).then(res => res.json());\n\t}\n\n\tprivate getURLInfo(url: string): { reportID: string; fightID: string } {\n\n\t\tlet urlInfo = { reportID: '', fightID: '0' };\n\n\t\tif (!url.includes('warcraftlogs.com')) {\n\t\t\tconsole.error('Invalid WCL URL', url, 'must be from warcraftlogs.com');\n\t\t\treturn urlInfo;\n\t\t}\n\n\t\tlet fightIDIndex = url.indexOf('fight=');\n\t\tlet reportIDIndex = url.indexOf('/reports/');\n\n\t\tif (reportIDIndex === -1) {\n\t\t\tconsole.error('Could not find report ID in URL', url);\n\t\t\treturn urlInfo;\n\t\t}\n\n\t\treportIDIndex += 9; // 9 = length of '/reports/'\n\t\tconst reportIDLength = 16;\n\n\t\tif (fightIDIndex !== -1) {\n\t\t\tfightIDIndex += 6; // 6 = length of 'fight='\n\n\t\t\tlet fightID = parseInt(url.substring(fightIDIndex), 10);\n\n\t\t\tif (isNaN(fightID)) {\n\t\t\t\tfightID = 0;\n\t\t\t}\n\n\t\t\turlInfo.fightID = fightID.toString();\n\t\t} else {\n\t\t\tconsole.warn('Could not find fight ID in URL', url, 'defaulting to fight 0');\n\t\t}\n\n\t\turlInfo.reportID = url.substring(reportIDIndex, reportIDIndex + reportIDLength) ?? '';\n\n\t\treturn urlInfo\n\t}\n\n\tprivate getRateLimit(token: string): Promise<wclRateLimitData> {\n\t\tconst query = `\n\t  {\n\t    rateLimitData {\n\t      limitPerHour, pointsSpentThisHour, pointsResetIn\n\t    }\n\t  }`;\n\t\treturn this.queryWCL(query, token)\n\t\t\t.then((res) => res['data']['rateLimitData'] as wclRateLimitData);\n\t}\n\n\tasync onImport(importLink: string) {\n\t\tthis.importButton.disabled = true;\n\t\tthis.rootElem.style.cursor = 'wait';\n\t\tthis.doImport(importLink).then(() => {\n\t\t\tthis.importButton.disabled = false\n\t\t\tthis.rootElem.style.removeProperty('cursor');\n\t\t})\n\t}\n\n\tasync doImport(importLink: string) {\n\t\tif (!importLink.length) {\n\t\t\tconsole.error('No import link provided!');\n\t\t\treturn;\n\t\t}\n\n\t\tlet urlInfo = this.getURLInfo(importLink);\n\n\t\tconst reportID = urlInfo.reportID;\n\t\tconst fightID = urlInfo.fightID;\n\n\t\tif (!reportID.length) {\n\t\t\tconsole.error('Could not find report ID in URL', importLink);\n\t\t\treturn;\n\t\t}\n\n\t\t// Clear the raid out to avoid any taint issues.\n\t\tthis.simUI.clearRaid(TypedEvent.nextEventID());\n\n\t\tconst token = await this.getWCLBearerToken();\n\n\t\tconst rateLimitBuffer = 30; // WCL Query point buffer\n\t\tconst rateLimitStart: wclRateLimitData = await this.getRateLimit(token);\n\n\t\t// Slower but more accurate way to generate the raid sim.\n\t\t// Generates players into the groups that they were in during the fight.\n\t\t// If the rate limit is close to max, then it will create the raid parties 'randomly'.\n\t\tlet experimentalGenerateParties: boolean = rateLimitStart.pointsSpentThisHour + rateLimitBuffer < rateLimitStart.limitPerHour;\n\n\t\tconsole.info('Importing WCL report', reportID, 'fight', fightID, 'Generate Parties:', experimentalGenerateParties);\n\n\t\tconst reportDataQuery = `\n\t\t\t\t{\n\t\t\t\t\treportData {\n\t\t\t\t\t\treport(code: \"${reportID}\") {\n\t\t\t\t\t\t\tguild {\n\t\t\t\t\t\t\t\tname faction {id}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tplayerDetails: table(fightIDs: [${fightID}], endTime: 99999999, dataType: Casts, killType: All, viewBy: Default)\n\t\t\t\t\t\t\tfights(fightIDs: [${fightID}]) {\n\t\t\t\t\t\t\t\tstartTime, endTime, id, name\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinnervates: table(fightIDs: [${fightID}], dataType:Casts, endTime: 99999999, sourceClass: \"Druid\", abilityID: 29166),\n\t\t\t\t\t\t\tpowerInfusion: table(fightIDs: [${fightID}], dataType:Casts, endTime: 99999999, sourceClass: \"Priest\", abilityID: 10060)\n\t\t\t\t\t\t\ttricksOfTheTrade: table(fightIDs: [${fightID}], dataType:Casts, endTime: 99999999, sourceClass: \"Rogue\", abilityID: 57933)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t`;\n\n\t\tconst reportData = await this.queryWCL(reportDataQuery, token);\n\t\tif (reportData.errors != undefined && reportData.errors != null && reportData.errors.length) {\n\t\t\tconst errorData = reportData.errors.reduce((accumulator: string, error: any) => {\n\t\t\t\treturn accumulator + error.message;\n\t\t\t}, \"\");\n\t\t\talert(\"Failed to import: \" + errorData);\n\t\t\treturn;\n\t\t}\n\t\t// Process the report data.\n\t\tconst wclData = reportData.data.reportData.report; // TODO: Typings?\n\n\t\tconst guildData = wclData.guild;\n\t\tconst playerData: wclPlayer[] = wclData.playerDetails.data.entries;\n\t\tconst innervateData: wclBuffCastsData[] = wclData.innervates.data.entries;\n\t\tconst powerInfusionData: wclBuffCastsData[] = wclData.powerInfusion.data.entries;\n\t\tconst tricksOfTheTradeData: wclBuffCastsData[] = wclData.tricksOfTheTrade.data.entries;\n\n\t\t// Set up the general variables we need for import to be successful.\n\t\tconst fight: { startTime: number, endTime: number, id: number, name: string } = wclData.fights[0];\n\t\tconst startTime: number = fight.startTime;\n\t\tconst endTime: number = fight.endTime;\n\n\t\t// Default to UI setting\n\t\tlet faction = this.simUI.raidPicker?.getCurrentFaction();\n\n\t\t// If defined in log, use that faction.\n\t\tif (guildData != null) {\n\t\t\tfaction = guildData.faction.id as Faction;\n\t\t}\n\n\t\t// Fallback if UI is broken and log has no faction.\n\t\tif (faction == undefined) {\n\t\t\tfaction = Faction.Horde;\n\t\t}\n\n\t\tconst encounter = EncounterProto.create();\n\t\tencounter.duration = (endTime - startTime) / 1000;\n\n\t\tencounter.targets = new Array<TargetProto>();\n\n\t\tlet closestEncounterPreset = this.simUI.sim.getAllPresetEncounters().find((enc) => enc.path.includes(fight.name));\n\n\t\t// Use the preset encounter if it exists.\n\t\tif (closestEncounterPreset && closestEncounterPreset.targets.length) {\n\t\t\tclosestEncounterPreset.targets\n\t\t\t\t.map((mob) => mob.target as TargetProto)\n\t\t\t\t.filter((target) => target !== undefined)\n\t\t\t\t.forEach((target) => encounter.targets.push(target));\n\t\t}\n\n\t\t// Build a manual target list if no preset encounter exists.\n\t\tif (encounter.targets.length === 0) {\n\t\t\tencounter.targets.push(Target.defaultProto());\n\t\t}\n\n\t\tconst settings = RaidSimSettings.create();\n\t\tsettings.encounter = encounter;\n\n\t\tconst raid = RaidProto.create();\n\t\traid.parties = new Array<PartyProto>();\n\t\tsettings.raid = raid;\n\n\t\tconst buffBots = new Array<BuffBot>();\n\n\t\t// Raid index of players that received innervates\n\t\tconst wclIDtoRaidIndex = new Map<number, number>();\n\n\t\tconst numPaladins = playerData.filter((player) => player.type === 'Paladin').length;\n\n\t\t// Generate an empty set of 3 dimensional arrays for each party. [ party ][ player or buffBot ][ player ]\n\t\tlet tempParties: WCLSimPlayer[][] = Array.from({ length: MAX_NUM_PARTIES }).map(() => []);\n\n\t\t// Generate the default 5 raid parties & temp parties.\n\t\ttempParties.forEach(() => raid.parties.push(PartyProto.create()));\n\n\t\t// Sorts an objectArray by a property. Returns a new array.\n\t\t// Can be called recursively.\n\t\tconst sortByProperty = (objArray: any[], prop: string) => {\n\t\t\tif (!Array.isArray(objArray)) throw new Error('FIRST ARGUMENT NOT AN ARRAY');\n\t\t\tconst clone = objArray.slice(0);\n\t\t\tconst direct = arguments.length > 2 ? arguments[2] : 1; //Default to ascending\n\t\t\tconst propPath = (prop.constructor === Array) ? prop : prop.split('.');\n\t\t\tclone.sort(function(a, b) {\n\t\t\t\tfor (let p in propPath) {\n\t\t\t\t\tif (a[propPath[p]] && b[propPath[p]]) {\n\t\t\t\t\t\ta = a[propPath[p]];\n\t\t\t\t\t\tb = b[propPath[p]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// convert numeric strings to integers\n\t\t\t\ta = a.toString().match(/^\\d+$/) ? +a : a;\n\t\t\t\tb = b.toString().match(/^\\d+$/) ? +b : b;\n\t\t\t\treturn ((a < b) ? -1 * direct : ((a > b) ? 1 * direct : 0));\n\t\t\t});\n\t\t\treturn clone;\n\t\t}\n\n\t\tconst mappedPlayers = playerData\n\t\t\t.map((wclPlayer) => new WCLSimPlayer(wclPlayer, this.simUI, faction));\n\n\t\tconst processBuffCastData = (buffCastData: wclBuffCastsData[]): { player: WCLSimPlayer, target: string }[] => {\n\t\t\tconst playerCasts: { player: WCLSimPlayer, target: string }[] = [];\n\t\t\tif (buffCastData.length) {\n\t\t\t\tbuffCastData.forEach((cast) => {\n\t\t\t\t\tconst sourcePlayer = mappedPlayers.find((player) => player.name === cast.name);\n\t\t\t\t\tconst targetPlayer = mappedPlayers.find((player) => player.name === cast.targets[0].name);\n\n\t\t\t\t\t// Buff bots do not get PI/Innervates.\n\t\t\t\t\tif (sourcePlayer && targetPlayer && !targetPlayer.isBuffBot) {\n\t\t\t\t\t\tplayerCasts.push({ player: sourcePlayer, target: targetPlayer.name });\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn playerCasts;\n\t\t}\n\n\t\tprocessBuffCastData(innervateData).forEach((cast) => cast.player.innervateTarget = cast.target);\n\t\tprocessBuffCastData(powerInfusionData).forEach((cast) => cast.player.powerInfusionTarget = cast.target);\n\t\tprocessBuffCastData(tricksOfTheTradeData).forEach((cast) => cast.player.tricksOfTheTradeTarget = cast.target);\n\n\t\tconst wclPlayers: WCLSimPlayer[] = sortByProperty(sortByProperty(mappedPlayers, 'type'), 'sortPriority');\n\n\t\tlet raidIndex = 0;\n\n\t\t// Sorts buff bots to the end of the array to prevent overwriting them later on.\n\t\tconst sortBuffBotsLast = (a: WCLSimPlayer, b: WCLSimPlayer) => a.isBuffBot ? 1 : b.isBuffBot ? 1 : 0;\n\n\t\t// Reusable function to add a player to the raid.parties[raidIndex] array.\n\t\tconst assignPlayerToParty = (player: WCLSimPlayer, raidParty: PartyProto, missing = false) => {\n\n\t\t\tif (!player) {\n\t\t\t\tconsole.error('Cannot assign player to party because player is undefined!');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!raidParty) {\n\t\t\t\tconsole.error('Cannot assign player to party because party is undefined!');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (raidParty.players.length === MAX_PARTY_SIZE) {\n\t\t\t\tconsole.error('Cannot assign player to party because party is full!', player, raidParty.players);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (missing) {\n\t\t\t\tconsole.warn(`Could not locate a group for ${player.name}, assigning them to an open group.`);\n\t\t\t}\n\n\t\t\tlet buffBot = player.getBuffBot();\n\t\t\tlet simPlayer = player.getPlayer();\n\n\t\t\tif (!buffBot && !simPlayer) {\n\t\t\t\tconsole.error('Cannot assign player to party because player data is undefined!', player);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twclIDtoRaidIndex.set(player.id, raidIndex);\n\n\t\t\tif (buffBot) {\n\t\t\t\tbuffBot.raidIndex = raidIndex;\n\t\t\t\tbuffBots.push(buffBot);\n\t\t\t\traidParty.players.push(PlayerProto.create());\n\t\t\t} else if (simPlayer) {\n\t\t\t\traidParty.players.push(simPlayer);\n\t\t\t\tif (isTankSpec(playerToSpec(simPlayer))) {\n\t\t\t\t\tlet rt = RaidTarget.create();\n\t\t\t\t\trt.targetIndex = wclIDtoRaidIndex.get(player.id)!;\n\t\t\t\t\tsettings.raid!.tanks.push(rt);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Just in case this did not get set previously.\n\t\t\tplayer.partyAssigned = true;\n\n\t\t\traidIndex++;\n\t\t}\n\n\t\t// if experimental_generate_parties is true, we will generate parties based on the party buffers\n\t\tif (experimentalGenerateParties) {\n\n\t\t\t// We only care about the players who can provide party buffs on logs.\n\t\t\tconst partyBuffPlayers = wclPlayers.filter((player) => player.isPartyBuffer);\n\n\t\t\t// Can't be a forEach because we need to wait for the query to finish on each iteration later on.\n\t\t\tfor (const player of partyBuffPlayers) {\n\n\t\t\t\tconst partyFull = player.partyMembers.length >= MAX_PARTY_SIZE;\n\n\t\t\t\t// Skip players that have already been assigned to a party.\n\t\t\t\t// player.partyAssigned || player.partyFound || player.partyMembers.length > 0\n\t\t\t\tif (partyFull) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst auraIDs: number[] = player.getPartyAuraIds();\n\n\t\t\t\tif (!auraIDs.length) {\n\t\t\t\t\tconsole.warn('No party aura ids found for partyBuff player ' + player.name);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet auraBuffQueries = auraIDs.map((auraID) => `\n\t\t\t\t{\n\t\t\t\t\treportData {\n\t\t\t\t\t\treport(code: \"${reportID}\") {\n\t\t\t\t\ttable(startTime: ${startTime}, endTime: ${endTime}, sourceID: ${player.id}, abilityID: ${auraID}, fightIDs: [${fightID}],dataType:Buffs,viewBy:Target,hostilityType:Friendlies)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}`);\n\n\t\t\t\tlet auraTargets: wclAura[] = [];\n\n\t\t\t\t// Can't be a forEach because we need to await each query.\n\t\t\t\tfor (let i = 0; i < auraBuffQueries.length; i++) {\n\n\t\t\t\t\tif (auraTargets.length >= MAX_PARTY_SIZE || partyFull) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet auraQueryRes = await this.queryWCL(auraBuffQueries[i], token);\n\t\t\t\t\tif (auraQueryRes) {\n\t\t\t\t\t\tlet playerAuras: wclAura[] = auraQueryRes.data?.reportData?.report?.table?.data?.auras ?? [];\n\t\t\t\t\t\tif (playerAuras.length) {\n\n\t\t\t\t\t\t\tplayerAuras = playerAuras.filter((auraTarget) => auraTarget.type !== 'Pet')\n\t\t\t\t\t\t\t\t.sort((a, b) => a.bands[0].startTime - b.bands[0].startTime)\n\t\t\t\t\t\t\t\t.filter((auraTarget, index) => index < 5);\n\n\t\t\t\t\t\t\tconst uniqueAuraTargets = playerAuras.filter((auraTarget) => !auraTargets.some((target) => target.name === auraTarget.name));\n\t\t\t\t\t\t\tauraTargets.push(...uniqueAuraTargets);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (auraTargets.length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tplayer.partyFound = true;\n\n\t\t\t\t// Only need the member names at this point.\n\t\t\t\tplayer.partyMembers = auraTargets.map((auraTarget) => auraTarget.name);\n\n\t\t\t\tlet partyMembers = wclPlayers\n\t\t\t\t\t.filter((raidMember) => player.partyMembers.includes(raidMember.name))\n\t\t\t\t\t.filter((raidMember) => !raidMember.partyAssigned);\n\n\t\t\t\tconst totalPartyMembers = partyMembers.length;\n\n\t\t\t\t// Find an empty temp party to assign the members to.\n\t\t\t\tlet partyIndex: number = tempParties.findIndex((party) => party.length < MAX_PARTY_SIZE && party.length < totalPartyMembers);\n\n\t\t\t\t// Try and see if any of the parties have your party members in it without you.\n\t\t\t\tif (partyIndex === -1) {\n\t\t\t\t\tconsole.warn('No empty temp party found for player ' + player.name);\n\t\t\t\t\tpartyIndex = tempParties\n\t\t\t\t\t\t.filter((party) => party.length < MAX_PARTY_SIZE)\n\t\t\t\t\t\t.findIndex((party) => party.some((member) => player.partyMembers.includes(member.name)));\n\t\t\t\t\tconsole.info('Found party with members in it: ' + partyIndex);\n\t\t\t\t}\n\n\t\t\t\tlet party: WCLSimPlayer[] = tempParties[partyIndex];\n\n\t\t\t\tpartyMembers.forEach((partyMember) => {\n\n\t\t\t\t\tconst isUndefined = party === undefined;\n\t\t\t\t\tconst isFull = party.length === MAX_PARTY_SIZE;\n\n\t\t\t\t\tif (isUndefined || isFull) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tpartyMember.partyAssigned = true;\n\t\t\t\t\tpartyMember.partyMembers = player.partyMembers;\n\n\t\t\t\t\tparty.push(partyMember);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Process the temp groups into the sim raid groups.\n\t\t\ttempParties.forEach((party, partyIndex) => {\n\n\t\t\t\tlet raidParty = raid.parties[partyIndex];\n\n\t\t\t\tparty\n\t\t\t\t\t.sort(sortBuffBotsLast)\n\t\t\t\t\t.forEach((player) => assignPlayerToParty(player, raidParty));\n\t\t\t});\n\t\t}\n\n\t\t// Process the players who didn't get assigned a group yet.\n\t\twclPlayers\n\t\t\t.filter((player) => !player.partyAssigned)\n\t\t\t.sort(sortBuffBotsLast)\n\t\t\t.map((player) => {\n\t\t\t\tlet raidParty = raid.parties.filter((party) => party.players.length < MAX_PARTY_SIZE)[0];\n\t\t\t\tassignPlayerToParty(player, raidParty, true);\n\t\t\t});\n\n\t\t// Insert the innervate / PI buffs into the options for the raid.\n\t\twclPlayers\n\t\t\t.filter((player) => player.innervateTarget || player.powerInfusionTarget || player.tricksOfTheTradeTarget)\n\t\t\t.forEach((player) => {\n\n\t\t\t\tconst target: wclSimPlayer | undefined = wclPlayers.find((wclPlayer) => wclPlayer.name === player.innervateTarget || player.name === player.powerInfusionTarget || player.name === player.tricksOfTheTradeTarget);\n\n\t\t\t\tif (!target) {\n\t\t\t\t\tconsole.warn('Could not find target assignment player');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst targetID: number = target.id;\n\t\t\t\tconst targetRaidIndex: number | undefined = wclIDtoRaidIndex.get(targetID);\n\n\t\t\t\tif (!targetRaidIndex) {\n\t\t\t\t\tconsole.warn(`Could not find ${target.name} raid index!`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (player.isBuffBot) {\n\t\t\t\t\tconst playerID: number = player.id;\n\t\t\t\t\tconst playerRaidIndex: number | undefined = wclIDtoRaidIndex.get(playerID);\n\t\t\t\t\tconst buffBot = buffBots.find((buffBot) => buffBot.raidIndex === playerRaidIndex);\n\t\t\t\t\tif (buffBot) {\n\t\t\t\t\t\tif (player.innervateTarget) {\n\t\t\t\t\t\t\tbuffBot.innervateAssignment = RaidTarget.create();\n\t\t\t\t\t\t\tbuffBot.innervateAssignment.targetIndex = targetRaidIndex\n\t\t\t\t\t\t} else if (player.powerInfusionTarget) {\n\t\t\t\t\t\t\tbuffBot.powerInfusionAssignment = RaidTarget.create();\n\t\t\t\t\t\t\tbuffBot.powerInfusionAssignment.targetIndex = targetRaidIndex\n\t\t\t\t\t\t} else if (player.tricksOfTheTradeTarget) {\n\t\t\t\t\t\t\tbuffBot.tricksOfTheTradeAssignment = RaidTarget.create();\n\t\t\t\t\t\t\tbuffBot.tricksOfTheTradeAssignment.targetIndex = targetRaidIndex\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Regular players.\n\n\t\t\t\tconst raidParty = raid.parties.filter((party) => party.players.some((raidPlayer) => raidPlayer.name === player.name))[0];\n\n\t\t\t\tif (!raidParty) {\n\t\t\t\t\tconsole.warn('Could not find raiding party for player ' + player.name);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst raidPlayer = raidParty.players.find((raidPlayer) => raidPlayer.name === player.name);\n\n\t\t\t\tif (!raidPlayer) {\n\t\t\t\t\tconsole.warn('Could not find raid player ' + player.name + ' in raid party ' + raidParty);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (player.innervateTarget) {\n\t\t\t\t\tif (raidPlayer.spec.oneofKind == 'balanceDruid') {\n\t\t\t\t\t\traidPlayer.spec.balanceDruid.options!.innervateTarget = RaidTarget.create();\n\t\t\t\t\t\traidPlayer.spec.balanceDruid.options!.innervateTarget.targetIndex = targetRaidIndex;\n\t\t\t\t\t} else if (raidPlayer.spec.oneofKind == 'feralDruid') {\n\t\t\t\t\t\traidPlayer.spec.feralDruid.options!.innervateTarget = RaidTarget.create();\n\t\t\t\t\t\traidPlayer.spec.feralDruid.options!.innervateTarget.targetIndex = targetRaidIndex;\n\t\t\t\t\t} else if (raidPlayer.spec.oneofKind == 'feralTankDruid') {\n\t\t\t\t\t\traidPlayer.spec.feralTankDruid.options!.innervateTarget = RaidTarget.create();\n\t\t\t\t\t\traidPlayer.spec.feralTankDruid.options!.innervateTarget.targetIndex = targetRaidIndex;\n\t\t\t\t\t}\n\t\t\t\t} else if (player.powerInfusionTarget) {\n\t\t\t\t\t// Pretty sure there is no shadow priest that has PI\n\t\t\t\t} else if (player.tricksOfTheTradeTarget) {\n\t\t\t\t\t// TODO: I'm not sure what I'm supposed to do here\n\t\t\t\t}\n\t\t\t});\n\n\t\twclPlayers\n\t\t\t.filter((player) => !player.partyAssigned)\n\t\t\t.forEach((player) => {\n\t\t\t\tconsole.error(`${player.name} is not in a party!`, player);\n\t\t\t});\n\n\t\tsettings.blessings = makeDefaultBlessings(numPaladins);\n\n\t\tthis.simUI.fromProto(TypedEvent.nextEventID(), settings);\n\t\tthis.simUI.setBuffBots(TypedEvent.nextEventID(), buffBots);\n\n\t\tif (!experimentalGenerateParties) {\n\t\t\tconst rateLimitEnd: wclRateLimitData = await this.getRateLimit(token);\n\t\t\tconsole.debug(`Rate Limit resets in ${rateLimitEnd.pointsResetIn} seconds.`);\n\t\t}\n\n\t\tthis.close();\n\t}\n}\n\nclass WCLSimPlayer implements wclSimPlayer {\n\tpublic gear: wclGear[];\n\tpublic icon: string;\n\tpublic id: number;\n\tpublic name: string;\n\tpublic type: string;\n\tpublic talents: wclTalents[];\n\tpublic wclSpec: string;\n\n\tpublic partyAssigned: boolean = false;\n\tpublic partyFound: boolean = false;\n\tpublic partyMembers: string[] = [];\n\n\tpublic isPartyBuffer: boolean = false;\n\tpublic isBuffBot: boolean = false;\n\tpublic sortPriority: number = 99;\n\n\tpublic innervateTarget: string | undefined;\n\tpublic powerInfusionTarget: string | undefined;\n\tpublic tricksOfTheTradeTarget: string | undefined;\n\n\tprivate simUI: RaidSimUI;\n\tprivate spec: Spec;\n\tprivate specType: string;\n\tprivate faction: Faction;\n\n\tconstructor(data: wclPlayer, simUI: RaidSimUI, faction: Faction = Faction.Unknown) {\n\t\tthis.simUI = simUI;\n\n\t\tthis.name = data.name;\n\t\tthis.gear = data.gear;\n\t\tthis.icon = data.icon;\n\t\tthis.id = data.id;\n\t\tthis.type = data.type;\n\t\tthis.talents = data.talents;\n\t\tthis.wclSpec = data.icon.split('-')[1];\n\t\tthis.faction = faction;\n\n\t\t// Prot Paladin's occasionally have a specType of 'Protection' instead of 'Justicar'?\n\t\tif (this.type === 'Paladin' && this.wclSpec === 'Protection') {\n\t\t\tthis.wclSpec = 'Justicar';\n\t\t}\n\n\t\tthis.spec = specNames[this.wclSpec];\n\t\tthis.specType = this.wclSpec + this.type;\n\n\t\tthis.isBuffBot = this.spec === undefined;\n\n\t\tthis.isPartyBuffer = this.getPartyAuraIds().length > 1;\n\n\t\tthis.sortPriority = specSortPriority[this.wclSpec] ?? 99;\n\t}\n\n\tpublic getPlayer(): PlayerProto | undefined {\n\n\t\tif (this.isBuffBot) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet player = PlayerProto.create();\n\n\t\tconst specFuncs = specTypeFunctions[this.spec];\n\n\t\tconst matchingPreset = this.getMatchingPreset();\n\n\t\tif (matchingPreset === undefined) {\n\t\t\tconsole.error('Could not find matching preset for non buff bot', {\n\t\t\t\t'name': this.name,\n\t\t\t\t'spec': this.spec,\n\t\t\t\t'type': this.type,\n\t\t\t\t'talents': this.talents,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tplayer = withSpecProto(this.spec, player, matchingPreset.rotation, specFuncs.talentsCreate(), matchingPreset.specOptions);\n\n\t\tplayer.talentsString = matchingPreset.talents.talentsString;\n\t\tplayer.glyphs = matchingPreset.talents.glyphs;\n\t\tplayer.consumes = matchingPreset.consumes;\n\n\t\tplayer.name = this.name;\n\t\tplayer.class = nameToClass(this.type);\n\t\tplayer.equipment = this.getEquipment();\n\t\tplayer.race = matchingPreset.defaultFactionRaces[this.faction];\n\n\t\tPlayer.applySharedDefaultsToProto(player);\n\n\t\treturn player;\n\t}\n\n\tpublic getBuffBot(): BuffBot | undefined {\n\n\t\tif (!this.isBuffBot) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst botID = buffBotNames[this.specType];\n\n\t\tif (botID == null) {\n\t\t\tconsole.error('Buff Bot Spec not implemented: ', this.specType);\n\t\t\treturn;\n\t\t}\n\n\t\tconst bot = BuffBot.create();\n\t\tbot.id = botID;\n\t\tbot.raidIndex = -1; // Default it for now. // numPlayers\n\n\t\treturn bot;\n\t}\n\n\tpublic getPartyAuraIds() {\n\n\t\tconst allSpecClassAuras: any = {\n\t\t\t'Paladin': [\n\t\t\t\t19746, // Concentration Aura\n\t\t\t\t27149, // Devotion Aura,\n\t\t\t\t27150, // Retribution Aura\n\t\t\t],\n\t\t\t'Warrior': [\n\t\t\t\t2048,  // Battle Shout\n\t\t\t\t469, // Commanding Shout\n\t\t\t],\n\t\t\t'Warlock': [\n\t\t\t\t27268, // Pet Imp: Blood Pact\n\t\t\t\t18696, // Improved Imp: Blood Pact\n\t\t\t],\n\t\t};\n\n\t\t// Reused for the plethora of Feral specs.\n\t\tconst feralDruidSpecAuras = [\n\t\t\t24932, // Improved Leader of the Pack // at least 0,32,0\n\t\t\t// 17007, // Leader of the Pack // at least 0,31,0\n\t\t];\n\n\t\t// TODO: Could additionally filter out buff IDs based on minimum req talent strings?\n\t\tconst specSpecificAuras: any = {\n\t\t\t'RetributionPaladin': [\n\t\t\t\t20092, // Improved Retribution Aura // at least 0,0,16\n\t\t\t\t20218, // Sanctity Aura // at least 0,0,21\n\t\t\t\t31870, // Improved Sanctity Aura // at least 0,0,22\n\t\t\t],\n\t\t\t'GuardianDruid': [...feralDruidSpecAuras],\n\t\t\t'WardenDruid': [...feralDruidSpecAuras],\n\t\t\t'FeralDruid': [...feralDruidSpecAuras],\n\t\t\t'BalanceDruid': [\n\t\t\t\t24907, // Moonkin Aura // at least 31,0,0\n\t\t\t],\n\t\t\t'RestorationDruid': [\n\t\t\t\t34123, // Tree of Life // at least 0,0,41\n\t\t\t],\n\t\t\t'MarksmanHunter': [\n\t\t\t\t27066, // Trueshot Aura // at least 0,32,0\n\t\t\t],\n\t\t\t'EnhancementShaman': [\n\t\t\t\t30811, // Unleashed Rage // at least 0,36,0\n\t\t\t],\n\t\t\t// 'ElementalShaman': [] // Totem buffs do not show up in logs. Leaving for future reference.\n\t\t};\n\n\t\tconst consumableAuras = [\n\t\t\t351355, // Greater Drums of Battle\n\t\t];\n\n\t\tconst classAuras = allSpecClassAuras[this.type] ?? [];\n\t\tconst specAuras = specSpecificAuras[this.specType] ?? [];\n\n\t\tconst reliableAuras = [\n\t\t\t...specAuras, ...classAuras, ...consumableAuras,\n\t\t];\n\n\t\tif (this.type === 'Shaman') {\n\t\t\t// Shamans get moved around a lot, so Heroism isn't a good reference for what group they are in.\n\t\t\treturn [\n\t\t\t\t...reliableAuras,\n\t\t\t\t32182, // Heroism\n\t\t\t];\n\t\t}\n\t\treturn reliableAuras;\n\t}\n\n\tprivate getMatchingPreset(): PresetSpecSettings<Spec> {\n\t\tconst matchingPresets = playerPresets.filter((preset) => preset.spec === this.spec);\n\t\tlet presetIdx = 0;\n\n\t\tif (matchingPresets && matchingPresets.length > 1) {\n\t\t\tlet distance = 100;\n\t\t\t// Search talents and find the preset that the players talents most closely match.\n\t\t\tmatchingPresets.forEach((preset, i) => {\n\t\t\t\tlet presetTalents = [0, 0, 0];\n\t\t\t\tlet talentIdx = 0;\n\t\t\t\t// First sum up the number of talents per tree for preset.\n\t\t\t\tArray.from(preset.talents.talentsString).forEach((v) => {\n\t\t\t\t\tif (v == '-') {\n\t\t\t\t\t\ttalentIdx++;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tpresetTalents[talentIdx] += parseInt(v);\n\t\t\t\t});\n\n\t\t\t\t// Diff the distance to the preset.\n\n\t\t\t\tconst newDistance = presetTalents.reduce((acc, v, i) => acc += Math.abs(this.talents[i]?.guid - presetTalents[i]), 0);\n\n\t\t\t\t// If this is the best distance, assign this preset.\n\t\t\t\tif (newDistance < distance) {\n\t\t\t\t\tpresetIdx = i;\n\t\t\t\t\tdistance = newDistance;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn matchingPresets[presetIdx];\n\t}\n\n\tprivate getEquipment(): EquipmentSpec {\n\t\tlet equipment = EquipmentSpec.create();\n\t\tequipment.items = new Array<ItemSpec>();\n\n\t\tthis.gear.forEach((gear) => {\n\t\t\tconst item = ItemSpec.create();\n\t\t\titem.id = gear.id;\n\t\t\tconst dbEnchant = this.simUI.sim.getEnchantFlexible(gear.permanentEnchant);\n\t\t\titem.enchant = dbEnchant\n\t\t\t\t? dbEnchant.id\n\t\t\t\t: 0;\n\t\t\tif (gear.gems) {\n\t\t\t\titem.gems = new Array<number>();\n\t\t\t\tgear.gems.forEach((gemInfo) => item.gems.push(gemInfo.id));\n\t\t\t}\n\t\t\tequipment!.items.push(item);\n\t\t});\n\t\treturn equipment;\n\t}\n\n}\n\n\n// Maps WCL spec to sorting priority for party makeup checks. Lower the number, the more likely the query will be successful.\nconst specSortPriority: Record<string, number> = {\n\t'Warden': 0,\n\t'Guardian': 1,\n\t'Feral': 2,\n\t'Balance': 3,\n\t'Justicar': 4,\n\t'Retribution': 5,\n\t'Fury': 6,\n\t'Arms': 7,\n\t'Protection': 8,\n\t'Enhancement': 9,\n\t'Destruction': 10,\n\t'Affliction': 11,\n\t'Demonology': 12,\n\t'Marksman': 13,\n};\n\n// Maps WCL spec names to internal Spec enum.\nconst specNames: Record<string, Spec> = {\n\t'Balance': Spec.SpecBalanceDruid,\n\t'Elemental': Spec.SpecElementalShaman,\n\t'Enhancement': Spec.SpecEnhancementShaman,\n\t'Feral': Spec.SpecFeralDruid,\n\t'Warden': Spec.SpecFeralTankDruid,\n\t'Guardian': Spec.SpecFeralTankDruid,\n\t'Survival': Spec.SpecHunter,\n\t'BeastMastery': Spec.SpecHunter,\n\t'Arcane': Spec.SpecMage,\n\t'Fire': Spec.SpecMage,\n\t'Frost': Spec.SpecMage,\n\t'Assassination': Spec.SpecRogue,\n\t'Combat': Spec.SpecRogue,\n\t'Retribution': Spec.SpecRetributionPaladin,\n\t'Justicar': Spec.SpecProtectionPaladin,\n\t'Shadow': Spec.SpecShadowPriest,\n\t'Smite': Spec.SpecSmitePriest,\n\t'Destruction': Spec.SpecWarlock,\n\t'Affliction': Spec.SpecWarlock,\n\t'Demonology': Spec.SpecWarlock,\n\t'Arms': Spec.SpecWarrior,\n\t'Fury': Spec.SpecWarrior,\n\t'Champion': Spec.SpecWarrior,\n\t'Warrior': Spec.SpecWarrior,\n\t'Gladiator': Spec.SpecWarrior,\n\t'Protection': Spec.SpecProtectionWarrior,\n};\n\n// Maps WCL spec+type to internal buff bot IDs.\nconst buffBotNames: Record<string, string> = {\n\t// Healers\n\t'HolyPaladin': 'Paladin',\n\t'HolyPriest': 'Holy Priest',\n\t'DisciplinePriest': 'Divine Spirit Priest',\n\t'RestorationDruid': 'Resto Druid',\n\t'DreamstateDruid': 'Resto Druid',\n\t'RestorationShaman': 'Resto Shaman',\n};\n\ninterface wclBuffCastsData {\n\tname: string;\n\ttargets: {\n\t\tname: string;\n\t\ttype: string;\n\t}[];\n}\n\ninterface wclRateLimitData {\n\tlimitPerHour: number,\n\tpointsSpentThisHour: number,\n\tpointsResetIn: number\n}\n\n// Typed interface for WCL talents\ninterface wclTalents {\n\tname: string;\n\tguid: number;\n\ttype: number;\n\tabilityIcon: string;\n}\n\n// Typed interface for WCL Gems\ninterface wclGems {\n\tid: number;\n\titemLevel: number;\n\ticon: string;\n}\n\n// Typed interface for WCL Gear\ninterface wclGear {\n\tid: number;\n\tslot: number;\n\tquality: number;\n\ticon: string;\n\tname: string;\n\titemLevel: number;\n\tpermanentEnchant: number;\n\tpermanentEnchantName: string;\n\ttemporaryEnchant: number;\n\tgems?: wclGems[];\n}\n\n// Typed interface for WCL Player Data\ninterface wclPlayer {\n\tname: string;\n\tid: number;\n\tguid?: number;\n\ttype: string; // Paladin, Mage, etc.\n\ticon: string; // Paladin-Justicar, Mage-Fire, etc.\n\titemLevel?: number;\n\ttotal?: number;\n\tactiveTime?: number;\n\tactiveTimeReduced?: number;\n\tabilities?: unknown[]; // Don't care about abilities.\n\tdamageAbilities?: unknown[];\n\ttargets?: unknown[];\n\ttalents: wclTalents[];\n\tgear: wclGear[];\n}\n\n// Typed interface for WoWSimPlayer class\ninterface wclSimPlayer extends wclPlayer {\n\twclSpec: string;\n\tpartyAssigned: boolean;\n\tisPartyBuffer: boolean;\n\tpartyMembers: string[];\n\tisBuffBot: boolean;\n}\n\ninterface wclAura {\n\tname: string;\n\tid: number;\n\tguid: number;\n\ttype: string;\n\ticon: string;\n\ttotalUptime: number;\n\ttotalUses: number;\n\tbands: {\n\t\tstartTime: number,\n\t\tendTime: number,\n\t}[];\n}\n","import { CloseButton } from '../core/components/close_button.js';\nimport { Component } from '../core/components/component.js';\nimport { EnumPicker } from '../core/components/enum_picker.js';\nimport { makePhaseSelector } from '../core/components/other_inputs.js';\nimport { Raid } from '../core/raid.js';\nimport { MAX_PARTY_SIZE } from '../core/party.js';\nimport { Party } from '../core/party.js';\nimport { Player } from '../core/player.js';\nimport { Player as PlayerProto } from '../core/proto/api.js';\nimport { Encounter as EncounterProto } from '../core/proto/common.js';\nimport { Raid as RaidProto } from '../core/proto/api.js';\nimport { Party as PartyProto } from '../core/proto/api.js';\nimport { Class } from '../core/proto/common.js';\nimport { Profession } from '../core/proto/common.js';\nimport { Race } from '../core/proto/common.js';\nimport { Spec } from '../core/proto/common.js';\nimport { Faction } from '../core/proto/common.js';\nimport { Glyphs } from '../core/proto/common.js';\nimport { BuffBot as BuffBotProto } from '../core/proto/ui.js';\nimport { playerToSpec, specNames } from '../core/proto_utils/utils.js';\nimport { classColors } from '../core/proto_utils/utils.js';\nimport { isTankSpec } from '../core/proto_utils/utils.js';\nimport { specToClass } from '../core/proto_utils/utils.js';\nimport { newRaidTarget } from '../core/proto_utils/utils.js';\nimport { EventID, TypedEvent } from '../core/typed_event.js';\nimport { camelToSnakeCase } from '../core/utils.js';\nimport { formatDeltaTextElem } from '../core/utils.js';\nimport { getEnumValues } from '../core/utils.js';\nimport { hexToRgba } from '../core/utils.js';\n\nimport { BuffBot } from './buff_bot.js';\nimport { RaidSimUI } from './raid_sim_ui.js';\nimport { buffBotPresets, playerPresets, specSimFactories } from './presets.js';\n\nimport { BalanceDruid_Options as BalanceDruidOptions } from '../core/proto/druid.js';\nimport { SmitePriest_Options as SmitePriestOptions } from '../core/proto/priest.js';\nimport { MessageType } from '@protobuf-ts/runtime';\n\ndeclare var tippy: any;\ndeclare var $: any;\n\nconst NEW_PLAYER: number = -1;\n\nenum DragType {\n\tNone,\n\tNew,\n\tMove,\n\tSwap,\n\tCopy,\n}\n\nexport class RaidPicker extends Component {\n\treadonly raidSimUI: RaidSimUI;\n\treadonly raid: Raid;\n\treadonly partyPickers: Array<PartyPicker>;\n\treadonly newPlayerPicker: NewPlayerPicker;\n\n\t// Hold data about the player being dragged while the drag is happening.\n\tcurrentDragPlayer: Player<any> | BuffBot | null = null;\n\tcurrentDragPlayerFromIndex: number = NEW_PLAYER;\n\tcurrentDragType: DragType = DragType.New;\n\n\tconstructor(parent: HTMLElement, raidSimUI: RaidSimUI) {\n\t\tsuper(parent, 'raid-picker-root');\n\t\tthis.raidSimUI = raidSimUI;\n\t\tthis.raid = raidSimUI.sim.raid;\n\n\t\tconst raidViewer = document.createElement('div');\n\t\traidViewer.classList.add('current-raid-viewer');\n\t\tthis.rootElem.appendChild(raidViewer);\n\t\traidViewer.innerHTML = `\n\t\t\t<div class=\"parties-container\">\n\t\t\t</div>\n\t\t`;\n\n\t\tconst partiesContainer = this.rootElem.getElementsByClassName('parties-container')[0] as HTMLDivElement;\n\t\tthis.partyPickers = this.raid.getParties().map((party, i) => new PartyPicker(partiesContainer, party, i, this));\n\n\t\tconst newPlayerPickerRoot = document.createElement('div');\n\t\tnewPlayerPickerRoot.classList.add('new-player-picker');\n\t\tthis.rootElem.appendChild(newPlayerPickerRoot);\n\n\t\tthis.newPlayerPicker = new NewPlayerPicker(newPlayerPickerRoot, this);\n\n\t\tthis.rootElem.ondragend = event => {\n\t\t\t// Uncomment to remove player when dropped 'off' the raid.\n\t\t\t//if (this.currentDragPlayerFromIndex != NEW_PLAYER) {\n\t\t\t//\tconst playerPicker = this.getPlayerPicker(this.currentDragPlayerFromIndex);\n\t\t\t//\tplayerPicker.setPlayer(null, null, DragType.None);\n\t\t\t//}\n\n\t\t\tthis.clearDragPlayer();\n\t\t};\n\t}\n\n\tgetCurrentFaction(): Faction {\n\t\treturn this.raid.sim.getFaction();\n\t}\n\n\tgetCurrentPhase(): number {\n\t\treturn this.raid.sim.getPhase();\n\t}\n\n\tgetPlayerPicker(raidIndex: number): PlayerPicker {\n\t\treturn this.partyPickers[Math.floor(raidIndex / MAX_PARTY_SIZE)].playerPickers[raidIndex % MAX_PARTY_SIZE];\n\t}\n\n\tgetPlayerPickers(): Array<PlayerPicker> {\n\t\treturn [...new Array(25).keys()].map(i => this.getPlayerPicker(i));\n\t}\n\n\tgetBuffBots(): Array<BuffBot> {\n\t\treturn this.getPlayerPickers()\n\t\t\t.filter(picker => picker.player instanceof BuffBot)\n\t\t\t.map(picker => picker.player as BuffBot);\n\t}\n\n\tsetBuffBots(eventID: EventID, newBuffBotProtos: Array<BuffBotProto>) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.getBuffBots().forEach(buffBot => this.getPlayerPicker(buffBot.getRaidIndex()).setPlayer(eventID, null, DragType.None));\n\n\t\t\tnewBuffBotProtos.forEach(buffBotProto => {\n\t\t\t\tconst settings = buffBotPresets.find(preset => preset.buffBotId == buffBotProto.id);\n\t\t\t\tif (!settings) {\n\t\t\t\t\tconsole.warn('Invalid buff bot ID: ' + buffBotProto.id);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst buffBot = new BuffBot(buffBotProto.id, this.raid.sim);\n\t\t\t\tbuffBot.fromProto(eventID, buffBotProto);\n\t\t\t\tthis.getPlayerPicker(buffBotProto.raidIndex).setPlayer(eventID, buffBot, DragType.None);\n\t\t\t});\n\t\t});\n\t}\n\n\tsetDragPlayer(player: Player<any> | BuffBot, fromIndex: number, type: DragType) {\n\t\tthis.clearDragPlayer();\n\n\t\tthis.currentDragPlayer = player;\n\t\tthis.currentDragPlayerFromIndex = fromIndex;\n\t\tthis.currentDragType = type;\n\n\t\tif (fromIndex != NEW_PLAYER) {\n\t\t\tconst playerPicker = this.getPlayerPicker(fromIndex);\n\t\t\tplayerPicker.rootElem.classList.add('dragFrom');\n\t\t}\n\t}\n\n\tclearDragPlayer() {\n\t\tif (this.currentDragPlayerFromIndex != NEW_PLAYER) {\n\t\t\tconst playerPicker = this.getPlayerPicker(this.currentDragPlayerFromIndex);\n\t\t\tplayerPicker.rootElem.classList.remove('dragFrom');\n\t\t}\n\n\t\tthis.currentDragPlayer = null;\n\t\tthis.currentDragPlayerFromIndex = NEW_PLAYER;\n\t\tthis.currentDragType = DragType.New;\n\t}\n}\n\nexport class PartyPicker extends Component {\n\treadonly party: Party;\n\treadonly index: number;\n\treadonly raidPicker: RaidPicker;\n\treadonly playerPickers: Array<PlayerPicker>;\n\n\tconstructor(parent: HTMLElement, party: Party, index: number, raidPicker: RaidPicker) {\n\t\tsuper(parent, 'party-picker-root');\n\t\tthis.party = party;\n\t\tthis.index = index;\n\t\tthis.raidPicker = raidPicker;\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"party-header\">\n\t\t\t\t<span>Group ${index + 1}</span>\n\t\t\t\t<div class=\"party-results\">\n\t\t\t\t\t<span class=\"party-results-dps\"></span>\n\t\t\t\t\t<span class=\"party-results-reference-delta\"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"players-container\">\n\t\t\t</div>\n\t\t`;\n\n\t\tconst playersContainer = this.rootElem.getElementsByClassName('players-container')[0] as HTMLDivElement;\n\t\tthis.playerPickers = [...Array(MAX_PARTY_SIZE).keys()].map(i => new PlayerPicker(playersContainer, this, i));\n\n\t\tconst dpsResultElem = this.rootElem.getElementsByClassName('party-results-dps')[0] as HTMLElement;\n\t\tconst referenceDeltaElem = this.rootElem.getElementsByClassName('party-results-reference-delta')[0] as HTMLElement;\n\n\t\tthis.raidPicker.raidSimUI.referenceChangeEmitter.on(() => {\n\t\t\tconst currentData = this.raidPicker.raidSimUI.getCurrentData();\n\t\t\tconst referenceData = this.raidPicker.raidSimUI.getReferenceData();\n\n\t\t\tconst partyDps = currentData?.simResult.raidMetrics.parties[this.index].dps.avg || 0;\n\t\t\tconst referenceDps = referenceData?.simResult.raidMetrics.parties[this.index].dps.avg || 0;\n\n\t\t\tif (partyDps == 0 && referenceDps == 0) {\n\t\t\t\tdpsResultElem.textContent = '';\n\t\t\t\treferenceDeltaElem.textContent = '';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdpsResultElem.textContent = partyDps.toFixed(1);\n\n\t\t\tif (!referenceData) {\n\t\t\t\treferenceDeltaElem.textContent = '';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tformatDeltaTextElem(referenceDeltaElem, referenceDps, partyDps, 1);\n\t\t});\n\t}\n}\n\nexport class PlayerPicker extends Component {\n\t// Index of this player within its party (0-4).\n\treadonly index: number;\n\n\t// Index of this player within the whole raid (0-24).\n\treadonly raidIndex: number;\n\n\tplayer: Player<any> | BuffBot | null;\n\n\treadonly partyPicker: PartyPicker;\n\treadonly raidPicker: RaidPicker;\n\n\tprivate readonly labelElem: HTMLElement;\n\tprivate readonly iconElem: HTMLImageElement;\n\tprivate readonly nameElem: HTMLSpanElement;\n\tprivate readonly resultsElem: HTMLElement;\n\tprivate readonly dpsResultElem: HTMLElement;\n\tprivate readonly referenceDeltaElem: HTMLElement;\n\n\tconstructor(parent: HTMLElement, partyPicker: PartyPicker, index: number) {\n\t\tsuper(parent, 'player-picker-root');\n\t\tthis.index = index;\n\t\tthis.raidIndex = partyPicker.index * MAX_PARTY_SIZE + index;\n\t\tthis.player = null;\n\t\tthis.partyPicker = partyPicker;\n\t\tthis.raidPicker = partyPicker.raidPicker;\n\n\t\tthis.partyPicker.party.compChangeEmitter.on(eventID => {\n\t\t\tconst newPlayer = this.partyPicker.party.getPlayer(this.index);\n\t\t\tif (newPlayer != this.player && !(newPlayer == null && this.player instanceof BuffBot)) {\n\t\t\t\tthis.setPlayer(eventID, newPlayer, DragType.None);\n\t\t\t}\n\t\t});\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"player-label\">\n\t\t\t\t<img class=\"player-icon\"></img>\n\t\t\t\t<span class=\"player-name\" contenteditable></span>\n\t\t\t</div>\n\t\t\t<div class=\"player-spacer\">\n\t\t\t</div>\n\t\t\t<div class=\"player-options\">\n\t\t\t\t<span class=\"player-edit fa fa-edit\"></span>\n\t\t\t\t<span class=\"player-copy fa fa-copy\" draggable=\"true\"></span>\n\t\t\t\t<span class=\"player-delete fa fa-times\"></span>\n\t\t\t</div>\n\t\t\t<div class=\"player-results\">\n\t\t\t\t<span class=\"player-results-dps\"></span>\n\t\t\t\t<span class=\"player-results-reference-delta\"></span>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.labelElem = this.rootElem.getElementsByClassName('player-label')[0] as HTMLElement;\n\t\tthis.iconElem = this.rootElem.getElementsByClassName('player-icon')[0] as HTMLImageElement;\n\t\tthis.nameElem = this.rootElem.getElementsByClassName('player-name')[0] as HTMLSpanElement;\n\t\tthis.resultsElem = this.rootElem.getElementsByClassName('player-results')[0] as HTMLElement;\n\t\tthis.dpsResultElem = this.rootElem.getElementsByClassName('player-results-dps')[0] as HTMLElement;\n\t\tthis.referenceDeltaElem = this.rootElem.getElementsByClassName('player-results-reference-delta')[0] as HTMLElement;\n\n\t\tthis.nameElem.addEventListener('input', event => {\n\t\t\tif (this.player instanceof Player) {\n\t\t\t\tthis.player.setName(TypedEvent.nextEventID(), this.nameElem.textContent || '');\n\t\t\t}\n\t\t});\n\n\t\tconst maxLength = 15;\n\t\tthis.nameElem.addEventListener('keydown', event => {\n\t\t\t// 9 is tab, 13 is enter\n\t\t\tif (event.keyCode == 9 || event.keyCode == 13) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst realPlayerPickers = this.raidPicker.getPlayerPickers().filter(pp => pp.player instanceof Player);\n\t\t\t\tconst indexOfThis = realPlayerPickers.indexOf(this);\n\t\t\t\tif (indexOfThis != -1 && realPlayerPickers.length > indexOfThis + 1) {\n\t\t\t\t\trealPlayerPickers[indexOfThis + 1].nameElem.focus();\n\t\t\t\t} else {\n\t\t\t\t\tthis.nameElem.blur();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// escape\n\t\t\tif (event.keyCode == 27) {\n\t\t\t\tthis.nameElem.blur();\n\t\t\t}\n\n\t\t\t// 8 is backspace, 46 is delete, \n\t\t\tif ((event.keyCode != 8 && event.keyCode != 46) && (this.nameElem.textContent?.length || 0) >= maxLength) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t});\n\n\t\tconst emptyName = 'Unnamed';\n\t\tthis.nameElem.addEventListener('focusin', event => {\n\t\t\tconst selection = window.getSelection();\n\t\t\tif (selection) {\n\t\t\t\tconst range = document.createRange();\n\t\t\t\trange.selectNodeContents(this.nameElem);\n\t\t\t\tselection.removeAllRanges();\n\t\t\t\tselection.addRange(range);\n\t\t\t}\n\t\t});\n\t\tthis.nameElem.addEventListener('focusout', event => {\n\t\t\tif (!this.nameElem.textContent) {\n\t\t\t\tthis.nameElem.textContent = emptyName;\n\t\t\t\tif (this.player instanceof Player) {\n\t\t\t\t\tthis.player.setName(TypedEvent.nextEventID(), emptyName);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst dragStart = (event: DragEvent, type: DragType) => {\n\t\t\tif (this.player == null) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tevent.dataTransfer!.dropEffect = 'move';\n\t\t\tevent.dataTransfer!.effectAllowed = 'all';\n\n\t\t\tconst iconSrc = this.iconElem.src;\n\t\t\tconst dragImage = new Image();\n\t\t\tdragImage.src = iconSrc;\n\t\t\tevent.dataTransfer!.setDragImage(dragImage, 30, 30);\n\t\t\tif (this.player instanceof Player) {\n\t\t\t\tvar playerDataProto = this.player.toProto(true);\n\t\t\t\tevent.dataTransfer!.setData(\"text/plain\", btoa(String.fromCharCode(...PlayerProto.toBinary(playerDataProto))));\n\t\t\t}\n\t\t\tthis.raidPicker.setDragPlayer(this.player, this.raidIndex, type);\n\t\t};\n\n\t\tthis.labelElem.ondragstart = event => {\n\t\t\tdragStart(event, DragType.Swap);\n\t\t};\n\t\tthis.resultsElem.ondragstart = event => {\n\t\t\tdragStart(event, DragType.Swap);\n\t\t};\n\n\t\tconst copyElem = this.rootElem.getElementsByClassName('player-copy')[0] as HTMLSpanElement;\n\t\ttippy(copyElem, {\n\t\t\t'content': 'Drag to Copy',\n\t\t\t'allowHTML': true,\n\t\t});\n\t\tcopyElem.ondragstart = event => {\n\t\t\tdragStart(event, DragType.Copy);\n\t\t};\n\n\t\tconst deleteElem = this.rootElem.getElementsByClassName('player-delete')[0] as HTMLSpanElement;\n\t\ttippy(deleteElem, {\n\t\t\t'content': 'Click to Delete',\n\t\t\t'allowHTML': true,\n\t\t});\n\t\tdeleteElem.addEventListener('click', event => {\n\t\t\tthis.setPlayer(TypedEvent.nextEventID(), null, DragType.None);\n\t\t});\n\n\t\tlet dragEnterCounter = 0;\n\t\tthis.rootElem.ondragenter = event => {\n\t\t\tevent.preventDefault();\n\t\t\tdragEnterCounter++;\n\t\t\tthis.rootElem.classList.add('dragto');\n\t\t};\n\t\tthis.rootElem.ondragleave = event => {\n\t\t\tevent.preventDefault();\n\t\t\tdragEnterCounter--;\n\t\t\tif (dragEnterCounter <= 0) {\n\t\t\t\tthis.rootElem.classList.remove('dragto');\n\t\t\t}\n\t\t};\n\t\tthis.rootElem.ondragover = event => {\n\t\t\tevent.preventDefault();\n\t\t};\n\t\tthis.rootElem.ondrop = event => {\n\t\t\tvar dropData = event.dataTransfer!.getData(\"text/plain\");\n\n\t\t\tevent.preventDefault();\n\t\t\tdragEnterCounter = 0;\n\t\t\tthis.rootElem.classList.remove('dragto');\n\n\t\t\tconst eventID = TypedEvent.nextEventID();\n\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\tif (this.raidPicker.currentDragPlayer == null && dropData.length == 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.raidPicker.currentDragPlayerFromIndex == this.raidIndex) {\n\t\t\t\t\tthis.raidPicker.clearDragPlayer();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst dragType = this.raidPicker.currentDragType;\n\n\t\t\t\tif (this.raidPicker.currentDragPlayerFromIndex != NEW_PLAYER) {\n\t\t\t\t\tconst fromPlayerPicker = this.raidPicker.getPlayerPicker(this.raidPicker.currentDragPlayerFromIndex);\n\t\t\t\t\tif (dragType == DragType.Swap) {\n\t\t\t\t\t\tfromPlayerPicker.setPlayer(eventID, this.player, dragType);\n\t\t\t\t\t\tvar myicon = this.iconElem.src\n\t\t\t\t\t\tthis.iconElem.src = fromPlayerPicker.iconElem.src;\n\t\t\t\t\t\tfromPlayerPicker.iconElem.src = myicon;\n\t\t\t\t\t} else if (dragType == DragType.Move) {\n\t\t\t\t\t\tthis.iconElem.src = fromPlayerPicker.iconElem.src;\n\t\t\t\t\t\tfromPlayerPicker.setPlayer(eventID, null, dragType);\n\t\t\t\t\t}\n\t\t\t\t} else if (this.raidPicker.currentDragPlayer == null) {\n\t\t\t\t\t// This would be a copy from another window.\n\t\t\t\t\tconst binary = atob(dropData);\n\t\t\t\t\tconst bytes = new Uint8Array(binary.length);\n\t\t\t\t\tfor (let i = 0; i < bytes.length; i++) {\n\t\t\t\t\t\tbytes[i] = binary.charCodeAt(i);\n\t\t\t\t\t}\n\t\t\t\t\tconst playerProto = PlayerProto.fromBinary(bytes);\n\n\t\t\t\t\tvar localPlayer = new Player(playerToSpec(playerProto), this.raidPicker.raidSimUI.sim);\n\t\t\t\t\tlocalPlayer.fromProto(eventID, playerProto);\n\t\t\t\t\tthis.raidPicker.currentDragPlayer = localPlayer;\n\t\t\t\t}\n\n\t\t\t\tif (dragType == DragType.Copy) {\n\t\t\t\t\tthis.setPlayer(eventID, this.raidPicker.currentDragPlayer!.clone(eventID), dragType);\n\t\t\t\t} else {\n\t\t\t\t\tthis.setPlayer(eventID, this.raidPicker.currentDragPlayer, dragType);\n\t\t\t\t}\n\n\t\t\t\tif (this.iconElem.src == \"\") {\n\t\t\t\t\tthis.iconElem.src = playerPresets.filter(preset => {\n\t\t\t\t\t\treturn preset.spec == localPlayer.spec;\n\t\t\t\t\t})[0].iconUrl;\n\t\t\t\t}\n\n\t\t\t\tthis.raidPicker.clearDragPlayer();\n\t\t\t});\n\t\t};\n\n\t\tconst editElem = this.rootElem.getElementsByClassName('player-edit')[0] as HTMLSpanElement;\n\t\ttippy(editElem, {\n\t\t\t'content': 'Edit',\n\t\t\t'allowHTML': true,\n\t\t});\n\t\teditElem.addEventListener('click', event => {\n\t\t\tif (this.player instanceof Player) {\n\t\t\t\tnew PlayerEditorModal(this.player);\n\t\t\t}\n\t\t});\n\n\t\tthis.raidPicker.raidSimUI.referenceChangeEmitter.on(() => {\n\t\t\tconst currentData = this.raidPicker.raidSimUI.getCurrentData();\n\t\t\tconst referenceData = this.raidPicker.raidSimUI.getReferenceData();\n\n\t\t\tconst playerDps = currentData?.simResult.getDamageMetrics({ player: this.raidIndex }).avg || 0;\n\t\t\tconst referenceDps = referenceData?.simResult.getDamageMetrics({ player: this.raidIndex }).avg || 0;\n\n\t\t\tif (playerDps == 0 && referenceDps == 0) {\n\t\t\t\tthis.dpsResultElem.textContent = '';\n\t\t\t\tthis.referenceDeltaElem.textContent = '';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dpsResultElem.textContent = playerDps.toFixed(1);\n\n\t\t\tif (!referenceData) {\n\t\t\t\tthis.referenceDeltaElem.textContent = '';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tformatDeltaTextElem(this.referenceDeltaElem, referenceDps, playerDps, 1);\n\t\t});\n\n\t\tthis.update();\n\t}\n\n\tsetPlayer(eventID: EventID, newPlayer: Player<any> | BuffBot | null, dragType: DragType) {\n\t\tif (newPlayer == this.player) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.dpsResultElem.textContent = '';\n\t\tthis.referenceDeltaElem.textContent = '';\n\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.player = newPlayer;\n\t\t\tif (newPlayer instanceof BuffBot) {\n\t\t\t\tthis.partyPicker.party.setPlayer(eventID, this.index, null);\n\t\t\t\tnewPlayer.setRaidIndex(eventID, this.raidIndex);\n\t\t\t} else if (newPlayer instanceof Player) {\n\t\t\t\tthis.partyPicker.party.setPlayer(eventID, this.index, newPlayer);\n\n\t\t\t\tif (dragType == DragType.New) {\n\t\t\t\t\tif (isTankSpec(newPlayer.spec)) {\n\t\t\t\t\t\tconst tanks = this.raidPicker.raid.getTanks();\n\t\t\t\t\t\tconst emptyIdx = tanks.findIndex(tank => this.raidPicker.raid.getPlayerFromRaidTarget(tank) == null);\n\t\t\t\t\t\tif (emptyIdx == -1) {\n\t\t\t\t\t\t\tif (tanks.length < 3) {\n\t\t\t\t\t\t\t\tthis.raidPicker.raid.setTanks(eventID, tanks.concat([newPlayer.makeRaidTarget()]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttanks[emptyIdx] = newPlayer.makeRaidTarget();\n\t\t\t\t\t\t\tthis.raidPicker.raid.setTanks(eventID, tanks);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// On creation, boomies should default to innervating themselves.\n\t\t\t\t\tif (newPlayer.spec == Spec.SpecBalanceDruid) {\n\t\t\t\t\t\tsetBalanceDruidSelfInnervate(eventID, newPlayer);\n\t\t\t\t\t} else if (newPlayer.spec == Spec.SpecSmitePriest) {\n\t\t\t\t\t\tsetSmitePriestSelfPI(eventID, newPlayer);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.partyPicker.party.setPlayer(eventID, this.index, newPlayer);\n\t\t\t\tthis.partyPicker.party.compChangeEmitter.emit(eventID);\n\t\t\t}\n\t\t});\n\n\t\tthis.update();\n\t}\n\n\tprivate update() {\n\t\tif (this.player == null) {\n\t\t\tthis.rootElem.classList.add('empty');\n\t\t\tthis.rootElem.classList.remove('buff-bot');\n\t\t\tthis.rootElem.style.backgroundColor = 'black';\n\t\t\tthis.labelElem.setAttribute('draggable', 'false');\n\t\t\tthis.resultsElem.setAttribute('draggable', 'false');\n\t\t\tthis.nameElem.textContent = '';\n\t\t\tthis.nameElem.removeAttribute('contenteditable');\n\t\t} else if (this.player instanceof BuffBot) {\n\t\t\tthis.rootElem.classList.remove('empty');\n\t\t\tthis.rootElem.classList.add('buff-bot');\n\t\t\tthis.rootElem.style.backgroundColor = classColors[specToClass[this.player.spec]];\n\t\t\tthis.labelElem.setAttribute('draggable', 'true');\n\t\t\tthis.resultsElem.setAttribute('draggable', 'true');\n\t\t\tthis.nameElem.textContent = this.player.name;\n\t\t\tthis.nameElem.removeAttribute('contenteditable');\n\t\t\tthis.iconElem.src = this.player.settings.iconUrl;\n\t\t} else {\n\t\t\tthis.rootElem.classList.remove('empty');\n\t\t\tthis.rootElem.classList.remove('buff-bot');\n\t\t\tthis.rootElem.style.backgroundColor = this.player.getClassColor();\n\t\t\tthis.labelElem.setAttribute('draggable', 'true');\n\t\t\tthis.resultsElem.setAttribute('draggable', 'true');\n\t\t\tthis.nameElem.textContent = this.player.getName();\n\t\t\tthis.nameElem.setAttribute('contenteditable', '');\n\t\t\tthis.iconElem.src = this.player.getTalentTreeIcon();\n\t\t}\n\t}\n}\n\nclass PlayerEditorModal extends Component {\n\tconstructor(player: Player<any>) {\n\t\tsuper(document.body, 'player-editor-modal');\n\n\t\tthis.rootElem.id = 'playerEditorModal';\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"player-editor within-raid-sim\">\n\t\t\t</div>\n\t\t`;\n\n\t\tnew CloseButton(this.rootElem, () => {\n\t\t\t$('#playerEditorModal').bPopup().close();\n\t\t\tthis.rootElem.remove();\n\t\t});\n\n\t\tconst editorRoot = this.rootElem.getElementsByClassName('player-editor')[0] as HTMLElement;\n\t\tconst individualSim = specSimFactories[player.spec]!(editorRoot, player);\n\n\t\t$('#playerEditorModal').bPopup({\n\t\t\tcloseClass: 'player-editor-close',\n\t\t\tonClose: () => {\n\t\t\t\tthis.rootElem.remove();\n\t\t\t},\n\t\t});\n\t}\n}\n\nclass NewPlayerPicker extends Component {\n\treadonly raidPicker: RaidPicker;\n\n\tconstructor(parent: HTMLElement, raidPicker: RaidPicker) {\n\t\tsuper(parent, 'new-player-picker-root');\n\t\tthis.raidPicker = raidPicker;\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"new-player-picker-controls\">\n\t\t\t\t<div class=\"faction-selector\"></div>\n\t\t\t\t<div class=\"phase-selector\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"presets-container\"></div>\n\t\t\t<div class=\"buff-bots-container\">\n\t\t\t\t<div class=\"buff-bots-title\">\n\t\t\t\t\t<span class=\"buff-bots-title-text\">Buff Bots</span>\n\t\t\t\t\t<span class=\"buff-bots-tooltip fa fa-info-circle\"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst factionSelector = new EnumPicker<NewPlayerPicker>(this.rootElem.getElementsByClassName('faction-selector')[0] as HTMLElement, this, {\n\t\t\tlabel: 'Faction',\n\t\t\tlabelTooltip: 'Default faction for newly-created players.',\n\t\t\tvalues: [\n\t\t\t\t{ name: 'Alliance', value: Faction.Alliance },\n\t\t\t\t{ name: 'Horde', value: Faction.Horde },\n\t\t\t],\n\t\t\tchangedEvent: (picker: NewPlayerPicker) => this.raidPicker.raid.sim.factionChangeEmitter,\n\t\t\tgetValue: (picker: NewPlayerPicker) => this.raidPicker.raid.sim.getFaction(),\n\t\t\tsetValue: (eventID: EventID, picker: NewPlayerPicker, newValue: Faction) => {\n\t\t\t\tthis.raidPicker.raid.sim.setFaction(eventID, newValue);\n\t\t\t},\n\t\t});\n\n\t\tconst phaseSelector = new EnumPicker<NewPlayerPicker>(this.rootElem.getElementsByClassName('phase-selector')[0] as HTMLElement, this, {\n\t\t\tlabel: 'Phase',\n\t\t\tlabelTooltip: 'Newly-created players will start with approximate BIS gear from this phase.',\n\t\t\tvalues: [\n\t\t\t\t{ name: '1', value: 1 },\n\t\t\t\t// Presets aren't filled for most roles so disable these options for now.\n\t\t\t\t//{ name: '2', value: 2 },\n\t\t\t\t//{ name: '3', value: 3 },\n\t\t\t\t//{ name: '4', value: 4 },\n\t\t\t\t//{ name: '5', value: 5 },\n\t\t\t],\n\t\t\tchangedEvent: (picker: NewPlayerPicker) => this.raidPicker.raid.sim.phaseChangeEmitter,\n\t\t\tgetValue: (picker: NewPlayerPicker) => this.raidPicker.raid.sim.getPhase(),\n\t\t\tsetValue: (eventID: EventID, picker: NewPlayerPicker, newValue: number) => {\n\t\t\t\tthis.raidPicker.raid.sim.setPhase(eventID, newValue);\n\t\t\t},\n\t\t});\n\n\t\tconst presetsContainer = this.rootElem.getElementsByClassName('presets-container')[0] as HTMLElement;\n\t\tgetEnumValues(Class).forEach(wowClass => {\n\t\t\tif (wowClass == Class.ClassUnknown) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst matchingPresets = playerPresets.filter(preset => specToClass[preset.spec] == wowClass);\n\t\t\tif (matchingPresets.length == 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst classPresetsContainer = document.createElement('div');\n\t\t\tclassPresetsContainer.classList.add('class-presets-container');\n\t\t\tpresetsContainer.appendChild(classPresetsContainer);\n\t\t\tclassPresetsContainer.style.backgroundColor = hexToRgba(classColors[wowClass as Class], 0.5);\n\n\t\t\tmatchingPresets.forEach(matchingPreset => {\n\t\t\t\tconst presetElem = document.createElement('div');\n\t\t\t\tpresetElem.classList.add('preset-picker');\n\t\t\t\tclassPresetsContainer.appendChild(presetElem);\n\n\t\t\t\tconst presetIconElem = document.createElement('img');\n\t\t\t\tpresetIconElem.classList.add('preset-picker-icon');\n\t\t\t\tpresetElem.appendChild(presetIconElem);\n\t\t\t\tpresetIconElem.src = matchingPreset.iconUrl;\n\t\t\t\ttippy(presetIconElem, {\n\t\t\t\t\t'content': matchingPreset.tooltip,\n\t\t\t\t\t'allowHTML': true,\n\t\t\t\t});\n\n\t\t\t\tpresetElem.setAttribute('draggable', 'true');\n\t\t\t\tpresetElem.ondragstart = event => {\n\t\t\t\t\tconst eventID = TypedEvent.nextEventID();\n\t\t\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\t\t\tconst dragImage = new Image();\n\t\t\t\t\t\tdragImage.src = matchingPreset.iconUrl;\n\t\t\t\t\t\tevent.dataTransfer!.setDragImage(dragImage, 30, 30);\n\t\t\t\t\t\tevent.dataTransfer!.setData(\"text/plain\", \"\");\n\t\t\t\t\t\tevent.dataTransfer!.dropEffect = 'copy';\n\n\n\t\t\t\t\t\tconst newPlayer = new Player(matchingPreset.spec, this.raidPicker.raid.sim);\n\t\t\t\t\t\tnewPlayer.applySharedDefaults(eventID);\n\t\t\t\t\t\tnewPlayer.setRace(eventID, matchingPreset.defaultFactionRaces[this.raidPicker.getCurrentFaction()]);\n\t\t\t\t\t\tnewPlayer.setRotation(eventID, matchingPreset.rotation);\n\t\t\t\t\t\tnewPlayer.setTalentsString(eventID, matchingPreset.talents.talentsString);\n\t\t\t\t\t\tnewPlayer.setGlyphs(eventID, matchingPreset.talents.glyphs || Glyphs.create());\n\t\t\t\t\t\tnewPlayer.setSpecOptions(eventID, matchingPreset.specOptions);\n\t\t\t\t\t\tnewPlayer.setConsumes(eventID, matchingPreset.consumes);\n\t\t\t\t\t\tnewPlayer.setName(eventID, matchingPreset.defaultName);\n\t\t\t\t\t\tnewPlayer.setProfession1(eventID, matchingPreset.otherDefaults?.profession1 || Profession.Engineering);\n\t\t\t\t\t\tnewPlayer.setProfession2(eventID, matchingPreset.otherDefaults?.profession2 || Profession.Jewelcrafting);\n\t\t\t\t\t\tnewPlayer.setDistanceFromTarget(eventID, matchingPreset.otherDefaults?.distanceFromTarget || 0);\n\n\t\t\t\t\t\t// Need to wait because the gear might not be loaded yet.\n\t\t\t\t\t\tthis.raidPicker.raid.sim.waitForInit().then(() => {\n\t\t\t\t\t\t\tnewPlayer.setGear(\n\t\t\t\t\t\t\t\teventID,\n\t\t\t\t\t\t\t\tthis.raidPicker.raid.sim.lookupEquipmentSpec(\n\t\t\t\t\t\t\t\t\tmatchingPreset.defaultGear[this.raidPicker.getCurrentFaction()][this.raidPicker.getCurrentPhase()]));\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.raidPicker.setDragPlayer(newPlayer, NEW_PLAYER, DragType.New);\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\n\t\tconst buffbotsTooltip = this.rootElem.getElementsByClassName('buff-bots-tooltip')[0] as HTMLElement;\n\t\ttippy(buffbotsTooltip, {\n\t\t\t'content': 'Buff bots do not do DPS or any actions at all, except to buff their raid/party members. They are used as placeholders for classes we haven\\'t implemented yet, or never will (e.g. healers) so that a proper raid environment can still be simulated.',\n\t\t\t'allowHTML': true,\n\t\t});\n\n\t\tconst buffbotsContainer = this.rootElem.getElementsByClassName('buff-bots-container')[0] as HTMLElement;\n\t\tgetEnumValues(Class).forEach(wowClass => {\n\t\t\tif (wowClass == Class.ClassUnknown) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst matchingBuffBots = buffBotPresets\n\t\t\t\t.filter(buffBot => specToClass[buffBot.spec] == wowClass)\n\t\t\t\t.filter(buffBot => !buffBot.deprecated);\n\t\t\tif (matchingBuffBots.length == 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst classPresetsContainer = document.createElement('div');\n\t\t\tclassPresetsContainer.classList.add('class-presets-container');\n\t\t\tbuffbotsContainer.appendChild(classPresetsContainer);\n\t\t\tclassPresetsContainer.style.backgroundColor = hexToRgba(classColors[wowClass as Class], 0.5);\n\n\t\t\tmatchingBuffBots.forEach(matchingBuffBot => {\n\t\t\t\tconst presetElem = document.createElement('div');\n\t\t\t\tpresetElem.classList.add('preset-picker');\n\t\t\t\tpresetElem.classList.add('preset-picker-buff-bot');\n\t\t\t\tclassPresetsContainer.appendChild(presetElem);\n\n\t\t\t\tconst presetIconElem = document.createElement('img');\n\t\t\t\tpresetIconElem.classList.add('preset-picker-icon');\n\t\t\t\tpresetElem.appendChild(presetIconElem);\n\t\t\t\tpresetIconElem.src = matchingBuffBot.iconUrl;\n\t\t\t\ttippy(presetIconElem, {\n\t\t\t\t\t'content': matchingBuffBot.tooltip,\n\t\t\t\t\t'allowHTML': true,\n\t\t\t\t});\n\n\t\t\t\tpresetElem.setAttribute('draggable', 'true');\n\t\t\t\tpresetElem.ondragstart = event => {\n\t\t\t\t\tconst dragImage = new Image();\n\t\t\t\t\tdragImage.src = matchingBuffBot.iconUrl;\n\t\t\t\t\tevent.dataTransfer!.setDragImage(dragImage, 30, 30);\n\t\t\t\t\tevent.dataTransfer!.setData(\"text/plain\", \"\");\n\t\t\t\t\tevent.dataTransfer!.dropEffect = 'copy';\n\n\t\t\t\t\tthis.raidPicker.setDragPlayer(new BuffBot(matchingBuffBot.buffBotId, this.raidPicker.raidSimUI.sim), NEW_PLAYER, DragType.New);\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n}\n\nfunction setBalanceDruidSelfInnervate(eventID: EventID, player: Player<any>) {\n\tconst newOptions = player.getSpecOptions() as BalanceDruidOptions;\n\tnewOptions.innervateTarget = newRaidTarget(player.getRaidIndex());\n\tplayer.setSpecOptions(eventID, newOptions);\n}\nfunction setSmitePriestSelfPI(eventID: EventID, player: Player<any>) {\n\tconst newOptions = player.getSpecOptions() as SmitePriestOptions;\n\tnewOptions.powerInfusionTarget = newRaidTarget(player.getRaidIndex());\n\tplayer.setSpecOptions(eventID, newOptions);\n}\n","import { Component } from '../core/components/component.js';\nimport { Input, InputConfig } from '../core/components/input.js';\nimport { RaidTargetPicker } from '../core/components/raid_target_picker.js';\nimport { Player } from '../core/player.js';\nimport { Raid } from '../core/raid.js';\nimport { EventID, TypedEvent } from '../core/typed_event.js';\nimport { Class } from '../core/proto/common.js';\nimport { RaidTarget } from '../core/proto/common.js';\nimport { Spec } from '../core/proto/common.js';\nimport { emptyRaidTarget } from '../core/proto_utils/utils.js';\n\nimport { RaidSimUI } from './raid_sim_ui.js';\n\ndeclare var tippy: any;\n\nconst MAX_TANKS = 4;\n\nexport class TanksPicker extends Component {\n\treadonly raidSimUI: RaidSimUI;\n\n\tconstructor(parentElem: HTMLElement, raidSimUI: RaidSimUI) {\n\t\tsuper(parentElem, 'tanks-picker-root');\n\t\tthis.raidSimUI = raidSimUI;\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<fieldset class=\"tanks-picker-container settings-section\">\n\t\t\t\t<legend>TANKS</legend>\n\t\t\t</fieldset>\n\t\t`;\n\n\t\tconst tanksContainer = this.rootElem.getElementsByClassName('tanks-picker-container')[0] as HTMLElement;\n\t\tconst raid = this.raidSimUI.sim.raid;\n\n\t\tfor (let i = 0; i < MAX_TANKS; i++) {\n\t\t\tconst row = document.createElement('div');\n\t\t\trow.classList.add('tank-picker-row');\n\t\t\ttanksContainer.appendChild(row);\n\n\t\t\tconst sourceElem = document.createElement('span');\n\t\t\tsourceElem.textContent = i == 0 ? 'MAIN TANK' : `TANK ${i + 1}`;\n\t\t\tsourceElem.classList.add('tank-picker-label');\n\t\t\trow.appendChild(sourceElem);\n\n\t\t\tconst arrow = document.createElement('span');\n\t\t\tarrow.classList.add('fa', 'fa-arrow-right');\n\t\t\trow.appendChild(arrow);\n\n\t\t\tconst tankIndex = i;\n\t\t\tconst raidTargetPicker = new RaidTargetPicker<Raid>(row, raid, raid, {\n\t\t\t\textraCssClasses: [\n\t\t\t\t\t'tank-picker',\n\t\t\t\t],\n\t\t\t\tnoTargetLabel: 'Unassigned',\n\t\t\t\tcompChangeEmitter: raid.compChangeEmitter,\n\n\t\t\t\tchangedEvent: (raid: Raid) => raid.tanksChangeEmitter,\n\t\t\t\tgetValue: (raid: Raid) => raid.getTanks()[tankIndex] || emptyRaidTarget(),\n\t\t\t\tsetValue: (eventID: EventID, raid: Raid, newValue: RaidTarget) => {\n\t\t\t\t\tconst tanks = raid.getTanks();\n\t\t\t\t\tfor (let i = 0; i < tankIndex; i++) {\n\t\t\t\t\t\tif (!tanks[i]) {\n\t\t\t\t\t\t\ttanks.push(emptyRaidTarget());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\ttanks[tankIndex] = newValue;\n\t\t\t\t\traid.setTanks(eventID, tanks);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n}\n","import { BooleanPicker } from \"../core/components/boolean_picker.js\";\nimport { DetailedResults } from \"../core/components/detailed_results.js\";\nimport { EncounterPicker } from \"../core/components/encounter_picker.js\";\nimport { LogRunner } from \"../core/components/log_runner.js\";\nimport { addRaidSimAction, RaidSimResultsManager, ReferenceData } from \"../core/components/raid_sim_action.js\";\nimport { SavedDataManager } from \"../core/components/saved_data_manager.js\";\nimport { SettingsMenu } from \"../core/components/settings_menu.js\";\n\nimport * as Tooltips from \"../core/constants/tooltips.js\";\nimport { Encounter } from \"../core/encounter.js\";\nimport { Player } from \"../core/player.js\";\nimport { Raid as RaidProto } from \"../core/proto/api.js\";\nimport { Class, Encounter as EncounterProto, Faction, Stat, TristateEffect } from \"../core/proto/common.js\";\nimport { Blessings } from \"../core/proto/paladin.js\";\nimport { BlessingsAssignments, BuffBot as BuffBotProto, RaidSimSettings, SavedEncounter, SavedRaid } from \"../core/proto/ui.js\";\nimport { playerToSpec } from \"../core/proto_utils/utils.js\";\nimport { Raid } from \"../core/raid.js\";\nimport { Sim } from \"../core/sim.js\";\nimport { SimUI } from \"../core/sim_ui.js\";\nimport { LaunchStatus, raidSimLaunched } from '../core/launched_sims.js';\nimport { EventID, TypedEvent } from \"../core/typed_event.js\";\n\nimport { AssignmentsPicker } from \"./assignments_picker.js\";\nimport { BlessingsPicker } from \"./blessings_picker.js\";\nimport { BuffBot } from \"./buff_bot.js\";\nimport { newRaidExporters, newRaidImporters } from \"./import_export.js\";\nimport { implementedSpecs } from \"./presets.js\";\nimport { RaidPicker } from \"./raid_picker.js\";\nimport { TanksPicker } from \"./tanks_picker.js\";\n\ndeclare var Muuri: any;\ndeclare var tippy: any;\ndeclare var pako: any;\n\nexport interface RaidSimConfig {\n\tknownIssues?: Array<string>,\n}\n\nconst extraKnownIssues: Array<string> = [\n\t//'We\\'re still missing implementations for many specs. If you\\'d like to help us out, check out our <a href=\"https://github.com/wowsims/wotlk\">Github project</a> or <a href=\"https://discord.gg/jJMPr9JWwx\">join our discord</a>!',\n];\n\nexport class RaidSimUI extends SimUI {\n\tprivate readonly config: RaidSimConfig;\n\tprivate raidSimResultsManager: RaidSimResultsManager | null = null;\n\tpublic raidPicker: RaidPicker | null = null;\n\tprivate blessingsPicker: BlessingsPicker | null = null;\n\n\t// Emits when the raid comp changes. Includes changes to buff bots.\n\treadonly compChangeEmitter = new TypedEvent<void>();\n\treadonly changeEmitter = new TypedEvent<void>();\n\n\treadonly referenceChangeEmitter = new TypedEvent<void>();\n\n\tprivate settingsMuuri: any;\n\n\tconstructor(parentElem: HTMLElement, config: RaidSimConfig) {\n\t\tsuper(parentElem, new Sim(), {\n\t\t\tspec: null,\n\t\t\tlaunchStatus: raidSimLaunched ? LaunchStatus.Launched : LaunchStatus.Unlaunched,\n\t\t\tknownIssues: (config.knownIssues || []).concat(extraKnownIssues),\n\t\t});\n\t\tthis.rootElem.classList.add('raid-sim-ui');\n\n\t\tthis.config = config;\n\t\tthis.settingsMuuri = null;\n\n\t\tthis.sim.raid.compChangeEmitter.on(eventID => this.compChangeEmitter.emit(eventID));\n\t\tthis.sim.setModifyRaidProto(raidProto => this.modifyRaidProto(raidProto));\n\n\t\t[\n\t\t\tthis.compChangeEmitter,\n\t\t\tthis.sim.changeEmitter,\n\t\t].forEach(emitter => emitter.on(eventID => this.changeEmitter.emit(eventID)));\n\n\t\tthis.sim.waitForInit().then(() => this.loadSettings());\n\n\t\tthis.addSidebarComponents();\n\t\tthis.addTopbarComponents();\n\t\tthis.addRaidTab();\n\t\tthis.addSettingsTab();\n\t\tthis.addDetailedResultsTab();\n\t\tthis.addLogTab();\n\n\t\tthis.changeEmitter.on(() => this.recomputeSettingsLayout());\n\t}\n\n\tprivate loadSettings() {\n\t\tconst initEventID = TypedEvent.nextEventID();\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tlet loadedSettings = false;\n\n\t\t\tconst savedSettings = window.localStorage.getItem(this.getSettingsStorageKey());\n\t\t\tif (savedSettings != null) {\n\t\t\t\ttry {\n\t\t\t\t\tconst settings = RaidSimSettings.fromJsonString(savedSettings);\n\t\t\t\t\tthis.fromProto(initEventID, settings);\n\t\t\t\t\tloadedSettings = true;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Failed to parse saved settings: ' + e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!loadedSettings) {\n\t\t\t\tthis.applyDefaults(initEventID);\n\t\t\t}\n\n\t\t\t// This needs to go last so it doesn't re-store things as they are initialized.\n\t\t\tthis.changeEmitter.on(eventID => {\n\t\t\t\tconst jsonStr = RaidSimSettings.toJsonString(this.toProto());\n\t\t\t\twindow.localStorage.setItem(this.getSettingsStorageKey(), jsonStr);\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate addSidebarComponents() {\n\t\tthis.raidSimResultsManager = addRaidSimAction(this);\n\t\tthis.raidSimResultsManager.changeEmitter.on(eventID => this.referenceChangeEmitter.emit(eventID));\n\t}\n\n\tprivate addTopbarComponents() {\n\t\tthis.addToolbarItem(newRaidImporters(this));\n\t\tthis.addToolbarItem(newRaidExporters(this));\n\n\t\tconst settingsMenu = document.createElement('span');\n\t\tsettingsMenu.classList.add('fas', 'fa-cog');\n\t\ttippy(settingsMenu, {\n\t\t\t'content': 'Settings',\n\t\t\t'allowHTML': true,\n\t\t});\n\t\tsettingsMenu.addEventListener('click', event => {\n\t\t\tnew SettingsMenu(this.rootElem, this);\n\t\t});\n\t\tthis.addToolbarItem(settingsMenu);\n\t}\n\n\tprivate addRaidTab() {\n\t\tthis.addTab('RAID', 'raid-tab', `\n\t\t\t<div class=\"raid-picker\">\n\t\t\t</div>\n\t\t\t<div class=\"saved-raids-div\">\n\t\t\t\t<div class=\"saved-raids-manager\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.raidPicker = new RaidPicker(this.rootElem.getElementsByClassName('raid-picker')[0] as HTMLElement, this);\n\n\t\tconst savedRaidManager = new SavedDataManager<RaidSimUI, SavedRaid>(this.rootElem.getElementsByClassName('saved-raids-manager')[0] as HTMLElement, this, {\n\t\t\tlabel: 'Raid',\n\t\t\tstorageKey: this.getSavedRaidStorageKey(),\n\t\t\tgetData: (raidSimUI: RaidSimUI) => SavedRaid.create({\n\t\t\t\traid: this.sim.raid.toProto(),\n\t\t\t\tbuffBots: this.getBuffBots().map(b => b.toProto()),\n\t\t\t\tblessings: this.blessingsPicker!.getAssignments(),\n\t\t\t\tfaction: this.sim.getFaction(),\n\t\t\t\tphase: this.sim.getPhase(),\n\t\t\t}),\n\t\t\tsetData: (eventID: EventID, raidSimUI: RaidSimUI, newRaid: SavedRaid) => {\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\t\tthis.sim.raid.fromProto(eventID, newRaid.raid || RaidProto.create());\n\t\t\t\t\tthis.raidPicker!.setBuffBots(eventID, newRaid.buffBots);\n\t\t\t\t\tthis.blessingsPicker!.setAssignments(eventID, newRaid.blessings || BlessingsAssignments.create());\n\t\t\t\t\tif (newRaid.faction) this.sim.setFaction(eventID, newRaid.faction);\n\t\t\t\t\tif (newRaid.phase) this.sim.setPhase(eventID, newRaid.phase);\n\t\t\t\t});\n\t\t\t},\n\t\t\tchangeEmitters: [this.changeEmitter, this.sim.changeEmitter],\n\t\t\tequals: (a: SavedRaid, b: SavedRaid) => {\n\t\t\t\treturn SavedRaid.equals(a, b);\n\t\t\t},\n\t\t\ttoJson: (a: SavedRaid) => SavedRaid.toJson(a),\n\t\t\tfromJson: (obj: any) => SavedRaid.fromJson(obj),\n\t\t});\n\t\tthis.sim.waitForInit().then(() => {\n\t\t\tsavedRaidManager.loadUserData();\n\t\t});\n\t}\n\n\tprivate addSettingsTab() {\n\t\tthis.addTab('SETTINGS', 'raid-settings-tab', `\n\t\t\t<div class=\"raid-settings-sections\">\n\t\t\t\t<div class=\"settings-section-container raid-settings-section-container\">\n\t\t\t\t\t<fieldset class=\"settings-section raid-encounter-section\">\n\t\t\t\t\t\t<legend>Encounter</legend>\n\t\t\t\t\t</fieldset>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"settings-section-container blessings-section-container\">\n\t\t\t\t\t<fieldset class=\"settings-section blessings-section\">\n\t\t\t\t\t\t<legend>Blessings</legend>\n\t\t\t\t\t</fieldset>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"settings-section-container assignments-section-container\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"settings-section-container tanks-section-container\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"settings-section-container raid-settings-section-container\">\n\t\t\t\t\t<fieldset class=\"settings-section other-options-section\">\n\t\t\t\t\t\t<legend>Other Options</legend>\n\t\t\t\t\t</fieldset>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"settings-bottom-bar\">\n\t\t\t\t<div class=\"saved-encounter-manager\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tconst encounterSectionElem = this.rootElem.getElementsByClassName('raid-encounter-section')[0] as HTMLElement;\n\t\tnew EncounterPicker(encounterSectionElem, this.sim.encounter, {\n\t\t\tshowExecuteProportion: true,\n\t\t}, this);\n\t\tconst savedEncounterManager = new SavedDataManager<Encounter, SavedEncounter>(this.rootElem.getElementsByClassName('saved-encounter-manager')[0] as HTMLElement, this.sim.encounter, {\n\t\t\tlabel: 'Encounter',\n\t\t\tstorageKey: this.getSavedEncounterStorageKey(),\n\t\t\tgetData: (encounter: Encounter) => SavedEncounter.create({ encounter: encounter.toProto() }),\n\t\t\tsetData: (eventID: EventID, encounter: Encounter, newEncounter: SavedEncounter) => encounter.fromProto(eventID, newEncounter.encounter!),\n\t\t\tchangeEmitters: [this.sim.encounter.changeEmitter],\n\t\t\tequals: (a: SavedEncounter, b: SavedEncounter) => SavedEncounter.equals(a, b),\n\t\t\ttoJson: (a: SavedEncounter) => SavedEncounter.toJson(a),\n\t\t\tfromJson: (obj: any) => SavedEncounter.fromJson(obj),\n\t\t});\n\t\tthis.sim.waitForInit().then(() => {\n\t\t\tsavedEncounterManager.loadUserData();\n\t\t});\n\n\t\tconst blessingsSection = this.rootElem.getElementsByClassName('blessings-section')[0] as HTMLElement;\n\t\tthis.blessingsPicker = new BlessingsPicker(blessingsSection, this);\n\t\tthis.blessingsPicker.changeEmitter.on(eventID => this.changeEmitter.emit(eventID));\n\t\ttippy(blessingsSection, {\n\t\t\tcontent: Tooltips.BLESSINGS_SECTION,\n\t\t\tallowHTML: true,\n\t\t\tplacement: 'left',\n\t\t});\n\n\t\tconst assignmentsPicker = new AssignmentsPicker(this.rootElem.getElementsByClassName('assignments-section-container')[0] as HTMLElement, this);\n\t\tconst tanksPicker = new TanksPicker(this.rootElem.getElementsByClassName('tanks-section-container')[0] as HTMLElement, this);\n\n\t\tconst otherOptionsSectionElem = this.rootElem.getElementsByClassName('other-options-section')[0] as HTMLElement;\n\t\t//new BooleanPicker(otherOptionsSectionElem, this.sim.raid, {\n\t\t//\tlabel: 'Stagger Stormstrikes',\n\t\t//\tlabelTooltip: 'When there are multiple Enhancement Shaman in the raid, causes them to coordinate their Stormstrike casts for optimal SS charge usage.',\n\t\t//\tchangedEvent: (raid: Raid) => raid.staggerStormstrikesChangeEmitter,\n\t\t//\tgetValue: (raid: Raid) => raid.getStaggerStormstrikes(),\n\t\t//\tsetValue: (eventID: EventID, raid: Raid, newValue: boolean) => {\n\t\t//\t\traid.setStaggerStormstrikes(eventID, newValue);\n\t\t//\t},\n\t\t//});\n\n\t\t// Init Muuri layout only when settings tab is clicked, because it needs the elements\n\t\t// to be shown so it can calculate sizes.\n\t\t(this.rootElem.getElementsByClassName('raid-settings-tab-tab')[0] as HTMLElement)!.addEventListener('click', event => {\n\t\t\tif (this.settingsMuuri == null) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.settingsMuuri = new Muuri('.raid-settings-sections');\n\t\t\t\t}, 200); // Magic amount of time before Muuri init seems to work\n\t\t\t}\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.recomputeSettingsLayout();\n\t\t\t}, 200);\n\t\t});\n\t}\n\n\tprivate addDetailedResultsTab() {\n\t\tthis.addTab('DETAILED RESULTS', 'detailed-results-tab', `\n\t\t\t<div class=\"detailed-results\">\n\t\t\t</div>\n\t\t`);\n\n\t\tconst detailedResults = new DetailedResults(this.rootElem.getElementsByClassName('detailed-results')[0] as HTMLElement, this, this.raidSimResultsManager!);\n\t}\n\n\tprivate addLogTab() {\n\t\tthis.addTab('LOG', 'log-tab', `\n\t\t\t<div class=\"log-runner\">\n\t\t\t</div>\n\t\t`);\n\n\t\tconst logRunner = new LogRunner(this.rootElem.getElementsByClassName('log-runner')[0] as HTMLElement, this);\n\t}\n\n\tprivate recomputeSettingsLayout() {\n\t\tif (this.settingsMuuri) {\n\t\t\t//this.settingsMuuri.refreshItems();\n\t\t}\n\t\twindow.dispatchEvent(new Event('resize'));\n\t}\n\n\tprivate modifyRaidProto(raidProto: RaidProto) {\n\t\t// Invoke all the buff bot callbacks.\n\t\tthis.getBuffBots().forEach(buffBot => {\n\t\t\tconst partyProto = raidProto.parties[buffBot.getPartyIndex()];\n\t\t\tif (!partyProto) {\n\t\t\t\tthrow new Error('No party proto for party index: ' + buffBot.getPartyIndex());\n\t\t\t}\n\t\t\tbuffBot.settings.modifyRaidProto(buffBot, raidProto, partyProto);\n\t\t});\n\n\t\t// Apply blessings.\n\t\tconst numPaladins = this.getClassCount(Class.ClassPaladin);\n\t\tconst blessingsAssignments = this.blessingsPicker!.getAssignments();\n\t\timplementedSpecs.forEach(spec => {\n\t\t\tconst playerProtos = raidProto.parties\n\t\t\t\t.map(party => party.players.filter(player => player.class != Class.ClassUnknown && playerToSpec(player) == spec))\n\t\t\t\t.flat();\n\n\t\t\tblessingsAssignments.paladins.forEach((paladin, i) => {\n\t\t\t\tif (i >= numPaladins) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (paladin.blessings[spec] == Blessings.BlessingOfKings) {\n\t\t\t\t\tplayerProtos.forEach(playerProto => playerProto.buffs!.blessingOfKings = true);\n\t\t\t\t} else if (paladin.blessings[spec] == Blessings.BlessingOfMight) {\n\t\t\t\t\tplayerProtos.forEach(playerProto => playerProto.buffs!.blessingOfMight = TristateEffect.TristateEffectImproved);\n\t\t\t\t} else if (paladin.blessings[spec] == Blessings.BlessingOfWisdom) {\n\t\t\t\t\tplayerProtos.forEach(playerProto => playerProto.buffs!.blessingOfWisdom = TristateEffect.TristateEffectImproved);\n\t\t\t\t} else if (paladin.blessings[spec] == Blessings.BlessingOfSanctuary) {\n\t\t\t\t\tplayerProtos.forEach(playerProto => playerProto.buffs!.blessingOfSanctuary = true);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tgetCurrentData(): ReferenceData | null {\n\t\tif (this.raidSimResultsManager) {\n\t\t\treturn this.raidSimResultsManager.getCurrentData();\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tgetReferenceData(): ReferenceData | null {\n\t\tif (this.raidSimResultsManager) {\n\t\t\treturn this.raidSimResultsManager.getReferenceData();\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tgetClassCount(playerClass: Class): number {\n\t\treturn this.sim.raid.getClassCount(playerClass)\n\t\t\t+ this.getBuffBots()\n\t\t\t\t.filter(buffBot => buffBot.getClass() == playerClass).length;\n\t}\n\n\tgetBuffBots(): Array<BuffBot> {\n\t\treturn this.raidPicker!.getBuffBots();\n\t}\n\n\tsetBuffBots(eventID: EventID, buffBotProtos: BuffBotProto[]): void {\n\t\tthis.raidPicker!.setBuffBots(eventID, buffBotProtos);\n\t}\n\n\tclearBuffBots(eventID: EventID): void {\n\t\tthis.raidPicker!.setBuffBots(eventID, []);\n\t}\n\n\tgetPlayersAndBuffBots(): Array<Player<any> | BuffBot | null> {\n\t\tconst players = this.sim.raid.getPlayers();\n\t\tconst buffBots = this.getBuffBots();\n\n\t\tconst playersAndBuffBots: Array<Player<any> | BuffBot | null> = players.slice();\n\t\tbuffBots.forEach(buffBot => {\n\t\t\tplayersAndBuffBots[buffBot.getRaidIndex()] = buffBot;\n\t\t});\n\n\t\treturn playersAndBuffBots;\n\t}\n\n\tapplyDefaults(eventID: EventID) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.sim.raid.fromProto(eventID, RaidProto.create());\n\t\t\tthis.sim.encounter.applyDefaults(eventID);\n\t\t\tthis.sim.applyDefaults(eventID, true, true);\n\t\t\tthis.sim.setShowDamageMetrics(eventID, true);\n\t\t});\n\t}\n\n\ttoProto(): RaidSimSettings {\n\t\treturn RaidSimSettings.create({\n\t\t\tsettings: this.sim.toProto(),\n\t\t\traid: this.sim.raid.toProto(true),\n\t\t\tbuffBots: this.getBuffBots().map(b => b.toProto()),\n\t\t\tblessings: this.blessingsPicker!.getAssignments(),\n\t\t\tencounter: this.sim.encounter.toProto(),\n\t\t});\n\t}\n\n\ttoLink(): string {\n\t\tconst proto = this.toProto();\n\t\t// When sharing links, people generally don't intend to share settings.\n\t\tproto.settings = undefined;\n\n\t\tconst protoBytes = RaidSimSettings.toBinary(proto);\n\t\tconst deflated = pako.deflate(protoBytes, { to: 'string' });\n\t\tconst encoded = btoa(String.fromCharCode(...deflated));\n\n\t\tconst linkUrl = new URL(window.location.href);\n\t\tlinkUrl.hash = encoded;\n\t\treturn linkUrl.toString();\n\t}\n\n\tfromProto(eventID: EventID, settings: RaidSimSettings) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tif (settings.settings) {\n\t\t\t\tthis.sim.fromProto(eventID, settings.settings);\n\t\t\t}\n\t\t\tthis.sim.raid.fromProto(eventID, settings.raid || RaidProto.create());\n\t\t\tthis.sim.encounter.fromProto(eventID, settings.encounter || EncounterProto.create());\n\t\t\tthis.raidPicker!.setBuffBots(eventID, settings.buffBots);\n\t\t\tthis.blessingsPicker!.setAssignments(eventID, settings.blessings || BlessingsAssignments.create());\n\t\t});\n\t}\n\n\tclearRaid(eventID: EventID) {\n\t\tthis.sim.raid.clear(eventID);\n\t\tthis.clearBuffBots(eventID);\n\t}\n\n\t// Returns the actual key to use for local storage, based on the given key part and the site context.\n\tgetStorageKey(keyPart: string): string {\n\t\treturn '__wotlk_raid__' + keyPart;\n\t}\n\n\tgetSavedRaidStorageKey(): string {\n\t\treturn this.getStorageKey('__savedRaid__');\n\t}\n}\n","import { RaidSimUI } from './raid_sim_ui.js';\n\nconst ui = new RaidSimUI(document.body, {});\n"],"names":["RaidTargetPicker","Input","constructor","parent","raid","modObj","config","super","this","rootElem","classList","add","curPlayer","getPlayerFromRaidTarget","getValue","curRaidTarget","getInputValue","noTargetOption","iconUrl","text","noTargetLabel","color","value","isDropdown","innerHTML","buttonElem","getElementsByClassName","dropdownElem","addEventListener","event","preventDefault","currentOptions","updateOptions","TypedEvent","nextEventID","compChangeEmitter","on","eventID","init","makeTargetOptions","playerOptions","getPlayers","filter","player","map","getTalentTreeIcon","getLabel","getClassColor","concat","forEach","option","appendChild","makeOption","prevRaidTarget","RaidTarget","equals","setInputValue","inputChanged","data","makeOptionElem","getInputElem","makeRaidTarget","emptyRaidTarget","newValue","clone","optionData","find","static","optionContainer","document","createElement","style","backgroundColor","icon","src","label","textContent","specSimFactories","Spec","SpecDeathknight","parentElem","DeathknightSimUI","SpecBalanceDruid","BalanceDruidSimUI","SpecFeralDruid","FeralDruidSimUI","SpecFeralTankDruid","FeralTankDruidSimUI","SpecElementalShaman","ElementalShamanSimUI","SpecEnhancementShaman","EnhancementShamanSimUI","SpecHunter","HunterSimUI","SpecMage","MageSimUI","SpecRogue","RogueSimUI","SpecRetributionPaladin","RetributionPaladinSimUI","SpecProtectionPaladin","ProtectionPaladinSimUI","SpecShadowPriest","ShadowPriestSimUI","SpecSmitePriest","SmitePriestSimUI","SpecWarrior","WarriorSimUI","SpecProtectionWarrior","ProtectionWarriorSimUI","SpecWarlock","WarlockSimUI","playerPresets","spec","rotation","DeathknightPresets.DefaultFrostRotation","talents","DeathknightPresets.FrostTalents","specOptions","DeathknightPresets.DefaultFrostOptions","consumes","DeathknightPresets.DefaultConsumes","defaultName","defaultFactionRaces","Faction","Unknown","Race","RaceUnknown","Alliance","RaceHuman","Horde","RaceTroll","defaultGear","DeathknightPresets.P1_FROST_BIS_PRESET","gear","otherDefaults","DeathknightPresets.OtherDefaults","tooltip","talentTreeIcons","Class","ClassDeathknight","DeathknightPresets.DefaultUnholyRotation","DeathknightPresets.UnholyDualWieldTalents","DeathknightPresets.DefaultUnholyOptions","DeathknightPresets.P1_UNHOLY_DW_BIS_PRESET","DeathknightPresets.DefaultBloodRotation","DeathknightPresets.BloodTalents","DeathknightPresets.DefaultBloodOptions","DeathknightPresets.P1_BLOOD_BIS_PRESET","BalanceDruidPresets.DefaultRotation","BalanceDruidPresets.StandardTalents","BalanceDruidPresets.DefaultOptions","BalanceDruidPresets.DefaultConsumes","RaceNightElf","RaceTauren","BalanceDruidPresets.P1_PRESET","specNames","specIconsLarge","FeralDruidPresets.DefaultRotation","FeralDruidPresets.StandardTalents","FeralDruidPresets.DefaultOptions","FeralDruidPresets.DefaultConsumes","FeralDruidPresets.P1_PRESET","FeralTankDruidPresets.DefaultRotation","FeralTankDruidPresets.StandardTalents","FeralTankDruidPresets.DefaultOptions","FeralTankDruidPresets.DefaultConsumes","FeralTankDruidPresets.P1_PRESET","HunterPresets.DefaultRotation","HunterPresets.BeastMasteryTalents","HunterPresets.BMDefaultOptions","HunterPresets.DefaultConsumes","RaceOrc","HunterPresets.P1_PRESET","ClassHunter","HunterPresets.MarksmanTalents","HunterPresets.DefaultOptions","HunterPresets.SurvivalTalents","MagePresets.DefaultArcaneRotation","MagePresets.ArcaneTalents","MagePresets.DefaultArcaneOptions","MagePresets.DefaultArcaneConsumes","RaceGnome","MagePresets.P1_ARCANE_PRESET","ClassMage","MagePresets.DefaultFireRotation","MagePresets.FireTalents","MagePresets.DefaultFireOptions","MagePresets.DefaultFireConsumes","MagePresets.P1_FIRE_PRESET","MagePresets.DefaultFrostRotation","MagePresets.FrostTalents","MagePresets.DefaultFrostOptions","MagePresets.DefaultFrostConsumes","MagePresets.P1_FROST_PRESET","RoguePresets.DefaultRotation","RoguePresets.CombatTalents","RoguePresets.DefaultOptions","RoguePresets.DefaultConsumes","RoguePresets.P1_PRESET","ElementalShamanPresets.DefaultRotation","ElementalShamanPresets.StandardTalents","ElementalShamanPresets.DefaultOptions","ElementalShamanPresets.DefaultConsumes","RaceDraenei","ElementalShamanPresets.P1_PRESET","EnhancementShamanPresets.DefaultRotation","EnhancementShamanPresets.StandardTalents","EnhancementShamanPresets.DefaultOptions","EnhancementShamanPresets.DefaultConsumes","EnhancementShamanPresets.P1_PRESET","ShadowPriestPresets.DefaultRotation","ShadowPriestPresets.StandardTalents","ShadowPriestPresets.DefaultOptions","ShadowPriestPresets.DefaultConsumes","RaceDwarf","RaceUndead","ShadowPriestPresets.P1_PRESET","SmitePriestPresets.DefaultRotation","SmitePriestPresets.StandardTalents","SmitePriestPresets.DefaultOptions","SmitePriestPresets.DefaultConsumes","SmitePriestPresets.P1_PRESET","WarriorPresets.ArmsRotation","WarriorPresets.ArmsTalents","WarriorPresets.DefaultOptions","WarriorPresets.DefaultConsumes","WarriorPresets.P1_ARMS_PRESET","ClassWarrior","WarriorPresets.DefaultRotation","WarriorPresets.FuryTalents","WarriorPresets.P1_FURY_PRESET","ProtectionWarriorPresets.DefaultRotation","ProtectionWarriorPresets.StandardTalents","ProtectionWarriorPresets.DefaultOptions","ProtectionWarriorPresets.DefaultConsumes","ProtectionWarriorPresets.P1_BALANCED_PRESET","RetributionPaladinPresets.DefaultRotation","RetributionPaladinPresets.AuraMasteryTalents","RetributionPaladinPresets.DefaultOptions","RetributionPaladinPresets.DefaultConsumes","RaceBloodElf","RetributionPaladinPresets.P1_PRESET","RetributionPaladinPresets.P2_PRESET","RetributionPaladinPresets.P3_PRESET","RetributionPaladinPresets.P4_PRESET","RetributionPaladinPresets.P5_PRESET","ClassPaladin","ProtectionPaladinPresets.DefaultRotation","ProtectionPaladinPresets.GenericAoeTalents","ProtectionPaladinPresets.DefaultOptions","ProtectionPaladinPresets.DefaultConsumes","ProtectionPaladinPresets.P1_PRESET","WarlockPresets.DestructionRotation","WarlockPresets.DestructionTalents","WarlockPresets.DestructionOptions","WarlockPresets.DefaultConsumes","WarlockPresets.P1_Preset_Demo_Destro","WarlockPresets.P1_PreBiS_14","WarlockPresets.OtherDefaults","ClassWarlock","WarlockPresets.AfflictionRotation","WarlockPresets.AfflictionTalents","WarlockPresets.AfflictionOptions","WarlockPresets.P1_Preset_Affliction","WarlockPresets.P1_PreBiS_11","WarlockPresets.DemonologyRotation","WarlockPresets.DemonologyTalents","WarlockPresets.DemonologyOptions","implementedSpecs","Set","preset","buffBotPresets","buffBotId","deprecated","name","modifyRaidProto","buffBot","raidProto","partyProto","buffs","giftOfTheWild","Math","max","TristateEffect","TristateEffectRegular","thorns","debuffs","faerieFire","leaderOfThePack","innervateIndex","getInnervateAssignment","targetIndex","NO_TARGET","partyIndex","floor","playerIndex","playerProto","parties","players","innervates","TristateEffectImproved","arcaneBrilliance","judgementOfWisdom","ClassPriest","shadowProtection","powerWordFortitude","divineSpirit","powerInfusionIndex","getPowerInfusionAssignment","powerInfusions","tricksOfTheTradeIndex","getTricksOfTheTradeAssignment","tricksOfTheTrades","ClassShaman","bloodlust","manaSpringTotem","manaTideTotems","woaSpecs","wfSpecs","woaVotes","wfVotes","specs","class","ClassUnknown","playerToSpec","playerSpec","includes","length","wrathOfAirTotem","windfuryTotem","battleShout","sunderArmor","bloodFrenzy","unholyFrenzyIndex","getUnholyFrenzyAssignment","unholyFrenzy","BuffBot","id","sim","raidIndex","innervateAssignment","powerInfusionAssignment","tricksOfTheTradeAssignment","unholyFrenzyAssignment","raidIndexChangeEmitter","innervateAssignmentChangeEmitter","powerInfusionAssignmentChangeEmitter","tricksOfTheTradeAssignmentChangeEmitter","unholyFrenzyAssignmentChangeEmitter","changeEmitter","settings","Error","updateSettings","emitter","emit","getParty","getPartyIndex","getRaidIndex","getClass","specToClass","classColors","setRaidIndex","newRaidIndex","freezeAllAndDo","setInnervateAssignment","newInnervateAssignment","setPowerInfusionAssignment","newPowerInfusionAssignment","setTricksOfTheTradeAssignment","newTricksOfTheTradeAssignment","setUnholyFrenzyAssignment","newUnholyFrenzyAssignment","toProto","BuffBotProto","create","fromProto","proto","newBuffBot","AssignmentsPicker","Component","raidSimUI","innervatesPicker","InnervatesPicker","powerInfusionsPicker","PowerInfusionsPicker","tricksOfTheTradesPicker","TricksOfTheTradesPicker","unholyFrenzyPicker","UnholyFrenzyPicker","AssignedBuffPicker","targetPickers","playersContainer","update","getTitle","toUpperCase","sourcePlayers","getSourcePlayers","display","sourcePlayer","sourcePlayerIndex","row","sourceElem","Player","arrow","raidTargetPicker","extraCssClasses","changedEvent","specOptionsChangeEmitter","getPlayerValue","setValue","setPlayerValue","getBuffBotValue","setBuffBotValue","targetPickerData","playerOrBot","targetPicker","targetPlayer","getPlayersAndBuffBots","ClassDruid","getSpecOptions","innervateTarget","newOptions","setSpecOptions","getTalents","powerInfusion","powerInfusionTarget","ClassRogue","tricksOfTheTradeTarget","hysteria","unholyFrenzyTarget","BlessingsPicker","assignments","BlessingsAssignments","makeDefaultBlessings","bodyElem","naturalSpecOrder","memeSpecs","paladinIndexes","Array","keys","cols","rows","headerCell","titleIcons","tippy","content","allowHTML","paladinIdx","cell","push","IconEnumPicker","numColumns","values","Blessings","BlessingUnknown","actionId","ActionId","fromSpellId","BlessingOfKings","BlessingOfMight","BlessingOfWisdom","BlessingOfSanctuary","a","b","zeroValue","picker","paladins","blessings","setNumPaladins","getClassCount","numPaladins","min","i","elem","remove","getAssignments","setAssignments","newAssignments","RaidJsonImporter","Importer","simUI","descriptionElem","onImport","RaidSimSettings","fromJsonString","close","RaidJsonExporter","Exporter","getData","JSON","stringify","toJson","RaidWCLImporter","queryCounter","getWCLBearerToken","fetch","method","headers","Authorization","btoa","body","URLSearchParams","grant_type","then","response","json","res","access_token","catch","err","console","error","queryWCL","query","token","Accept","queryURL","encodeURI","getURLInfo","url","urlInfo","reportID","fightID","fightIDIndex","indexOf","reportIDIndex","parseInt","substring","isNaN","toString","warn","getRateLimit","async","importLink","importButton","disabled","cursor","doImport","removeProperty","clearRaid","rateLimitStart","experimentalGenerateParties","pointsSpentThisHour","limitPerHour","info","reportDataQuery","reportData","errors","errorData","reduce","accumulator","message","alert","wclData","report","guildData","guild","playerData","playerDetails","entries","innervateData","powerInfusionData","tricksOfTheTradeData","tricksOfTheTrade","fight","fights","startTime","endTime","faction","raidPicker","getCurrentFaction","encounter","EncounterProto","duration","targets","closestEncounterPreset","getAllPresetEncounters","enc","path","mob","target","Target","defaultProto","RaidProto","buffBots","wclIDtoRaidIndex","Map","type","tempParties","from","MAX_NUM_PARTIES","PartyProto","sortByProperty","objArray","prop","isArray","slice","direct","arguments","propPath","split","sort","p","match","mappedPlayers","wclPlayer","WCLSimPlayer","processBuffCastData","buffCastData","playerCasts","cast","isBuffBot","wclPlayers","sortBuffBotsLast","assignPlayerToParty","raidParty","missing","MAX_PARTY_SIZE","getBuffBot","simPlayer","getPlayer","set","PlayerProto","isTankSpec","rt","get","tanks","partyAssigned","partyBuffPlayers","isPartyBuffer","partyFull","partyMembers","auraIDs","getPartyAuraIds","auraBuffQueries","auraID","auraTargets","auraQueryRes","playerAuras","table","auras","auraTarget","bands","index","uniqueAuraTargets","some","partyFound","raidMember","totalPartyMembers","findIndex","party","member","partyMember","isUndefined","isFull","targetID","targetRaidIndex","playerID","playerRaidIndex","raidPlayer","oneofKind","balanceDruid","options","feralDruid","feralTankDruid","setBuffBots","rateLimitEnd","debug","pointsResetIn","sortPriority","wclSpec","specType","specSortPriority","specFuncs","specTypeFunctions","matchingPreset","getMatchingPreset","withSpecProto","talentsCreate","talentsString","glyphs","nameToClass","equipment","getEquipment","race","applySharedDefaultsToProto","botID","buffBotNames","bot","feralDruidSpecAuras","specSpecificAuras","RetributionPaladin","GuardianDruid","WardenDruid","FeralDruid","BalanceDruid","RestorationDruid","MarksmanHunter","EnhancementShaman","classAuras","Paladin","Warrior","Warlock","reliableAuras","matchingPresets","presetIdx","distance","presetTalents","talentIdx","v","newDistance","acc","abs","guid","EquipmentSpec","items","item","ItemSpec","dbEnchant","getEnchantFlexible","permanentEnchant","enchant","gems","gemInfo","Warden","Guardian","Feral","Balance","Justicar","Retribution","Fury","Arms","Protection","Enhancement","Destruction","Affliction","Demonology","Marksman","Elemental","Survival","BeastMastery","Arcane","Fire","Frost","Assassination","Combat","Shadow","Smite","Champion","Gladiator","HolyPaladin","HolyPriest","DisciplinePriest","DreamstateDruid","RestorationShaman","RaidPicker","currentDragPlayer","currentDragPlayerFromIndex","currentDragType","raidViewer","partiesContainer","partyPickers","getParties","PartyPicker","newPlayerPickerRoot","newPlayerPicker","NewPlayerPicker","ondragend","clearDragPlayer","getFaction","getCurrentPhase","getPhase","getPlayerPicker","playerPickers","getPlayerPickers","getBuffBots","newBuffBotProtos","setPlayer","buffBotProto","setDragPlayer","fromIndex","PlayerPicker","dpsResultElem","referenceDeltaElem","referenceChangeEmitter","currentData","getCurrentData","referenceData","getReferenceData","partyDps","simResult","raidMetrics","dps","avg","referenceDps","toFixed","formatDeltaTextElem","partyPicker","newPlayer","labelElem","iconElem","nameElem","resultsElem","setName","keyCode","realPlayerPickers","pp","indexOfThis","focus","blur","emptyName","selection","window","getSelection","range","createRange","selectNodeContents","removeAllRanges","addRange","dragStart","dataTransfer","dropEffect","effectAllowed","iconSrc","dragImage","Image","setDragImage","playerDataProto","setData","String","fromCharCode","toBinary","ondragstart","copyElem","deleteElem","dragEnterCounter","ondragenter","ondragleave","ondragover","ondrop","dropData","dragType","fromPlayerPicker","myicon","binary","atob","bytes","Uint8Array","charCodeAt","fromBinary","localPlayer","editElem","PlayerEditorModal","playerDps","getDamageMetrics","getTanks","emptyIdx","tank","setTanks","newRaidTarget","setBalanceDruidSelfInnervate","setSmitePriestSelfPI","setAttribute","removeAttribute","getName","CloseButton","$","bPopup","editorRoot","closeClass","onClose","EnumPicker","labelTooltip","factionChangeEmitter","setFaction","phaseChangeEmitter","setPhase","presetsContainer","getEnumValues","wowClass","classPresetsContainer","hexToRgba","presetElem","presetIconElem","applySharedDefaults","setRace","setRotation","setTalentsString","setGlyphs","Glyphs","setConsumes","setProfession1","profession1","Profession","Engineering","setProfession2","profession2","Jewelcrafting","setDistanceFromTarget","distanceFromTarget","waitForInit","setGear","lookupEquipmentSpec","buffbotsTooltip","buffbotsContainer","matchingBuffBots","matchingBuffBot","TanksPicker","tanksContainer","tankIndex","tanksChangeEmitter","raid2","extraKnownIssues","SimUI","Sim","launchStatus","LaunchStatus","Unlaunched","knownIssues","raidSimResultsManager","blessingsPicker","settingsMuuri","setModifyRaidProto","loadSettings","addSidebarComponents","addTopbarComponents","addRaidTab","addSettingsTab","addDetailedResultsTab","addLogTab","recomputeSettingsLayout","initEventID","loadedSettings","savedSettings","localStorage","getItem","getSettingsStorageKey","e","applyDefaults","jsonStr","toJsonString","setItem","addRaidSimAction","addToolbarItem","importSettings","linkElem","menuElem","addMenuItem","experimental","onClick","itemElem","newRaidImporters","exportSettings","newRaidExporters","settingsMenu","SettingsMenu","addTab","savedRaidManager","SavedDataManager","storageKey","getSavedRaidStorageKey","SavedRaid","phase","newRaid","changeEmitters","fromJson","obj","loadUserData","encounterSectionElem","EncounterPicker","showExecuteProportion","savedEncounterManager","getSavedEncounterStorageKey","SavedEncounter","newEncounter","blessingsSection","Tooltips.BLESSINGS_SECTION","placement","setTimeout","Muuri","DetailedResults","LogRunner","dispatchEvent","Event","blessingsAssignments","playerProtos","flat","paladin","blessingOfKings","blessingOfMight","blessingOfWisdom","blessingOfSanctuary","playerClass","buffBotProtos","clearBuffBots","playersAndBuffBots","setShowDamageMetrics","toLink","protoBytes","deflated","pako","deflate","to","encoded","linkUrl","URL","location","href","hash","clear","getStorageKey","keyPart"],"mappings":"kzEA4BO,MAAMA,WAAoCC,EAahDC,YAAYC,EAAqBC,EAAYC,EAAmBC,GACzDC,MAAAJ,EAAQ,0BAA2BE,EAAQC,GAC5CE,KAAAC,SAASC,UAAUC,IAAI,iBAC5BH,KAAKF,OAASA,EACdE,KAAKJ,KAAOA,EACZI,KAAKI,UAAYJ,KAAKJ,KAAKS,wBAAwBP,EAAOQ,SAAST,IAC9DG,KAAAO,cAAgBP,KAAKQ,gBAE1BR,KAAKS,eAAiB,CACrBC,QAAS,GACTC,KAAMb,EAAOc,cACbC,MAAO,QACPC,MAAO,KACPC,YAAY,GAGbf,KAAKC,SAASe,UAAY,oJAK1BhB,KAAKiB,WAAajB,KAAKC,SAASiB,uBAAuB,6BAA6B,GACpFlB,KAAKmB,aAAenB,KAAKC,SAASiB,uBAAuB,+BAA+B,GAEnFlB,KAAAiB,WAAWG,iBAAiB,SAAkBC,IAClDA,EAAMC,gBAAe,IAGtBtB,KAAKuB,eAAiB,GACjBvB,KAAAwB,cAAcC,EAAWC,eACvB5B,EAAA6B,kBAAkBC,IAAcC,IACtC7B,KAAKwB,cAAcK,EAAO,IAG3B7B,KAAK8B,MACN,CAEQC,oBACD,MAAAC,EAAgBhC,KAAKJ,KAAKqC,aAAaC,QAAOC,GAAoB,MAAVA,IAAgBC,KAAcD,IACpF,CACNzB,QAASyB,EAAQE,oBACjB1B,KAAMwB,EAAQG,WACdzB,MAAOsB,EAAQI,gBACfxB,YAAY,EACZD,MAAOqB,MAGT,MAAO,CAACnC,KAAKS,gBAAgB+B,OAAOR,EACrC,CAEQR,cAAcK,GAChB7B,KAAAuB,eAAiBvB,KAAK+B,oBAE3B/B,KAAKmB,aAAaH,UAAY,GACzBhB,KAAAuB,eAAekB,SAAQC,GAAU1C,KAAKmB,aAAawB,YAAY3C,KAAK4C,WAAWF,MAEpF,MAAMG,EAAiB7C,KAAKO,cACvBP,KAAAO,cAAgBP,KAAKQ,gBACrBsC,EAAWC,OAAOF,EAAgB7C,KAAKO,eAGtCP,KAAAgD,cAAchD,KAAKO,eAFxBP,KAAKiD,aAAapB,EAIpB,CAEQe,WAAWM,GACZ,MAAAR,EAASlD,GAAiB2D,eAAeD,GASxC,OAPAR,EAAAtB,iBAAiB,SAAkBC,IACzCA,EAAMC,iBACNtB,KAAKI,UAAY8C,EAAKpC,MACjBd,KAAAO,cAAgBP,KAAKQ,gBACrBR,KAAAiD,aAAaxB,EAAWC,cAAa,IAGpCgB,CACR,CAEAU,eACC,OAAOpD,KAAKiB,UACb,CAEAT,gBACC,OAAIR,KAAKI,UACDJ,KAAKI,UAAUiD,iBAEfC,GAET,CAEAN,cAAcO,GACRvD,KAAAO,cAAgBuC,EAAWU,MAAMD,GACtCvD,KAAKI,UAAYJ,KAAKJ,KAAKS,wBAAwBL,KAAKO,eAElD,MAAAkD,EAAazD,KAAKuB,eAAemC,MAAKD,GAAcA,EAAW3C,OAASd,KAAKI,YAC9EqD,IAILzD,KAAKiB,WAAWD,UAAY,GAC5BhB,KAAKiB,WAAW0B,YAAYnD,GAAiB2D,eAAeM,IAC7D,CAEAE,sBAAsBT,GACf,MAAAU,EAAkBC,SAASC,cAAc,OAC/BF,EAAA1D,UAAUC,IAAI,6BAExB,MAAAuC,EAASmB,SAASC,cAAc,OAWtC,GAVOpB,EAAAxC,UAAUC,IAAI,6BACrByD,EAAgBjB,YAAYD,GACxBQ,EAAKnC,YACD2B,EAAAxC,UAAUC,IAAI,mBAGlB+C,EAAKrC,QACD6B,EAAAqB,MAAMC,gBAAkBd,EAAKrC,OAGjCqC,EAAKxC,QAAS,CACX,MAAAuD,EAAOJ,SAASC,cAAc,OACpCG,EAAKC,IAAMhB,EAAKxC,QACXuD,EAAA/D,UAAUC,IAAI,2BACnBuC,EAAOC,YAAYsB,EACpB,CAEA,GAAIf,EAAKvC,KAAM,CACR,MAAAwD,EAAQN,SAASC,cAAc,QACrCK,EAAMC,YAAclB,EAAKvC,KACnBwD,EAAAjE,UAAUC,IAAI,4BACpBuC,EAAOC,YAAYwB,EACpB,CAEO,OAAAP,CACR,ECnHM,MAAMS,GAAkH,CAC3H,CAACC,EAAKC,iBAAkB,CAACC,EAAyBrC,IAAwB,IAAIsC,GAAiBD,EAAYrC,GAC9G,CAACmC,EAAKI,kBAAmB,CAACF,EAAyBrC,IAAwB,IAAIwC,GAAkBH,EAAYrC,GAC1G,CAACmC,EAAKM,gBAAiB,CAACJ,EAAyBrC,IAAwB,IAAI0C,GAAgBL,EAAYrC,GACzG,CAACmC,EAAKQ,oBAAqB,CAACN,EAAyBrC,IAAwB,IAAI4C,GAAoBP,EAAYrC,GACjH,CAACmC,EAAKU,qBAAsB,CAACR,EAAyBrC,IAAwB,IAAI8C,GAAqBT,EAAYrC,GACnH,CAACmC,EAAKY,uBAAwB,CAACV,EAAyBrC,IAAwB,IAAIgD,GAAuBX,EAAYrC,GACvH,CAACmC,EAAKc,YAAa,CAACZ,EAAyBrC,IAAwB,IAAIkD,GAAYb,EAAYrC,GACjG,CAACmC,EAAKgB,UAAW,CAACd,EAAyBrC,IAAwB,IAAIoD,GAAUf,EAAYrC,GAC7F,CAACmC,EAAKkB,WAAY,CAAChB,EAAyBrC,IAAwB,IAAIsD,GAAWjB,EAAYrC,GAC/F,CAACmC,EAAKoB,wBAAyB,CAAClB,EAAyBrC,IAAwB,IAAIwD,GAAwBnB,EAAYrC,GACzH,CAACmC,EAAKsB,uBAAwB,CAACpB,EAAyBrC,IAAwB,IAAI0D,GAAuBrB,EAAYrC,GACvH,CAACmC,EAAKwB,kBAAmB,CAACtB,EAAyBrC,IAAwB,IAAI4D,GAAkBvB,EAAYrC,GAC7G,CAACmC,EAAK0B,iBAAkB,CAACxB,EAAyBrC,IAAwB,IAAI8D,GAAiBzB,EAAYrC,GAC3G,CAACmC,EAAK4B,aAAc,CAAC1B,EAAyBrC,IAAwB,IAAIgE,GAAa3B,EAAYrC,GACnG,CAACmC,EAAK8B,uBAAwB,CAAC5B,EAAyBrC,IAAwB,IAAIkE,GAAuB7B,EAAYrC,GACvH,CAACmC,EAAKgC,aAAc,CAAC9B,EAAyBrC,IAAwB,IAAIoE,GAAa/B,EAAYrC,IAuC1FqE,GAAgD,CAC5D,CACCC,KAAMnC,EAAKC,gBACXmC,SAAUC,GACVC,QAASC,GAAgC3D,KACzC4D,YAAaC,GACbC,SAAUC,GACVC,YAAa,WACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKG,UACzB,CAACL,EAAQM,OAAQJ,EAAKK,WAEvBC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAGK,GAAuCC,MAE3C,CAACV,EAAQM,OAAQ,CAChB,EAAGG,GAAuCC,OAG5CC,cAAeC,GACfC,QAAS,qBACTvH,QAASwH,EAAgBC,EAAMC,kBAAkB,IAElD,CACC3B,KAAMnC,EAAKC,gBACXmC,SAAU2B,GACVzB,QAAS0B,GAA0CpF,KACnD4D,YAAayB,GACbvB,SAAUC,GACVC,YAAa,eACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKG,UACzB,CAACL,EAAQM,OAAQJ,EAAKK,WAEvBC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAGgB,GAA2CV,MAE/C,CAACV,EAAQM,OAAQ,CAChB,EAAGc,GAA2CV,OAGhDC,cAAeC,GACfC,QAAS,uBACTvH,QAASwH,EAAgBC,EAAMC,kBAAkB,IAElD,CACC3B,KAAMnC,EAAKC,gBACXmC,SAAU+B,GACV7B,QAAS8B,GAAgCxF,KACzC4D,YAAa6B,GACb3B,SAAUC,GACVC,YAAa,eACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKG,UACzB,CAACL,EAAQM,OAAQJ,EAAKK,WAEvBC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAGoB,GAAuCd,MAE3C,CAACV,EAAQM,OAAQ,CAChB,EAAGkB,GAAuCd,OAG5CC,cAAeC,GACfC,QAAS,eACTvH,QAASwH,EAAgBC,EAAMC,kBAAkB,IAElD,CACC3B,KAAMnC,EAAKI,iBACXgC,SAAUmC,GACVjC,QAASkC,GAAoC5F,KAC7C4D,YAAaiC,GACb/B,SAAUgC,GACV9B,YAAa,gBACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAK2B,aACzB,CAAC7B,EAAQM,OAAQJ,EAAK4B,YAEvBtB,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAG2B,GAA8BrB,MAElC,CAACV,EAAQM,OAAQ,CAChB,EAAGyB,GAA8BrB,OAGnCG,QAASmB,EAAU9E,EAAKI,kBACxBhE,QAAS2I,EAAe/E,EAAKI,mBAE9B,CACC+B,KAAMnC,EAAKM,eACX8B,SAAU4C,GACV1C,QAAS2C,GAAkCrG,KAC3C4D,YAAa0C,GACbxC,SAAUyC,GACVvC,YAAa,YACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAK2B,aACzB,CAAC7B,EAAQM,OAAQJ,EAAK4B,YAEvBtB,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAGkC,GAA4B5B,MAEhC,CAACV,EAAQM,OAAQ,CAChB,EAAGgC,GAA4B5B,OAGjCG,QAASmB,EAAU9E,EAAKM,gBACxBlE,QAAS2I,EAAe/E,EAAKM,iBAE9B,CACC6B,KAAMnC,EAAKQ,mBACX4B,SAAUiD,GACV/C,QAASgD,GAAsC1G,KAC/C4D,YAAa+C,GACb7C,SAAU8C,GACV5C,YAAa,aACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAK2B,aACzB,CAAC7B,EAAQM,OAAQJ,EAAK4B,YAEvBtB,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAGuC,GAAgCjC,MAEpC,CAACV,EAAQM,OAAQ,CAChB,EAAGqC,GAAgCjC,OAGrCG,QAASmB,EAAU9E,EAAKQ,oBACxBpE,QAAS2I,EAAe/E,EAAKQ,qBAE9B,CACC2B,KAAMnC,EAAKc,WACXsB,SAAUsD,GACVpD,QAASqD,GAAkC/G,KAC3C4D,YAAaoD,GACblD,SAAUmD,GACVjD,YAAa,YACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAK2B,aACzB,CAAC7B,EAAQM,OAAQJ,EAAK8C,SAEvBxC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAG6C,GAAwBvC,MAE5B,CAACV,EAAQM,OAAQ,CAChB,EAAG2C,GAAwBvC,OAG7BG,QAAS,YACTvH,QAASwH,EAAgBC,EAAMmC,aAAa,IAE7C,CACC7D,KAAMnC,EAAKc,WACXsB,SAAUsD,GACVpD,QAAS2D,GAA8BrH,KACvC4D,YAAa0D,GACbxD,SAAUmD,GACVjD,YAAa,YACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAK2B,aACzB,CAAC7B,EAAQM,OAAQJ,EAAK8C,SAEvBxC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAG6C,GAAwBvC,MAE5B,CAACV,EAAQM,OAAQ,CAChB,EAAG2C,GAAwBvC,OAG7BG,QAAS,YACTvH,QAASwH,EAAgBC,EAAMmC,aAAa,IAE7C,CACC7D,KAAMnC,EAAKc,WACXsB,SAAUsD,GACVpD,QAAS6D,GAA8BvH,KACvC4D,YAAa0D,GACbxD,SAAUmD,GACVjD,YAAa,YACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAK2B,aACzB,CAAC7B,EAAQM,OAAQJ,EAAK8C,SAEvBxC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAG6C,GAAwBvC,MAE5B,CAACV,EAAQM,OAAQ,CAChB,EAAG2C,GAAwBvC,OAG7BG,QAAS,YACTvH,QAASwH,EAAgBC,EAAMmC,aAAa,IAE7C,CACC7D,KAAMnC,EAAKgB,SACXoB,SAAUgE,GACV9D,QAAS+D,GAA0BzH,KACnC4D,YAAa8D,GACb5D,SAAU6D,GACV3D,YAAa,cACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKwD,UACzB,CAAC1D,EAAQM,OAAQJ,EAAKK,WAEvBC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAGuD,GAA6BjD,MAEjC,CAACV,EAAQM,OAAQ,CAChB,EAAGqD,GAA6BjD,OAGlCG,QAAS,cACTvH,QAASwH,EAAgBC,EAAM6C,WAAW,IAE3C,CACCvE,KAAMnC,EAAKgB,SACXoB,SAAUuE,GACVrE,QAASsE,GAAwBhI,KACjC4D,YAAaqE,GACbnE,SAAUoE,GACVlE,YAAa,YACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKwD,UACzB,CAAC1D,EAAQM,OAAQJ,EAAKK,WAEvBC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAG6D,GAA2BvD,MAE/B,CAACV,EAAQM,OAAQ,CAChB,EAAG2D,GAA2BvD,OAGhCG,QAAS,YACTvH,QAASwH,EAAgBC,EAAM6C,WAAW,IAE3C,CACCvE,KAAMnC,EAAKgB,SACXoB,SAAU4E,GACV1E,QAAS2E,GAAyBrI,KAClC4D,YAAa0E,GACbxE,SAAUyE,GACVvE,YAAa,aACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKwD,UACzB,CAAC1D,EAAQM,OAAQJ,EAAKK,WAEvBC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAGkE,GAA4B5D,MAEhC,CAACV,EAAQM,OAAQ,CAChB,EAAGgE,GAA4B5D,OAGjCG,QAAS,aACTvH,QAASwH,EAAgBC,EAAM6C,WAAW,IAE3C,CACCvE,KAAMnC,EAAKkB,UACXkB,SAAUiF,GACV/E,QAASgF,GAA2B1I,KACpC4D,YAAa+E,GACb7E,SAAU8E,GACV5E,YAAa,eACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKG,UACzB,CAACL,EAAQM,OAAQJ,EAAK8C,SAEvBxC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAGuE,GAAuBjE,MAE3B,CAACV,EAAQM,OAAQ,CAChB,EAAGqE,GAAuBjE,OAG5BG,QAAS,eACTvH,QAAS2I,EAAe/E,EAAKkB,YAE9B,CACCiB,KAAMnC,EAAKU,oBACX0B,SAAUsF,GACVpF,QAASqF,GAAuC/I,KAChD4D,YAAaoF,GACblF,SAAUmF,GACVjF,YAAa,aACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAK8E,YACzB,CAAChF,EAAQM,OAAQJ,EAAK8C,SAEvBxC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAG6E,GAAiCvE,MAErC,CAACV,EAAQM,OAAQ,CAChB,EAAG2E,GAAiCvE,OAGtCG,QAASmB,EAAU9E,EAAKU,qBACxBtE,QAAS2I,EAAe/E,EAAKU,sBAE9B,CACCyB,KAAMnC,EAAKY,sBACXwB,SAAU4F,GACV1F,QAAS2F,GAAyCrJ,KAClD4D,YAAa0F,GACbxF,SAAUyF,GACVvF,YAAa,aACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAK8E,YACzB,CAAChF,EAAQM,OAAQJ,EAAK8C,SAEvBxC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAGkF,GAAmC5E,MAEvC,CAACV,EAAQM,OAAQ,CAChB,EAAGgF,GAAmC5E,OAGxCG,QAASmB,EAAU9E,EAAKY,uBACxBxE,QAAS2I,EAAe/E,EAAKY,wBAE9B,CACCuB,KAAMnC,EAAKwB,iBACXY,SAAUiG,GACV/F,QAASgG,GAAoC1J,KAC7C4D,YAAa+F,GACb7F,SAAU8F,GACV5F,YAAa,gBACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKyF,UACzB,CAAC3F,EAAQM,OAAQJ,EAAK0F,YAEvBpF,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAGyF,GAA8BnF,MAElC,CAACV,EAAQM,OAAQ,CAChB,EAAGuF,GAA8BnF,OAGnCG,QAASmB,EAAU9E,EAAKwB,kBACxBpF,QAAS2I,EAAe/E,EAAKwB,mBAE9B,CACCW,KAAMnC,EAAK0B,gBACXU,SAAUwG,GACVtG,QAASuG,GAAmCjK,KAC5C4D,YAAasG,GACbpG,SAAUqG,GACVnG,YAAa,eACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKyF,UACzB,CAAC3F,EAAQM,OAAQJ,EAAK0F,YAEvBpF,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAG8F,GAA6BxF,MAEjC,CAACV,EAAQM,OAAQ,CAChB,EAAG4F,GAA6BxF,OAGlCG,QAASmB,EAAU9E,EAAK0B,iBACxBtF,QAAS2I,EAAe/E,EAAK0B,kBAE9B,CACCS,KAAMnC,EAAK4B,YACXQ,SAAU6G,GACV3G,QAAS4G,GAA2BtK,KACpC4D,YAAa2G,GACbzG,SAAU0G,GACVxG,YAAa,eACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKG,UACzB,CAACL,EAAQM,OAAQJ,EAAK8C,SAEvBxC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAGmG,GAA8B7F,MAElC,CAACV,EAAQM,OAAQ,CAChB,EAAGiG,GAA8B7F,OAGnCG,QAAS,eACTvH,QAASwH,EAAgBC,EAAMyF,cAAc,IAE9C,CACCnH,KAAMnC,EAAK4B,YACXQ,SAAUmH,GACVjH,QAASkH,GAA2B5K,KACpC4D,YAAa2G,GACbzG,SAAU0G,GACVxG,YAAa,eACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKG,UACzB,CAACL,EAAQM,OAAQJ,EAAK8C,SAEvBxC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAGuG,GAA8BjG,MAElC,CAACV,EAAQM,OAAQ,CAChB,EAAGqG,GAA8BjG,OAGnCG,QAAS,eACTvH,QAASwH,EAAgBC,EAAMyF,cAAc,IAE9C,CACCnH,KAAMnC,EAAK8B,sBACXM,SAAUsH,GACVpH,QAASqH,GAAyC/K,KAClD4D,YAAaoH,GACblH,SAAUmH,GACVjH,YAAa,eACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKG,UACzB,CAACL,EAAQM,OAAQJ,EAAK8C,SAEvBxC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAG4G,GAA4CtG,MAEhD,CAACV,EAAQM,OAAQ,CAChB,EAAG0G,GAA4CtG,OAGjDG,QAAS,qBACTvH,QAASwH,EAAgBC,EAAMyF,cAAc,IAE9C,CACCnH,KAAMnC,EAAKoB,uBACXgB,SAAU2H,GACVzH,QAAS0H,GAA6CpL,KACtD4D,YAAayH,GACbvH,SAAUwH,GACVtH,YAAa,cACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKG,UACzB,CAACL,EAAQM,OAAQJ,EAAKmH,cAEvB7G,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAGkH,GAAoC5G,KACvC,EAAG6G,GAAoC7G,KACvC,EAAG8G,GAAoC9G,KACvC,EAAG+G,GAAoC/G,KACvC,EAAGgH,GAAoChH,MAExC,CAACV,EAAQM,OAAQ,CAChB,EAAGgH,GAAoC5G,KACvC,EAAG6G,GAAoC7G,KACvC,EAAG8G,GAAoC9G,KACvC,EAAG+G,GAAoC/G,KACvC,EAAGgH,GAAoChH,OAGzCG,QAAS,cACTvH,QAASwH,EAAgBC,EAAM4G,cAAc,IAE9C,CACCtI,KAAMnC,EAAKsB,sBACXc,SAAUsI,GACVpI,QAASqI,GAA2C/L,KACpD4D,YAAaoI,GACblI,SAAUmI,GACVjI,YAAa,eACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKG,UACzB,CAACL,EAAQM,OAAQJ,EAAKmH,cAEvB7G,YAAa,CACZ,CAACR,EAAQC,SAAU,CAAC,EACpB,CAACD,EAAQI,UAAW,CACnB,EAAG4H,GAAmCtH,MAEvC,CAACV,EAAQM,OAAQ,CAChB,EAAG0H,GAAmCtH,OAGxCG,QAAS,qBACTvH,QAASwH,EAAgBC,EAAM4G,cAAc,IAE9C,CACCtI,KAAMnC,EAAKgC,YACXI,SAAU2I,GACVzI,QAAS0I,GAAkCpM,KAC3C4D,YAAayI,GACbvI,SAAUwI,GACVtI,YAAa,iBACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKG,UACzB,CAACL,EAAQM,OAAQJ,EAAK8C,SAEvBxC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAClB,EAAGoI,GAAqC3H,KACxC,EAAG4H,GAA4B5H,MAEhC,CAACV,EAAQI,UAAW,CACnB,EAAGiI,GAAqC3H,KACxC,EAAG4H,GAA4B5H,MAEhC,CAACV,EAAQM,OAAQ,CAChB,EAAG+H,GAAqC3H,KACxC,EAAG4H,GAA4B5H,OAGjCC,cAAe4H,GACf1H,QAAS,+DACTvH,QAASwH,EAAgBC,EAAMyH,cAAc,IAE9C,CACCnJ,KAAMnC,EAAKgC,YACXI,SAAUmJ,GACVjJ,QAASkJ,GAAiC5M,KAC1C4D,YAAaiJ,GACb/I,SAAUwI,GACVtI,YAAa,gBACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKG,UACzB,CAACL,EAAQM,OAAQJ,EAAK8C,SAEvBxC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAClB,EAAG2I,GAAoClI,KACvC,EAAGmI,GAA4BnI,MAEhC,CAACV,EAAQI,UAAW,CACnB,EAAGwI,GAAoClI,KACvC,EAAGmI,GAA4BnI,MAEhC,CAACV,EAAQM,OAAQ,CAChB,EAAGsI,GAAoClI,KACvC,EAAGmI,GAA4BnI,OAGjCC,cAAe4H,GACf1H,QAAS,qDACTvH,QAASwH,EAAgBC,EAAMyH,cAAc,IAE9C,CACCnJ,KAAMnC,EAAKgC,YACXI,SAAUwJ,GACVtJ,QAASuJ,GAAiCjN,KAC1C4D,YAAasJ,GACbpJ,SAAUwI,GACVtI,YAAa,eACbC,oBAAqB,CACpB,CAACC,EAAQC,SAAUC,EAAKC,YACxB,CAACH,EAAQI,UAAWF,EAAKG,UACzB,CAACL,EAAQM,OAAQJ,EAAK8C,SAEvBxC,YAAa,CACZ,CAACR,EAAQC,SAAU,CAClB,EAAGoI,GAAqC3H,KACxC,EAAG4H,GAA4B5H,MAEhC,CAACV,EAAQI,UAAW,CACnB,EAAGiI,GAAqC3H,KACxC,EAAG4H,GAA4B5H,MAEhC,CAACV,EAAQM,OAAQ,CAChB,EAAG+H,GAAqC3H,KACxC,EAAG4H,GAA4B5H,OAGjCC,cAAe4H,GACf1H,QAAS,wCACTvH,QAASwH,EAAgBC,EAAMyH,cAAc,KAIlCS,GAAgC,IAAI,IAAIC,IAAI9J,GAAcpE,KAAcmO,GAAAA,EAAO9J,SAE/E+J,GAAyC,CAClD,CAEIC,UAAW,OACXC,YAAY,EACZjK,KAAMnC,EAAKI,iBACXiM,KAAM,OACN1I,QAAS,kFACTvH,QAAS,4EACTkQ,gBAAiB,CAACC,EAAkBC,EAAsBC,KAC5CD,EAAAE,MAAOC,cAAgBC,KAAKC,IAAIL,EAAUE,MAAOC,cAAeG,EAAeC,uBAC/EP,EAAAE,MAAOM,OAASJ,KAAKC,IAAIL,EAAUE,MAAOM,OAAQF,EAAeC,uBACjEP,EAAAS,QAASC,WAAaN,KAAKC,IAAIL,EAAUS,QAASC,WAAYJ,EAAeC,uBAC7EP,EAAAE,MAAOS,gBAAkBP,KAAKC,IAAIL,EAAUE,MAAOS,gBAAiBL,EAAeC,uBAEvF,MAAAK,EAAiBb,EAAQc,yBAAyBC,YACxD,GAAIF,GAAkBG,EAAW,CAC7B,MAAMC,EAAaZ,KAAKa,MAAML,EAAiB,GACzCM,EAAcN,EAAiB,EAC/BO,EAAcnB,EAAUoB,QAAQJ,GAAYK,QAAQH,GACtDC,EAAYjB,OACZiB,EAAYjB,MAAMoB,YAE1B,IAGR,CAEI3B,UAAW,cACXhK,KAAMnC,EAAKI,iBACXiM,KAAM,cACN1I,QAAS,iEACTvH,QAAS,8EACTkQ,gBAAiB,CAACC,EAAkBC,EAAsBC,KAC5CD,EAAAE,MAAOC,cAAgBG,EAAeiB,uBACtCvB,EAAAE,MAAOM,OAASJ,KAAKC,IAAIL,EAAUE,MAAOM,OAAQF,EAAeC,uBAErE,MAAAK,EAAiBb,EAAQc,yBAAyBC,YACxD,GAAIF,GAAkBG,EAAW,CAC7B,MAAMC,EAAaZ,KAAKa,MAAML,EAAiB,GACzCM,EAAcN,EAAiB,EAC/BO,EAAcnB,EAAUoB,QAAQJ,GAAYK,QAAQH,GACtDC,EAAYjB,OACZiB,EAAYjB,MAAMoB,YAE1B,IAGR,CAEI3B,UAAW,aACXhK,KAAMnC,EAAKI,iBACXiM,KAAM,aACN1I,QAAS,sFACTvH,QAAS,4EACTkQ,gBAAiB,CAACC,EAAkBC,EAAsBC,KAC5CD,EAAAE,MAAOC,cAAgBG,EAAeiB,uBACtCvB,EAAAE,MAAOM,OAASF,EAAeiB,uBAC/BvB,EAAAS,QAASC,WAAaJ,EAAeiB,uBAEzC,MAAAX,EAAiBb,EAAQc,yBAAyBC,YACxD,GAAIF,GAAkBG,EAAW,CAC7B,MAAMC,EAAaZ,KAAKa,MAAML,EAAiB,GACzCM,EAAcN,EAAiB,EAC/BO,EAAcnB,EAAUoB,QAAQJ,GAAYK,QAAQH,GACtDC,EAAYjB,OACZiB,EAAYjB,MAAMoB,YAE1B,IAGR,CAEI3B,UAAW,OACXC,YAAY,EACZjK,KAAMnC,EAAKgB,SACXqL,KAAM,OACN1I,QAAS,gCACTvH,QAAS,+EACTkQ,gBAAiB,CAACC,EAAkBC,EAAsBC,KACtDD,EAAUE,MAAOsB,kBAAmB,CAAA,GAG5C,CAEI7B,UAAW,UACXhK,KAAMnC,EAAKoB,uBACXiL,KAAM,eACN1I,QAAS,yCACTvH,QAASwH,EAAgBC,EAAM4G,cAAc,GAC7C6B,gBAAiB,CAACC,EAAkBC,EAAsBC,KAAzC,GAIrB,CAEIN,UAAW,cACXhK,KAAMnC,EAAKoB,uBACXiL,KAAM,cACN1I,QAAS,gEACTvH,QAAS,iFACTkQ,gBAAiB,CAACC,EAAkBC,EAAsBC,KAEtDD,EAAUS,QAASgB,mBAAoB,CAAA,GAG/C,CAEI9B,UAAW,cACXhK,KAAMnC,EAAKwB,iBACX6K,KAAM,cACN1I,QAAS,iEACTvH,QAASwH,EAAgBC,EAAMqK,aAAa,GAC5C5B,gBAAiB,CAACC,EAAkBC,EAAsBC,KACtDD,EAAUE,MAAOyB,kBAAmB,EAC1B3B,EAAAE,MAAO0B,mBAAqBtB,EAAeiB,sBAAA,GAG7D,CAEI5B,UAAW,uBACXhK,KAAMnC,EAAKwB,iBACX6K,KAAM,cACN1I,QAAS,sGACTvH,QAAS,8EACTkQ,gBAAiB,CAACC,EAAkBC,EAAsBC,KACtDD,EAAUE,MAAOyB,kBAAmB,EAC1B3B,EAAAE,MAAO0B,mBAAqBtB,EAAeiB,uBACrDvB,EAAUE,MAAO2B,cAAe,EAEnC,MAAAC,EAAqB/B,EAAQgC,6BAA6BjB,YAChE,GAAIgB,GAAsBf,EAAW,CACpC,MAAMC,EAAaZ,KAAKa,MAAMa,EAAqB,GAC7CZ,EAAcY,EAAqB,EACnCX,EAAcnB,EAAUoB,QAAQJ,GAAYK,QAAQH,GACtDC,EAAYjB,OACfiB,EAAYjB,MAAM8B,gBAEpB,IAGF,CAECrC,UAAW,QACXhK,KAAMnC,EAAKwB,iBACX6K,KAAM,QACN1I,QAAS,oBACTvH,QAAS,mFACTkQ,gBAAiB,CAACC,EAAkBC,EAAsBC,KACnD,MAAAgC,EAAwBlC,EAAQmC,gCAAgCpB,YACtE,GAAImB,GAAyBlB,EAAW,CACvC,MAAMC,EAAaZ,KAAKa,MAAMgB,EAAwB,GAChDf,EAAce,EAAwB,EACtCd,EAAcnB,EAAUoB,QAAQJ,GAAYK,QAAQH,GACtDC,EAAYjB,OACfiB,EAAYjB,MAAMiC,mBAEpB,IAGF,CAECxC,UAAW,eACXhK,KAAMnC,EAAKU,oBACX2L,KAAM,eACN1I,QAAS,2IACTvH,QAASwH,EAAgBC,EAAM+K,aAAa,GAC5CtC,gBAAiB,CAACC,EAAkBC,EAAsBC,KACzDD,EAAUE,MAAOmC,WAAY,EACnBrC,EAAAE,MAAOoC,gBAAkBhC,EAAeiB,uBAClDtB,EAAWC,MAAOqC,iBAGT,MAAMC,EAAW,CACbhP,EAAKI,iBACLJ,EAAKgB,SACLhB,EAAKwB,iBACLxB,EAAK0B,gBACL1B,EAAKY,sBACLZ,EAAKU,oBACLV,EAAKgC,aAEHiN,EAAU,CACZjP,EAAKoB,uBACLpB,EAAKkB,UACLlB,EAAK4B,YACL5B,EAAK8B,sBACL9B,EAAKM,eACLN,EAAKQ,qBAEF0O,EAAUC,GAAW,CAACH,EAAUC,GAClCnR,KAAasR,GAAA3C,EAAWoB,QACpBjQ,WAAiBC,EAAOwR,OAASxL,EAAMyL,eACvCxR,KAAcD,GAAA0R,EAAa1R,KAC3BD,QAAO4R,GAAcJ,EAAMK,SAASD,KACpCE,SAELR,GAAYC,EACZ3C,EAAUE,MAAOiD,iBAAkB,EAEzBnD,EAAAE,MAAOkD,cAAgB9C,EAAeC,qBACpD,GAGR,CAEIZ,UAAW,eACXC,YAAY,EACZjK,KAAMnC,EAAK4B,YACXyK,KAAM,eACN1I,QAAS,4EACTvH,QAAS,gFACTkQ,gBAAiB,CAACC,EAAkBC,EAAsBC,KAC5CD,EAAAE,MAAOmD,YAAc/C,EAAeiB,uBAC9C,MAAMd,EAAUT,EAAUS,QAC1BA,EAAQ6C,aAAc,EACtB7C,EAAQ8C,aAAc,CAAA,GAG9B,CAEI5D,UAAW,eACXC,YAAY,EACZjK,KAAMnC,EAAK4B,YACXyK,KAAM,eACN1I,QAAS,6DACTvH,QAAS,+EACTkQ,gBAAiB,CAACC,EAAkBC,EAAsBC,KAC5CD,EAAAE,MAAOmD,YAAc/C,EAAeiB,uBAC9BvB,EAAUS,QAClB6C,aAAc,CAAA,GAG9B,CAEI3D,UAAW,eACXC,YAAY,EACZjK,KAAMnC,EAAK4B,YACXyK,KAAM,eACN1I,QAAS,mCACTvH,QAAS,mEACTkQ,gBAAiB,CAACC,EAAkBC,EAAsBC,KACtCD,EAAUS,QAClB6C,aAAc,CAAA,GAGjC,CAEC3D,UAAW,mBACXhK,KAAMnC,EAAKC,gBACXoM,KAAM,WACN1I,QAAS,mCACTvH,QAAS,kFACTkQ,gBAAiB,CAACC,EAAkBC,EAAsBC,KACnD,MAAAuD,EAAoBzD,EAAQ0D,4BAA4B3C,YAC9D,GAAI0C,GAAqBzC,EAAW,CACnC,MAAMC,EAAaZ,KAAKa,MAAMuC,EAAoB,GAC5CtC,EAAcsC,EAAoB,EAClCrC,EAAcnB,EAAUoB,QAAQJ,GAAYK,QAAQH,GACtDC,EAAYjB,OACfiB,EAAYjB,MAAMwD,cAEpB,KCp+BI,MAAMC,GAoBZ/U,YAAYgV,EAAYC,GAlBX3U,KAAAyG,KAAA,EACEzG,KAAA2Q,KAAA,GAEf3Q,KAAQ4U,WARoB,EAS5B5U,KAAQ6U,oBAAkCvR,IAC1CtD,KAAQ8U,wBAAsCxR,IAC9CtD,KAAQ+U,2BAAyCzR,IACjDtD,KAAQgV,uBAAqC1R,IAEpCtD,KAAAiV,uBAAyB,IAAIxT,EAC7BzB,KAAAkV,iCAAmC,IAAIzT,EACvCzB,KAAAmV,qCAAuC,IAAI1T,EAC3CzB,KAAAoV,wCAA0C,IAAI3T,EAC9CzB,KAAAqV,oCAAsC,IAAI5T,EAC1CzB,KAAAsV,cAAgB,IAAI7T,EAK5B,MAAM8T,EAAW/E,GAAe9M,MAAe6M,GAAAA,EAAOE,WAAaiE,IACnE,IAAKa,EACJ,MAAM,IAAIC,MAAM,+BAAkCd,EAAK,MAGxD1U,KAAK2U,IAAMA,EACX3U,KAAKuV,SAAWA,EAChBvV,KAAKyV,iBAEL,CACCzV,KAAKiV,uBACLjV,KAAKkV,iCACLlV,KAAKmV,qCACLnV,KAAKoV,wCACLpV,KAAKqV,qCACJ5S,SAAQiT,GAAWA,EAAQ9T,IAAcC,GAAA7B,KAAKsV,cAAcK,KAAK9T,OAEnE7B,KAAKsV,cAAc1T,IAAcC,GAAA8S,EAAI/U,KAAKgW,SAAS5V,KAAK6V,iBAAiBP,cAAcK,KAAK9T,IAC7F,CAEQ4T,iBACFzV,KAAAyG,KAAOzG,KAAKuV,SAAS9O,KACrBzG,KAAA2Q,KAAO3Q,KAAKuV,SAAS5E,IAC3B,CAEArO,WACC,MAAO,GAAGtC,KAAK2Q,UAAU3Q,KAAK8V,eAAiB,IAChD,CAEAC,WACQ,OAAAC,EAAYhW,KAAKuV,SAAS9O,KAClC,CAEAlE,gBACQ,OAAA0T,EAAYjW,KAAK+V,WACzB,CAEAD,eACC,OAAO9V,KAAK4U,SACb,CACAsB,aAAarU,EAAkBsU,GAC1BA,GAAgBnW,KAAK4U,YACxB5U,KAAK4U,UAAYuB,EACjB1U,EAAW2U,gBAAe,KACpBpW,KAAAiV,uBAAuBU,KAAK9T,GACjC7B,KAAK2U,IAAI/U,KAAK+B,kBAAkBgU,KAAK9T,EAAO,IAG/C,CAEAgU,gBACC,OAAO3E,KAAKa,MAAM/R,KAAK8V,eAAiB,EACzC,CAEAnE,yBAEQ,OAAA7O,EAAWU,MAAMxD,KAAK6U,oBAC9B,CACAwB,uBAAuBxU,EAAkByU,GACpCxT,EAAWC,OAAOuT,EAAwBtW,KAAK6U,uBAI9C7U,KAAA6U,oBAAsB/R,EAAWU,MAAM8S,GACvCtW,KAAAkV,iCAAiCS,KAAK9T,GAC5C,CAEAgR,6BAEQ,OAAA/P,EAAWU,MAAMxD,KAAK8U,wBAC9B,CACAyB,2BAA2B1U,EAAkB2U,GACxC1T,EAAWC,OAAOyT,EAA4BxW,KAAK8U,2BAIlD9U,KAAA8U,wBAA0BhS,EAAWU,MAAMgT,GAC3CxW,KAAAmV,qCAAqCQ,KAAK9T,GAChD,CAEAmR,gCAEQ,OAAAlQ,EAAWU,MAAMxD,KAAK+U,2BAC9B,CACA0B,8BAA8B5U,EAAkB6U,GAC3C5T,EAAWC,OAAO2T,EAA+B1W,KAAK+U,8BAIrD/U,KAAA+U,2BAA6BjS,EAAWU,MAAMkT,GAC9C1W,KAAAoV,wCAAwCO,KAAK9T,GACnD,CAEA0S,4BAEQ,OAAAzR,EAAWU,MAAMxD,KAAKgV,uBAC9B,CACA2B,0BAA0B9U,EAAkB+U,GACvC9T,EAAWC,OAAO6T,EAA2B5W,KAAKgV,0BAIjDhV,KAAAgV,uBAAyBlS,EAAWU,MAAMoT,GAC1C5W,KAAAqV,oCAAoCM,KAAK9T,GAC/C,CAEAgV,UACC,OAAOC,EAAaC,OAAO,CAC1BrC,GAAI1U,KAAKuV,SAAS9E,UAClBmE,UAAW5U,KAAK8V,eAChBjB,oBAAqB7U,KAAK2R,yBAC1BmD,wBAAyB9U,KAAK6S,6BAC9BkC,2BAA4B/U,KAAKgT,gCACjCgC,uBAAwBhV,KAAKuU,6BAE/B,CAEAyC,UAAUnV,EAAkBoV,GACrB,MAAA1B,EAAW/E,GAAe9M,SAAe6M,EAAOE,WAAawG,EAAMvC,KACzE,IAAKa,EACJ,MAAM,IAAIC,MAAM,+BAAkCyB,EAAMvC,GAAK,MAE9D1U,KAAKuV,SAAWA,EAChBvV,KAAKyV,iBACLhU,EAAW2U,gBAAe,KACpBpW,KAAAkW,aAAarU,EAASoV,EAAMrC,WACjC5U,KAAKqW,uBAAuBxU,EAASoV,EAAMpC,qBAAuBvR,KAClEtD,KAAKuW,2BAA2B1U,EAASoV,EAAMnC,yBAA2BxR,KAC1EtD,KAAKyW,8BAA8B5U,EAASoV,EAAMlC,4BAA8BzR,KAChFtD,KAAK2W,0BAA0B9U,EAASoV,EAAMjC,wBAA0B1R,IAAiB,GAE3F,CAEAE,MAAM3B,GACL,MAAMqV,EAAa,IAAIzC,GAAQzU,KAAKuV,SAAS9E,UAAWzQ,KAAK2U,KAEtD,OADPuC,EAAWF,UAAUnV,EAAS7B,KAAK6W,WAC5BK,CACR,EC1JM,MAAMC,WAA0BC,EAStC1X,YAAY8E,EAAyB6S,GACpCtX,MAAMyE,EAAY,2BARPxE,KAAAsV,cAAkC,IAAI7T,EASjDzB,KAAKqX,UAAYA,EACjBrX,KAAKsX,iBAAmB,IAAIC,GAAiBvX,KAAKC,SAAUoX,GAC5DrX,KAAKwX,qBAAuB,IAAIC,GAAqBzX,KAAKC,SAAUoX,GACpErX,KAAK0X,wBAA0B,IAAIC,GAAwB3X,KAAKC,SAAUoX,GAC1ErX,KAAK4X,mBAAqB,IAAIC,GAAmB7X,KAAKC,SAAUoX,EACjE,EASD,MAAeS,WAA2BV,EAQtC1X,YAAY8E,EAAyB6S,GACjCtX,MAAMyE,EAAY,6BAPbxE,KAAAsV,cAAkC,IAAI7T,EAQ3CzB,KAAKqX,UAAYA,EACjBrX,KAAK+X,cAAgB,GAEhB/X,KAAAgY,iBAAmBnU,SAASC,cAAc,YAC/C9D,KAAKgY,iBAAiB9X,UAAUC,IAAI,kCAAmC,oBAClEH,KAAAC,SAAS0C,YAAY3C,KAAKgY,kBAE/BhY,KAAKiY,SACAjY,KAAAqX,UAAU/B,cAAc1T,IAAcC,IACvC7B,KAAKiY,QAAO,GAEpB,CAEQA,SACJjY,KAAKgY,iBAAiBhX,UAAY,mBAC7BhB,KAAKkY,WAAWC,+BAGf,MAAAC,EAAgBpY,KAAKqY,mBACC,GAAxBD,EAAcpE,OACThU,KAAAC,SAAS8D,MAAMuU,QAAU,OAEzBtY,KAAAC,SAAS8D,MAAMuU,QAAU,UAGlCtY,KAAK+X,cAAgBK,EAAchW,KAAI,CAACmW,EAAcC,KAC5C,MAAAC,EAAM5U,SAASC,cAAc,OAC/B2U,EAAAvY,UAAUC,IAAI,wBACbH,KAAAgY,iBAAiBrV,YAAY8V,GAE5B,MAAAC,EAAalZ,GAAiB2D,eAAe,CAC/CzC,QAAS6X,aAAwBI,EAASJ,EAAalW,oBAAsBkW,EAAahD,SAAS7U,QACnGC,KAAM4X,EAAajW,WACnBzB,MAAO0X,EAAahW,gBACpBxB,YAAY,IAEL2X,EAAAxY,UAAUC,IAAI,2BACzBsY,EAAI9V,YAAY+V,GAEV,MAAAE,EAAQ/U,SAASC,cAAc,QACrC8U,EAAM1Y,UAAUC,IAAI,sBAAuB,KAAM,kBACjDsY,EAAI9V,YAAYiW,GAEhB,IAAIC,EAAqF,KAErFA,EAAmB,IAAIrZ,GAA8BiZ,EAAKzY,KAAKqX,UAAU1C,IAAI/U,KAAM2Y,EADnFA,aAAwBI,EACyE,CAC7FG,gBAAiB,CACb,+BAEJlY,cAAe,aACfe,kBAAmB3B,KAAKqX,UAAU1C,IAAI/U,KAAK+B,kBAE3CoX,aAAe5W,GAAwBA,EAAO6W,yBAC9C1Y,SAAW6B,GAAwBnC,KAAKiZ,eAAe9W,GACvD+W,SAAU,CAACrX,EAAkBM,EAAqBoB,IAAyBvD,KAAKmZ,eAAetX,EAASM,EAAQoB,IAGvB,CACzFuV,gBAAiB,CACb,+BAEJlY,cAAe,aACfe,kBAAmB3B,KAAKqX,UAAU1C,IAAI/U,KAAK+B,kBAE3CoX,aAAelI,GAAqBA,EAAQyE,cAC5ChV,SAAWuQ,GAAqB7Q,KAAKoZ,gBAAgBvI,GACrDqI,SAAU,CAACrX,EAAkBgP,EAAkBtN,IAAyBvD,KAAKqZ,gBAAgBxX,EAASgP,EAAStN,KAIvH,MAAM+V,EAAmB,CACrBC,YAAahB,EACbiB,aAAcX,EACdY,aAAczZ,KAAKqX,UAAU1C,IAAI/U,KAAKS,wBAAwBwY,EAAkBrY,kBAO7E,OAJWqY,EAAAvD,cAAc1T,IAAcC,IACzByX,EAAAG,aAAezZ,KAAKqX,UAAU1C,IAAI/U,KAAKS,wBAAwBwY,EAAkBrY,gBAAe,IAG9G8Y,CAAA,GAEf,EAYJ,MAAM/B,WAAyBO,GAC3BI,WACW,MAAA,YACX,CAEAG,mBACW,OAAArY,KAAKqX,UAAUqC,wBAAwBxX,WAAsBqX,GAAaxD,YAAc5N,EAAMwR,YACzG,CAEAV,eAAe9W,GACX,OAAQA,EAAyCyX,iBAAiBC,iBAAmBvW,GACzF,CAEA6V,eAAetX,EAAkBM,EAAqBoB,GAC5C,MAAAuW,EAAc3X,EAAyCyX,iBAC7DE,EAAWD,gBAAkBtW,EACtBpB,EAAA4X,eAAelY,EAASiY,EACnC,CAEAV,gBAAgBvI,GACZ,OAAOA,EAAQc,wBACnB,CAEA0H,gBAAgBxX,EAAkBgP,EAAkBtN,GACxCsN,EAAAwF,uBAAuBxU,EAAS0B,EAC5C,EAGJ,MAAMkU,WAA6BK,GAC/BI,WACW,MAAA,iBACX,CAEAG,mBACI,OAAOrY,KAAKqX,UAAUqC,wBACjBxX,QAAOqX,GAAeA,GAAaxD,YAAc5N,EAAMqK,cACvDtQ,QAAsBqX,IACnB,GAAIA,aAAuB9E,GAChB,MAAkC,wBAAlC8E,EAAYhE,SAAS9E,UACzB,CACH,MAAMtO,EAASoX,EACf,QAAMpX,EAAwC6X,aAAaC,eAKpD9X,EAAOsE,MAAQnC,EAAK0B,eAC/B,IAEZ,CAEAiT,eAAe9W,GACX,OAAQA,EAAwCyX,iBAAiBM,qBAAuB5W,GAC5F,CAEA6V,eAAetX,EAAkBM,EAAqBoB,GAC5C,MAAAuW,EAAc3X,EAAwCyX,iBAC5DE,EAAWI,oBAAsB3W,EAC1BpB,EAAA4X,eAAelY,EAASiY,EACnC,CAEAV,gBAAgBvI,GACZ,OAAOA,EAAQgC,4BACnB,CAEAwG,gBAAgBxX,EAAkBgP,EAAkBtN,GACxCsN,EAAA0F,2BAA2B1U,EAAS0B,EAChD,EAGJ,MAAMoU,WAAgCG,GACrCI,WACQ,MAAA,sBACR,CAEAG,mBACQ,OAAArY,KAAKqX,UAAUqC,wBAAwBxX,WAAsBqX,GAAaxD,YAAc5N,EAAMgS,YACtG,CAEAlB,eAAe9W,GACd,OAAQA,EAAkCyX,iBAAiBQ,wBAA0B9W,GACtF,CAEA6V,eAAetX,EAAkBM,EAAqBoB,GAC/C,MAAAuW,EAAc3X,EAAkCyX,iBACtDE,EAAWM,uBAAyB7W,EAC7BpB,EAAA4X,eAAelY,EAASiY,EAChC,CAEAV,gBAAgBvI,GACf,OAAOA,EAAQmC,+BAChB,CAEAqG,gBAAgBxX,EAAkBgP,EAAkBtN,GAC3CsN,EAAA4F,8BAA8B5U,EAAS0B,EAChD,EAGD,MAAMsU,WAA2BC,GAC7BI,WACW,MAAA,eACX,CAEAG,mBACI,OAAOrY,KAAKqX,UAAUqC,wBACjBxX,QAAOqX,GAAeA,GAAaxD,YAAc5N,EAAMC,mBACvDlG,QAAsBqX,IACnB,GAAIA,aAAuB9E,GAChB,MAAkC,oBAAlC8E,EAAYhE,SAAS9E,UAGrB,OADQ8I,EACDS,aAAaK,QAC/B,GAEZ,CAEApB,eAAe9W,GACX,OAAQA,EAAwCyX,iBAAiBU,oBAAsBhX,GAC3F,CAEA6V,eAAetX,EAAkBM,EAAqBoB,GAC5C,MAAAuW,EAAc3X,EAAwCyX,iBAC5DE,EAAWQ,mBAAqB/W,EACzBpB,EAAA4X,eAAelY,EAASiY,EACnC,CAEAV,gBAAgBvI,GACZ,OAAOA,EAAQ0D,2BACnB,CAEA8E,gBAAgBxX,EAAkBgP,EAAkBtN,GACxCsN,EAAA8F,0BAA0B9U,EAAS0B,EAC/C,EC7PG,MAAMgX,WAAwBnD,EASpC1X,YAAY8E,EAAyB6S,GACpCtX,MAAMyE,EAAY,yBARVxE,KAAAsV,cAAkC,IAAI7T,EAS9CzB,KAAKqX,UAAYA,EACjBrX,KAAKwa,YAAcC,EAAqBjX,MAAMkX,EAAqB,IAEnE1a,KAAKC,SAASe,UAAY,wHAOHhB,KAAAC,SAASiB,uBAAuB,8BAA8B,GACrF,MAAMyZ,EAAW3a,KAAKC,SAASiB,uBAAuB,wBAAwB,GAExEwS,EAAQkH,EACZ1Y,QAAOuE,GAAQ4J,GAAiB0D,SAAStN,KACzCvE,QAAeuE,IAACoU,EAAU9G,SAAStN,KAC/BqU,EAAiB,IAAIC,MA7BR,GA6B4BC,QAE/Chb,KAAKib,KAAO,GACPjb,KAAAkb,KAAOxH,EAAMtR,KAAYqE,IACvB,MAAAgS,EAAM5U,SAASC,cAAc,MAC/B2U,EAAAvY,UAAUC,IAAI,uBAClBwa,EAAShY,YAAY8V,GAEf,MAAA0C,EAAatX,SAASC,cAAc,MAC/BqX,EAAAjb,UAAUC,IAAI,+BACzBsY,EAAI9V,YAAYwY,GAEV,MAAAlX,EAAOJ,SAASC,cAAc,OA6C7B,OA5CPG,EAAKC,IAAMkX,EAAW3U,GACtB0U,EAAWxY,YAAYsB,GAEvBoX,MAAMpX,EAAM,CACXqX,QAAWlS,EAAU3C,GACrB8U,WAAa,IAGCT,EAAArY,SAAsB+Y,IAC9B,MAAAC,EAAO5X,SAASC,cAAc,MAC/B2X,EAAAvb,UAAUC,IAAI,wBACnBsY,EAAI9V,YAAY8Y,GAEXzb,KAAKib,KAAKO,IACTxb,KAAAib,KAAKS,KAAK,IAEX1b,KAAAib,KAAKO,GAAYE,KAAKD,GAEA,IAAAE,EAAeF,EAAMzb,KAAM,CACrD8Y,gBAAiB,CAChB,mBAED8C,WAAY,EACZC,OAAQ,CACP,CAAEhb,MAAOoV,EAAY9N,EAAM4G,cAAejO,MAAOgb,EAAUC,iBAC3D,CAAEC,SAAUC,EAASC,YAAY,OAAQpb,MAAOgb,EAAUK,iBAC1D,CAAEH,SAAUC,EAASC,YAAY,OAAQpb,MAAOgb,EAAUM,iBAC1D,CAAEJ,SAAUC,EAASC,YAAY,OAAQpb,MAAOgb,EAAUO,kBAC1D,CAAEL,SAAUC,EAASC,YAAY,OAAQpb,MAAOgb,EAAUQ,sBAE3DvZ,OAAQ,CAACwZ,EAAcC,IAAiBD,GAAKC,EAC7CC,UAAWX,EAAUC,gBACrBhD,aAAe2D,GAA4BA,EAAOpH,cAClDhV,SAAWoc,GAA4BA,EAAOlC,YAAYmC,SAASnB,IAAaoB,UAAUnW,IAASqV,EAAUC,gBAC7G7C,SAAU,CAACrX,EAAkB6a,EAAyBnZ,KAChCmZ,EAAOlC,YAAYmC,SAASnB,GAAYoB,UAAUnW,IACnDlD,IACnBmZ,EAAOlC,YAAYmC,SAASnB,GAAYoB,UAAUnW,GAAQlD,EACrDvD,KAAAsV,cAAcK,KAAK9T,GACzB,GAED,IAGK4W,CAAA,IAGRzY,KAAK6c,eAAexF,EAAUyF,cAAc3U,EAAM4G,eACxCsI,EAAA1V,kBAAkBC,IAAcC,IACzC7B,KAAK6c,eAAexF,EAAUyF,cAAc3U,EAAM4G,cAAa,GAEjE,CAEQ8N,eAAeE,GACRA,EAAA7L,KAAK8L,IAAID,EAhGJ,GAkGnB,IAAA,IAASE,EAAI,EAAGA,EAAIF,EAAaE,IAC3Bjd,KAAAib,KAAKgC,GAAGxa,SAAQya,GAAQA,EAAKhd,UAAUC,IAAI,oBAEjD,IAAA,IAAS8c,EAAIF,EAAaE,EArGP,EAqGyBA,IACtCjd,KAAAib,KAAKgC,GAAGxa,SAAQya,GAAQA,EAAKhd,UAAUid,OAAO,mBAErD,CAEAC,iBAEQ,OAAA3C,EAAqBjX,MAAMxD,KAAKwa,YACxC,CAEA6C,eAAexb,EAAkByb,GAC3Btd,KAAAwa,YAAcC,EAAqBjX,MAAM8Z,GACzCtd,KAAAsV,cAAcK,KAAK9T,EACzB,EC9DD,MAAM0b,WAAyBC,EAE9B9d,YAAYC,EAAqB8d,GAC1B1d,MAAAJ,EAAQ,eAAe,GAC7BK,KAAKyd,MAAQA,EAEbzd,KAAK0d,gBAAgB1c,UAAY,0OAQlC,CAEA2c,SAASza,GACF,MAAAqS,EAAWqI,EAAgBC,eAAe3a,GAChDlD,KAAKyd,MAAMzG,UAAUvV,EAAWC,cAAe6T,GAC/CvV,KAAK8d,OACN,EAGD,MAAMC,WAAyBC,EAG9Bte,YAAYC,EAAqB8d,GAC1B1d,MAAAJ,EAAQ,eAAe,GAC7BK,KAAKyd,MAAQA,EACbzd,KAAK8B,MACN,CAEAmc,UACQ,OAAAC,KAAKC,UAAUP,EAAgBQ,OAAOpe,KAAKyd,MAAM5G,WAAY,KAAM,EAC3E,EAGD,MAAMwH,WAAwBb,EAK7B9d,YAAYC,EAAqB8d,GAC1B1d,MAAAJ,EAAQ,cAAc,GAJ7BK,KAAQse,aAAuB,EAK9Bte,KAAKyd,MAAQA,EACbzd,KAAK0d,gBAAgB1c,UAAY,kiBAYlC,CAEQud,oBAEP,OAAOC,MAAM,+CAAgD,CAC5DC,OAAU,OACVC,QAAW,CACVC,cAAiB,SAAWC,KAAK,kFAElCC,KAAM,IAAIC,gBAAgB,CACzBC,WAAc,yBAEbC,MAAKC,GAAYA,EAASC,SAC3BF,MAAYG,GAAAA,EAAIC,eAChBC,OAAaC,IACbC,QAAQC,MAAMF,EAAG,GAEpB,CAEQG,SAASC,EAAeC,GAC/B,MAAMjB,EAAU,CACf,eAAgB,mBAChBC,cAAiB,UAAUgB,IAC3BC,OAAU,oBAGLC,EAAW,wDAAwDH,IAKlE,OAHF1f,KAAAse,eAGEE,MAAMsB,UAAUD,GAAW,CACjCpB,OAAU,MACVC,QAAWA,IACTM,MAAYG,GAAAA,EAAID,QACpB,CAEQa,WAAWC,GAElB,IAAIC,EAAU,CAAEC,SAAU,GAAIC,QAAS,KAEvC,IAAKH,EAAIjM,SAAS,oBAEV,OADCwL,QAAAC,MAAM,kBAAmBQ,EAAK,iCAC/BC,EAGJ,IAAAG,EAAeJ,EAAIK,QAAQ,UAC3BC,EAAgBN,EAAIK,QAAQ,aAEhC,IAA0B,IAAtBC,EAEI,OADCf,QAAAC,MAAM,kCAAmCQ,GAC1CC,EAGSK,GAAA,EAGjB,IAAyB,IAArBF,EAAqB,CACRA,GAAA,EAEhB,IAAID,EAAUI,SAASP,EAAIQ,UAAUJ,GAAe,IAEhDK,MAAMN,KACCA,EAAA,GAGHF,EAAAE,QAAUA,EAAQO,UAAS,MAE3BnB,QAAAoB,KAAK,iCAAkCX,EAAK,yBAK9C,OAFPC,EAAQC,SAAWF,EAAIQ,UAAUF,EAAeA,EAhBzB,KAgB4D,GAE5EL,CACR,CAEQW,aAAajB,GAOb,OAAA3f,KAAKyf,SANE,2GAMcE,GAC1BX,MAAMG,GAAQA,EAAI,KAA4C,eACjE,CAEA0B,eAAeC,GACd9gB,KAAK+gB,aAAaC,UAAW,EACxBhhB,KAAAC,SAAS8D,MAAMkd,OAAS,OAC7BjhB,KAAKkhB,SAASJ,GAAY9B,MAAK,KAC9Bhf,KAAK+gB,aAAaC,UAAW,EACxBhhB,KAAAC,SAAS8D,MAAMod,eAAe,SAAQ,GAE7C,CAEAN,eAAeC,GACV,IAACA,EAAW9M,OAEf,YADAuL,QAAQC,MAAM,4BAIX,IAAAS,EAAUjgB,KAAK+f,WAAWe,GAE9B,MAAMZ,EAAWD,EAAQC,SACnBC,EAAUF,EAAQE,QAEpB,IAACD,EAASlM,OAEb,YADQuL,QAAAC,MAAM,kCAAmCsB,GAKlD9gB,KAAKyd,MAAM2D,UAAU3f,EAAWC,eAE1B,MAAAie,QAAc3f,KAAKue,oBAGnB8C,QAAyCrhB,KAAK4gB,aAAajB,GAKjE,IAAI2B,EAAuCD,EAAeE,oBANlC,GAM0EF,EAAeG,aAEjHjC,QAAQkC,KAAK,uBAAwBvB,EAAU,QAASC,EAAS,oBAAqBmB,GAEtF,MAAMI,EAAkB,kEAGJxB,mIAImBC,4GACdA,oHAGWA,kIACGA,qIACGA,kIAMpCwB,QAAmB3hB,KAAKyf,SAASiC,EAAiB/B,GACpD,GAAqB,MAArBgC,EAAWC,QAA4C,MAArBD,EAAWC,QAAkBD,EAAWC,OAAO5N,OAAQ,CAC5F,MAAM6N,EAAYF,EAAWC,OAAOE,QAAO,CAACC,EAAqBvC,IACzDuC,EAAcvC,EAAMwC,SACzB,IAEH,YADAC,MAAM,qBAAuBJ,EAE9B,CAEM,MAAAK,EAAUP,EAAWze,KAAKye,WAAWQ,OAErCC,EAAYF,EAAQG,MACpBC,EAA0BJ,EAAQK,cAAcrf,KAAKsf,QACrDC,EAAoCP,EAAQ9P,WAAWlP,KAAKsf,QAC5DE,EAAwCR,EAAQjI,cAAc/W,KAAKsf,QACnEG,EAA2CT,EAAQU,iBAAiB1f,KAAKsf,QAGzEK,EAA0EX,EAAQY,OAAO,GACzFC,EAAoBF,EAAME,UAC1BC,EAAkBH,EAAMG,QAG9B,IAAIC,EAAUjjB,KAAKyd,MAAMyF,YAAYC,oBAGpB,MAAbf,IACHa,EAAUb,EAAUa,QAAQvO,IAId,MAAXuO,IACHA,EAAU7b,EAAQM,OAGb,MAAA0b,EAAYC,EAAetM,SACvBqM,EAAAE,UAAYN,EAAUD,GAAa,IAEnCK,EAAAG,QAAU,IAAIxI,MAExB,IAAIyI,EAAyBxjB,KAAKyd,MAAM9I,IAAI8O,yBAAyB/f,MAAMggB,GAAQA,EAAIC,KAAK5P,SAAS8O,EAAMlS,QAGvG6S,GAA0BA,EAAuBD,QAAQvP,QACrCwP,EAAAD,QACrBnhB,KAAKwhB,GAAQA,EAAIC,SACjB3hB,QAAQ2hB,QAAsB,IAAXA,IACnBphB,SAASohB,GAAWT,EAAUG,QAAQ7H,KAAKmI,KAIb,IAA7BT,EAAUG,QAAQvP,QACrBoP,EAAUG,QAAQ7H,KAAKoI,EAAOC,gBAGzB,MAAAxO,EAAWqI,EAAgB7G,SACjCxB,EAAS6N,UAAYA,EAEf,MAAAxjB,EAAOokB,EAAUjN,SAClBnX,EAAAsS,QAAU,IAAI6I,MACnBxF,EAAS3V,KAAOA,EAEV,MAAAqkB,EAAW,IAAIlJ,MAGfmJ,MAAuBC,IAEvBpH,EAAcuF,EAAWpgB,QAAQC,GAA2B,YAAhBA,EAAOiiB,OAAoBpQ,OAGzE,IAAAqQ,EAAgCtJ,MAAMuJ,KAAK,CAAEtQ,OAAQuQ,IAAmBniB,KAAI,IAAM,KAG1EiiB,EAAA5hB,SAAQ,IAAM7C,EAAKsS,QAAQwJ,KAAK8I,EAAWzN,YAIjD,MAAA0N,EAAiB,CAACC,EAAiBC,KACpC,IAAC5J,MAAM6J,QAAQF,GAAiB,MAAA,IAAIlP,MAAM,+BACxC,MAAAhS,EAAQkhB,EAASG,MAAM,GACvBC,EAASC,UAAU/Q,OAAS,EAAI+Q,UAAU,GAAK,EAC/CC,EAAYL,EAAKjlB,cAAgBqb,MAAS4J,EAAOA,EAAKM,MAAM,KAa3D,OAZDzhB,EAAA0hB,MAAK,SAAS3I,EAAGC,GACtB,IAAA,IAAS2I,KAAKH,EACTzI,EAAEyI,EAASG,KAAO3I,EAAEwI,EAASG,MAChC5I,EAAIA,EAAEyI,EAASG,IACf3I,EAAIA,EAAEwI,EAASG,KAMjB,OAFA5I,EAAIA,EAAEmE,WAAW0E,MAAM,UAAY7I,EAAIA,IACvCC,EAAIA,EAAEkE,WAAW0E,MAAM,UAAY5I,EAAIA,IACrB,EAAKsI,EAAWvI,EAAIC,EAAK,EAAIsI,EAAS,CAAA,IAElDthB,CAAA,EAGF6hB,EAAgB/C,EACpBlgB,KAAKkjB,GAAc,IAAIC,GAAaD,EAAWtlB,KAAKyd,MAAOwF,KAEvDuC,EAAuBC,IAC5B,MAAMC,EAA0D,GAYzD,OAXHD,EAAazR,QACHyR,EAAAhjB,SAASkjB,IACf,MAAApN,EAAe8M,EAAc3hB,MAAMvB,GAAWA,EAAOwO,OAASgV,EAAKhV,OACnE8I,EAAe4L,EAAc3hB,MAAMvB,GAAWA,EAAOwO,OAASgV,EAAKpC,QAAQ,GAAG5S,OAGhF4H,GAAgBkB,IAAiBA,EAAamM,WACjDF,EAAYhK,KAAK,CAAEvZ,OAAQoW,EAAcsL,OAAQpK,EAAa9I,MAC/D,IAGK+U,CAAA,EAGYF,EAAA/C,GAAehgB,SAASkjB,GAASA,EAAKxjB,OAAO0X,gBAAkB8L,EAAK9B,SACpE2B,EAAA9C,GAAmBjgB,SAASkjB,GAASA,EAAKxjB,OAAO+X,oBAAsByL,EAAK9B,SAC5E2B,EAAA7C,GAAsBlgB,SAASkjB,GAASA,EAAKxjB,OAAOiY,uBAAyBuL,EAAK9B,SAEtG,MAAMgC,EAA6BpB,EAAeA,EAAeY,EAAe,QAAS,gBAEzF,IAAIzQ,EAAY,EAGV,MAAAkR,EAAmB,CAACvJ,EAAiBC,IAAoBD,EAAEqJ,WAAgBpJ,EAAEoJ,UAAN,EAAsB,EAG7FG,EAAsB,CAAC5jB,EAAsB6jB,EAAuBC,GAAU,KAEnF,IAAK9jB,EAEJ,YADAod,QAAQC,MAAM,8DAIf,IAAKwG,EAEJ,YADAzG,QAAQC,MAAM,6DAIX,GAAAwG,EAAU7T,QAAQ6B,SAAWkS,EAEhC,YADA3G,QAAQC,MAAM,uDAAwDrd,EAAQ6jB,EAAU7T,SAIrF8T,GACK1G,QAAAoB,KAAK,gCAAgCxe,EAAOwO,0CAGjD,IAAAE,EAAU1O,EAAOgkB,aACjBC,EAAYjkB,EAAOkkB,YAEnB,GAACxV,GAAYuV,EAAb,CAOJ,GAFiBlC,EAAAoC,IAAInkB,EAAOuS,GAAIE,GAE5B/D,EACHA,EAAQ+D,UAAYA,EACpBqP,EAASvI,KAAK7K,GACdmV,EAAU7T,QAAQuJ,KAAK6K,EAAYxP,kBACzBqP,IACAJ,EAAA7T,QAAQuJ,KAAK0K,GACnBI,EAAW3S,EAAauS,KAAa,CACpC,IAAAK,EAAK3jB,EAAWiU,SACpB0P,EAAG7U,YAAcsS,EAAiBwC,IAAIvkB,EAAOuS,IACpCa,EAAA3V,KAAM+mB,MAAMjL,KAAK+K,EAC3B,CAIDtkB,EAAOykB,eAAgB,EAEvBhS,GApBA,MAFS2K,QAAAC,MAAM,kEAAmErd,EAsBlF,EAID,GAAImf,EAA6B,CAGhC,MAAMuF,EAAmBhB,EAAW3jB,QAAQC,GAAWA,EAAO2kB,gBAG9D,IAAA,MAAW3kB,KAAU0kB,EAAkB,CAEhC,MAAAE,EAAY5kB,EAAO6kB,aAAahT,QAAUkS,EAIhD,GAAIa,EACH,SAGK,MAAAE,EAAoB9kB,EAAO+kB,kBAE7B,IAACD,EAAQjT,OAAQ,CACZuL,QAAAoB,KAAK,gDAAkDxe,EAAOwO,MACtE,QACD,CAEA,IAAIwW,EAAkBF,EAAQ7kB,KAAKglB,GAAW,kEAG5BlH,qCACE6C,eAAuBC,gBAAsB7gB,EAAOuS,kBAAkB0S,iBAAsBjH,qGAK5GkH,EAAyB,GAG7B,IAAA,IAASpK,EAAI,EAAGA,EAAIkK,EAAgBnT,UAE/BqT,EAAYrT,QAAUkS,GAAkBa,GAFD9J,IAAK,CAMhD,IAAIqK,QAAqBtnB,KAAKyf,SAAS0H,EAAgBlK,GAAI0C,GAC3D,GAAI2H,EAAc,CACb,IAAAC,EAAyBD,EAAapkB,MAAMye,YAAYQ,QAAQqF,OAAOtkB,MAAMukB,OAAS,GAC1F,GAAIF,EAAYvT,OAAQ,CAETuT,EAAAA,EAAYrlB,QAAQwlB,GAAmC,QAApBA,EAAWtD,OAC1Dc,MAAK,CAAC3I,EAAGC,IAAMD,EAAEoL,MAAM,GAAG5E,UAAYvG,EAAEmL,MAAM,GAAG5E,YACjD7gB,QAAO,CAACwlB,EAAYE,IAAUA,EAAQ,IAExC,MAAMC,EAAoBN,EAAYrlB,QAAQwlB,IAAgBL,EAAYS,MAAMjE,GAAWA,EAAOlT,OAAS+W,EAAW/W,SAC1G0W,EAAA3L,QAAQmM,EACrB,CACD,CACD,CAEI,GAAuB,IAAvBR,EAAYrT,OACf,SAGD7R,EAAO4lB,YAAa,EAGpB5lB,EAAO6kB,aAAeK,EAAYjlB,KAAKslB,GAAeA,EAAW/W,OAEjE,IAAIqW,EAAenB,EACjB3jB,QAAQ8lB,GAAe7lB,EAAO6kB,aAAajT,SAASiU,EAAWrX,QAC/DzO,QAAQ8lB,IAAgBA,EAAWpB,gBAErC,MAAMqB,EAAoBjB,EAAahT,OAGnC,IAAAlC,EAAqBuS,EAAY6D,WAAWC,GAAUA,EAAMnU,OAASkS,GAAkBiC,EAAMnU,OAASiU,KAGnF,IAAnBnW,IACKyN,QAAAoB,KAAK,wCAA0Cxe,EAAOwO,MACjDmB,EAAAuS,EACXniB,QAAQimB,GAAUA,EAAMnU,OAASkS,IACjCgC,WAAWC,GAAUA,EAAML,MAAMM,GAAWjmB,EAAO6kB,aAAajT,SAASqU,EAAOzX,UAC1E4O,QAAAkC,KAAK,mCAAqC3P,IAGnD,IAAIqW,EAAwB9D,EAAYvS,GAE3BkV,EAAAvkB,SAAS4lB,IAErB,MAAMC,OAAwB,IAAVH,EACdI,EAASJ,EAAMnU,SAAWkS,EAE5BoC,GAAeC,IAInBF,EAAYzB,eAAgB,EAC5ByB,EAAYrB,aAAe7kB,EAAO6kB,aAElCmB,EAAMzM,KAAK2M,GAAW,GAExB,CAGYhE,EAAA5hB,SAAQ,CAAC0lB,EAAOrW,KAEvB,IAAAkU,EAAYpmB,EAAKsS,QAAQJ,GAG3BqW,EAAAjD,KAAKY,GACLrjB,SAASN,GAAW4jB,EAAoB5jB,EAAQ6jB,IAAU,GAE9D,CA+FA,GA5FAH,EACE3jB,QAAQC,IAAYA,EAAOykB,gBAC3B1B,KAAKY,GACL1jB,KAAKD,IACD,IAAA6jB,EAAYpmB,EAAKsS,QAAQhQ,QAAQimB,GAAUA,EAAMhW,QAAQ6B,OAASkS,IAAgB,GAClEH,EAAA5jB,EAAQ6jB,GAAW,EAAI,IAI7CH,EACE3jB,QAAQC,GAAWA,EAAO0X,iBAAmB1X,EAAO+X,qBAAuB/X,EAAOiY,yBAClF3X,SAASN,IAET,MAAM0hB,EAAmCgC,EAAWniB,MAAM4hB,GAAcA,EAAU3U,OAASxO,EAAO0X,iBAAmB1X,EAAOwO,OAASxO,EAAO+X,qBAAuB/X,EAAOwO,OAASxO,EAAOiY,yBAE1L,IAAKyJ,EAEJ,YADAtE,QAAQoB,KAAK,2CAId,MAAM6H,EAAmB3E,EAAOnP,GAC1B+T,EAAsCvE,EAAiBwC,IAAI8B,GAEjE,IAAKC,EAEJ,YADQlJ,QAAAoB,KAAK,kBAAkBkD,EAAOlT,oBAIvC,GAAIxO,EAAOyjB,UAAW,CACrB,MAAM8C,EAAmBvmB,EAAOuS,GAC1BiU,EAAsCzE,EAAiBwC,IAAIgC,GAC3D7X,EAAUoT,EAASvgB,MAAMmN,GAAYA,EAAQ+D,YAAc+T,IAajE,YAZI9X,IACC1O,EAAO0X,iBACFhJ,EAAAgE,oBAAsB/R,EAAWiU,SACzClG,EAAQgE,oBAAoBjD,YAAc6W,GAChCtmB,EAAO+X,qBACTrJ,EAAAiE,wBAA0BhS,EAAWiU,SAC7ClG,EAAQiE,wBAAwBlD,YAAc6W,GACpCtmB,EAAOiY,yBACTvJ,EAAAkE,2BAA6BjS,EAAWiU,SAChDlG,EAAQkE,2BAA2BnD,YAAc6W,IAIpD,CAIA,MAAMzC,EAAYpmB,EAAKsS,QAAQhQ,QAAQimB,GAAUA,EAAMhW,QAAQ2V,MAAMc,GAAeA,EAAWjY,OAASxO,EAAOwO,SAAO,GAEtH,IAAKqV,EAEJ,YADQzG,QAAAoB,KAAK,2CAA6Cxe,EAAOwO,MAI5D,MAAAiY,EAAa5C,EAAU7T,QAAQzO,MAAMklB,GAAeA,EAAWjY,OAASxO,EAAOwO,OAEhFiY,EAKDzmB,EAAO0X,gBACuB,gBAA7B+O,EAAWniB,KAAKoiB,WACnBD,EAAWniB,KAAKqiB,aAAaC,QAASlP,gBAAkB/W,EAAWiU,SACnE6R,EAAWniB,KAAKqiB,aAAaC,QAASlP,gBAAgBjI,YAAc6W,GAC7B,cAA7BG,EAAWniB,KAAKoiB,WAC1BD,EAAWniB,KAAKuiB,WAAWD,QAASlP,gBAAkB/W,EAAWiU,SACjE6R,EAAWniB,KAAKuiB,WAAWD,QAASlP,gBAAgBjI,YAAc6W,GAC3B,kBAA7BG,EAAWniB,KAAKoiB,YAC1BD,EAAWniB,KAAKwiB,eAAeF,QAASlP,gBAAkB/W,EAAWiU,SACrE6R,EAAWniB,KAAKwiB,eAAeF,QAASlP,gBAAgBjI,YAAc6W,GAE7DtmB,EAAO+X,qBAEP/X,EAAOiY,uBAjBjBmF,QAAQoB,KAAK,8BAAgCxe,EAAOwO,KAAO,kBAAoBqV,EAiBtC,IAM1CH,EAAA3jB,QAAQC,IAAYA,EAAOykB,gBAC3BnkB,SAASN,IACTod,QAAQC,MAAM,GAAGrd,EAAOwO,0BAA2BxO,EAAM,IAGlDoT,EAAAqH,UAAYlC,EAAqBqC,GAE1C/c,KAAKyd,MAAMzG,UAAUvV,EAAWC,cAAe6T,GAC/CvV,KAAKyd,MAAMyL,YAAYznB,EAAWC,cAAeuiB,IAE5C3C,EAA6B,CACjC,MAAM6H,QAAuCnpB,KAAK4gB,aAAajB,GACvDJ,QAAA6J,MAAM,wBAAwBD,EAAaE,yBACpD,CAEArpB,KAAK8d,OACN,EAGD,MAAMyH,GA0BL7lB,YAAYwD,EAAiBua,EAAkBwF,EAAmB7b,EAAQC,SAjB1ErH,KAAO4mB,eAAyB,EAChC5mB,KAAO+nB,YAAsB,EAC7B/nB,KAAOgnB,aAAyB,GAEhChnB,KAAO8mB,eAAyB,EAChC9mB,KAAO4lB,WAAqB,EAC5B5lB,KAAOspB,aAAuB,GAY7BtpB,KAAKyd,MAAQA,EAEbzd,KAAK2Q,KAAOzN,EAAKyN,KACjB3Q,KAAK8H,KAAO5E,EAAK4E,KACjB9H,KAAKiE,KAAOf,EAAKe,KACjBjE,KAAK0U,GAAKxR,EAAKwR,GACf1U,KAAKokB,KAAOlhB,EAAKkhB,KACjBpkB,KAAK4G,QAAU1D,EAAK0D,QACpB5G,KAAKupB,QAAUrmB,EAAKe,KAAKghB,MAAM,KAAK,GACpCjlB,KAAKijB,QAAUA,EAGG,YAAdjjB,KAAKokB,MAAuC,eAAjBpkB,KAAKupB,UACnCvpB,KAAKupB,QAAU,YAGXvpB,KAAAyG,KAAO2C,GAAUpJ,KAAKupB,SACtBvpB,KAAAwpB,SAAWxpB,KAAKupB,QAAUvpB,KAAKokB,KAE/BpkB,KAAA4lB,eAA0B,IAAd5lB,KAAKyG,KAEtBzG,KAAK8mB,cAAgB9mB,KAAKknB,kBAAkBlT,OAAS,EAEhDhU,KAAAspB,aAAeG,GAAiBzpB,KAAKupB,UAAY,EACvD,CAEOlD,YAEN,GAAIrmB,KAAK4lB,UACR,OAGG,IAAAzjB,EAASokB,EAAYxP,SAEnB,MAAA2S,EAAYC,EAAkB3pB,KAAKyG,MAEnCmjB,EAAiB5pB,KAAK6pB,oBAE5B,QAAuB,IAAnBD,EAuBG,OAbEznB,EAAA2nB,EAAc9pB,KAAKyG,KAAMtE,EAAQynB,EAAeljB,SAAUgjB,EAAUK,gBAAiBH,EAAe9iB,aAEtG3E,EAAA6nB,cAAgBJ,EAAehjB,QAAQojB,cACvC7nB,EAAA8nB,OAASL,EAAehjB,QAAQqjB,OACvC9nB,EAAO6E,SAAW4iB,EAAe5iB,SAEjC7E,EAAOwO,KAAO3Q,KAAK2Q,KACZxO,EAAAwR,MAAQuW,EAAYlqB,KAAKokB,MACzBjiB,EAAAgoB,UAAYnqB,KAAKoqB,eACjBjoB,EAAAkoB,KAAOT,EAAeziB,oBAAoBnH,KAAKijB,SAEtDtK,EAAO2R,2BAA2BnoB,GAE3BA,EAtBNod,QAAQC,MAAM,kDAAmD,CAChE7O,KAAQ3Q,KAAK2Q,KACblK,KAAQzG,KAAKyG,KACb2d,KAAQpkB,KAAKokB,KACbxd,QAAW5G,KAAK4G,SAmBnB,CAEOuf,aAEF,IAACnmB,KAAK4lB,UACT,OAGK,MAAA2E,EAAQC,GAAaxqB,KAAKwpB,UAEhC,GAAa,MAATe,EAEH,YADQhL,QAAAC,MAAM,kCAAmCxf,KAAKwpB,UAIjD,MAAAiB,EAAMhW,EAAQsC,SAIb,OAHP0T,EAAI/V,GAAK6V,EACTE,EAAI7V,WAAY,EAET6V,CACR,CAEOvD,kBAEN,MAiBMwD,EAAsB,CAC3B,OAKKC,EAAyB,CAC9BC,mBAAsB,CACrB,MACA,MACA,OAEDC,cAAiB,IAAIH,GACrBI,YAAe,IAAIJ,GACnBK,WAAc,IAAIL,GAClBM,aAAgB,CACf,OAEDC,iBAAoB,CACnB,OAEDC,eAAkB,CACjB,OAEDC,kBAAqB,CACpB,QASIC,EAnDyB,CAC9BC,QAAW,CACV,MACA,MACA,OAEDC,QAAW,CACV,KACA,KAEDC,QAAW,CACV,MACA,QAuCmCvrB,KAAKokB,OAAS,GAG7CoH,EAAgB,IAFJb,EAAkB3qB,KAAKwpB,WAAa,MAGpC4B,EAPjB,QAUG,MAAc,WAAdprB,KAAKokB,KAED,IACHoH,EACH,OAGKA,CACR,CAEQ3B,oBACD,MAAA4B,EAAkBjlB,GAActE,QAAQqO,GAAWA,EAAO9J,OAASzG,KAAKyG,OAC9E,IAAIilB,EAAY,EAEZ,GAAAD,GAAmBA,EAAgBzX,OAAS,EAAG,CAClD,IAAI2X,EAAW,IAECF,EAAAhpB,SAAQ,CAAC8N,EAAQ0M,KAChC,IAAI2O,EAAgB,CAAC,EAAG,EAAG,GACvBC,EAAY,EAEhB9Q,MAAMuJ,KAAK/T,EAAO3J,QAAQojB,eAAevnB,SAASqpB,IACxC,KAALA,EAIUF,EAAAC,IAActL,SAASuL,GAHpCD,GAGqC,IAKvC,MAAME,EAAcH,EAAc9J,QAAO,CAACkK,EAAKF,EAAG7O,IAAM+O,EAAO9a,KAAK+a,IAAIjsB,KAAK4G,QAAQqW,IAAIiP,KAAON,EAAc3O,KAAK,GAG/G8O,EAAcJ,IACLD,EAAAzO,EACD0O,EAAAI,EACZ,GAEF,CACA,OAAON,EAAgBC,EACxB,CAEQtB,eACH,IAAAD,EAAYgC,EAAcpV,SAgBvB,OAfGoT,EAAAiC,MAAQ,IAAIrR,MAEjB/a,KAAA8H,KAAKrF,SAASqF,IACZ,MAAAukB,EAAOC,EAASvV,SACtBsV,EAAK3X,GAAK5M,EAAK4M,GACf,MAAM6X,EAAYvsB,KAAKyd,MAAM9I,IAAI6X,mBAAmB1kB,EAAK2kB,kBACpDJ,EAAAK,QAAUH,EACZA,EAAU7X,GACV,EACC5M,EAAK6kB,OACHN,EAAAM,KAAO,IAAI5R,MACXjT,EAAA6kB,KAAKlqB,SAASmqB,GAAYP,EAAKM,KAAKjR,KAAKkR,EAAQlY,OAE5CyV,EAAAiC,MAAM1Q,KAAK2Q,EAAI,IAEpBlC,CACR,EAMD,MAAMV,GAA2C,CAChDoD,OAAU,EACVC,SAAY,EACZC,MAAS,EACTC,QAAW,EACXC,SAAY,EACZC,YAAe,EACfC,KAAQ,EACRC,KAAQ,EACRC,WAAc,EACdC,YAAe,EACfC,YAAe,GACfC,WAAc,GACdC,WAAc,GACdC,SAAY,IAIPtkB,GAAkC,CACvC4jB,QAAW1oB,EAAKI,iBAChBipB,UAAarpB,EAAKU,oBAClBsoB,YAAehpB,EAAKY,sBACpB6nB,MAASzoB,EAAKM,eACdioB,OAAUvoB,EAAKQ,mBACfgoB,SAAYxoB,EAAKQ,mBACjB8oB,SAAYtpB,EAAKc,WACjByoB,aAAgBvpB,EAAKc,WACrB0oB,OAAUxpB,EAAKgB,SACfyoB,KAAQzpB,EAAKgB,SACb0oB,MAAS1pB,EAAKgB,SACd2oB,cAAiB3pB,EAAKkB,UACtB0oB,OAAU5pB,EAAKkB,UACf0nB,YAAe5oB,EAAKoB,uBACpBunB,SAAY3oB,EAAKsB,sBACjBuoB,OAAU7pB,EAAKwB,iBACfsoB,MAAS9pB,EAAK0B,gBACdunB,YAAejpB,EAAKgC,YACpBknB,WAAclpB,EAAKgC,YACnBmnB,WAAcnpB,EAAKgC,YACnB8mB,KAAQ9oB,EAAK4B,YACbinB,KAAQ7oB,EAAK4B,YACbmoB,SAAY/pB,EAAK4B,YACjBolB,QAAWhnB,EAAK4B,YAChBooB,UAAahqB,EAAK4B,YAClBmnB,WAAc/oB,EAAK8B,uBAIdokB,GAAuC,CAE5C+D,YAAe,UACfC,WAAc,cACdC,iBAAoB,uBACpBxD,iBAAoB,cACpByD,gBAAmB,cACnBC,kBAAqB,gBCl5Bf,MAAMC,WAAmBxX,EAW/B1X,YAAYC,EAAqB0X,GAChCtX,MAAMJ,EAAQ,oBALmCK,KAAA6uB,kBAAA,KACb7uB,KAAA8uB,4BAlBX,EAmBE9uB,KAAA+uB,gBAAA,EAI3B/uB,KAAKqX,UAAYA,EACZrX,KAAAJ,KAAOyX,EAAU1C,IAAI/U,KAEpB,MAAAovB,EAAanrB,SAASC,cAAc,OAC/BkrB,EAAA9uB,UAAUC,IAAI,uBACpBH,KAAAC,SAAS0C,YAAYqsB,GAC1BA,EAAWhuB,UAAY,8DAKvB,MAAMiuB,EAAmBjvB,KAAKC,SAASiB,uBAAuB,qBAAqB,GACnFlB,KAAKkvB,aAAelvB,KAAKJ,KAAKuvB,aAAa/sB,KAAI,CAAC+lB,EAAOlL,IAAM,IAAImS,GAAYH,EAAkB9G,EAAOlL,EAAGjd,QAEnG,MAAAqvB,EAAsBxrB,SAASC,cAAc,OAC/BurB,EAAAnvB,UAAUC,IAAI,qBAC7BH,KAAAC,SAAS0C,YAAY0sB,GAE1BrvB,KAAKsvB,gBAAkB,IAAIC,GAAgBF,EAAqBrvB,MAE3DA,KAAAC,SAASuvB,UAAqBnuB,IAOlCrB,KAAKyvB,iBAAgB,CAEvB,CAEAtM,oBACQ,OAAAnjB,KAAKJ,KAAK+U,IAAI+a,YACtB,CAEAC,kBACQ,OAAA3vB,KAAKJ,KAAK+U,IAAIib,UACtB,CAEAC,gBAAgBjb,GACR,OAAA5U,KAAKkvB,aAAahe,KAAKa,MAAM6C,EAAYsR,IAAiB4J,cAAclb,EAAYsR,EAC5F,CAEA6J,mBACC,MAAO,IAAI,IAAIhV,MAAM,IAAIC,QAAQ5Y,KAAI6a,GAAKjd,KAAK6vB,gBAAgB5S,IAChE,CAEA+S,cACC,OAAOhwB,KAAK+vB,mBACV7tB,QAAiBwa,GAAAA,EAAOva,kBAAkBsS,KAC1CrS,KAAcsa,GAAAA,EAAOva,QACxB,CAEA+mB,YAAYrnB,EAAkBouB,GAC7BxuB,EAAW2U,gBAAe,KACzBpW,KAAKgwB,cAAcvtB,SAAQoO,GAAW7Q,KAAK6vB,gBAAgBhf,EAAQiF,gBAAgBoa,UAAUruB,EAAS,KAAM,KAE3FouB,EAAAxtB,SAAwB0tB,IAExC,IADiB3f,GAAe9M,SAAe6M,EAAOE,WAAa0f,EAAazb,KAG/E,YADQ6K,QAAAoB,KAAK,wBAA0BwP,EAAazb,IAIrD,MAAM7D,EAAU,IAAI4D,GAAQ0b,EAAazb,GAAI1U,KAAKJ,KAAK+U,KAC/C9D,EAAAmG,UAAUnV,EAASsuB,GAC3BnwB,KAAK6vB,gBAAgBM,EAAavb,WAAWsb,UAAUruB,EAASgP,EAAS,KACzE,GAEH,CAEAuf,cAAcjuB,EAA+BkuB,EAAmBjM,GAO/D,GANApkB,KAAKyvB,kBAELzvB,KAAK6uB,kBAAoB1sB,EACzBnC,KAAK8uB,2BAA6BuB,EAClCrwB,KAAK+uB,gBAAkB3K,GAnGE,GAqGrBiM,EAAyB,CACPrwB,KAAK6vB,gBAAgBQ,GAC7BpwB,SAASC,UAAUC,IAAI,WACrC,CACD,CAEAsvB,kBACK,IA5GqB,GA4GrBzvB,KAAK8uB,2BAA0C,CAC7B9uB,KAAK6vB,gBAAgB7vB,KAAK8uB,4BAClC7uB,SAASC,UAAUid,OAAO,WACxC,CAEAnd,KAAK6uB,kBAAoB,KACzB7uB,KAAK8uB,4BAlHoB,EAmHzB9uB,KAAK+uB,gBAAkB,CACxB,EAGM,MAAMK,WAAoBhY,EAMhC1X,YAAYC,EAAqBwoB,EAAcP,EAAe1E,GAC7DnjB,MAAMJ,EAAQ,qBACdK,KAAKmoB,MAAQA,EACbnoB,KAAK4nB,MAAQA,EACb5nB,KAAKkjB,WAAaA,EAElBljB,KAAKC,SAASe,UAAY,2DAEV4mB,EAAQ,2PAUxB,MAAM5P,EAAmBhY,KAAKC,SAASiB,uBAAuB,qBAAqB,GACnFlB,KAAK8vB,cAAgB,IAAI/U,MAAMmL,GAAgBlL,QAAQ5Y,QAAS,IAAIkuB,GAAatY,EAAkBhY,KAAMid,KAEzG,MAAMsT,EAAgBvwB,KAAKC,SAASiB,uBAAuB,qBAAqB,GAC1EsvB,EAAqBxwB,KAAKC,SAASiB,uBAAuB,iCAAiC,GAEjGlB,KAAKkjB,WAAW7L,UAAUoZ,uBAAuB7uB,IAAG,KACnD,MAAM8uB,EAAc1wB,KAAKkjB,WAAW7L,UAAUsZ,iBACxCC,EAAgB5wB,KAAKkjB,WAAW7L,UAAUwZ,mBAE1CC,EAAWJ,GAAaK,UAAUC,YAAY9e,QAAQlS,KAAK4nB,OAAOqJ,IAAIC,KAAO,EAC7EC,EAAeP,GAAeG,UAAUC,YAAY9e,QAAQlS,KAAK4nB,OAAOqJ,IAAIC,KAAO,EAErF,GAAY,GAAZJ,GAAiC,GAAhBK,EAGpB,OAFAZ,EAAcnsB,YAAc,QAC5BosB,EAAmBpsB,YAAc,IAIpBmsB,EAAAnsB,YAAc0sB,EAASM,QAAQ,GAExCR,EAKeS,GAAAb,EAAoBW,EAAcL,EAAU,GAJ/DN,EAAmBpsB,YAAc,EAI+B,GAEnE,EAGM,MAAMksB,WAAqBlZ,EAmBjC1X,YAAYC,EAAqB2xB,EAA0B1J,GAC1D7nB,MAAMJ,EAAQ,sBACdK,KAAK4nB,MAAQA,EACR5nB,KAAA4U,UAAY0c,EAAY1J,MAAQ1B,EAAiB0B,EACtD5nB,KAAKmC,OAAS,KACdnC,KAAKsxB,YAAcA,EACnBtxB,KAAKkjB,WAAaoO,EAAYpO,WAE9BljB,KAAKsxB,YAAYnJ,MAAMxmB,kBAAkBC,IAAcC,IACtD,MAAM0vB,EAAYvxB,KAAKsxB,YAAYnJ,MAAM9B,UAAUrmB,KAAK4nB,OACpD2J,GAAavxB,KAAKmC,QAAyB,MAAbovB,GAAqBvxB,KAAKmC,kBAAkBsS,IACxEzU,KAAAkwB,UAAUruB,EAAS0vB,EAAW,EACpC,IAGDvxB,KAAKC,SAASe,UAAY,wlBAkB1BhB,KAAKwxB,UAAYxxB,KAAKC,SAASiB,uBAAuB,gBAAgB,GACtElB,KAAKyxB,SAAWzxB,KAAKC,SAASiB,uBAAuB,eAAe,GACpElB,KAAK0xB,SAAW1xB,KAAKC,SAASiB,uBAAuB,eAAe,GACpElB,KAAK2xB,YAAc3xB,KAAKC,SAASiB,uBAAuB,kBAAkB,GAC1ElB,KAAKuwB,cAAgBvwB,KAAKC,SAASiB,uBAAuB,sBAAsB,GAChFlB,KAAKwwB,mBAAqBxwB,KAAKC,SAASiB,uBAAuB,kCAAkC,GAE5FlB,KAAA0xB,SAAStwB,iBAAiB,SAAkBC,IAC5CrB,KAAKmC,kBAAkBwW,GACrB3Y,KAAAmC,OAAOyvB,QAAQnwB,EAAWC,cAAe1B,KAAK0xB,SAASttB,aAAe,GAC5E,IAIIpE,KAAA0xB,SAAStwB,iBAAiB,WAAoBC,IAElD,GAAqB,GAAjBA,EAAMwwB,SAAiC,IAAjBxwB,EAAMwwB,QAAe,CAC9CxwB,EAAMC,iBACA,MAAAwwB,EAAoB9xB,KAAKkjB,WAAW6M,mBAAmB7tB,QAAO6vB,GAAMA,EAAG5vB,kBAAkBwW,IACzFqZ,EAAcF,EAAkBzR,QAAQrgB,OAC3B,GAAfgyB,GAAqBF,EAAkB9d,OAASge,EAAc,EAC/CF,EAAAE,EAAc,GAAGN,SAASO,QAE5CjyB,KAAK0xB,SAASQ,MAEhB,CAGqB,IAAjB7wB,EAAMwwB,SACT7xB,KAAK0xB,SAASQ,OAIO,GAAjB7wB,EAAMwwB,SAAiC,IAAjBxwB,EAAMwwB,UAAmB7xB,KAAK0xB,SAASttB,aAAa4P,QAAU,IApBxE,IAqBhB3S,EAAMC,gBACP,IAGD,MAAM6wB,EAAY,UACbnyB,KAAA0xB,SAAStwB,iBAAiB,WAAoBC,IAC5C,MAAA+wB,EAAYC,OAAOC,eACzB,GAAIF,EAAW,CACR,MAAAG,EAAQ1uB,SAAS2uB,cACjBD,EAAAE,mBAAmBzyB,KAAK0xB,UAC9BU,EAAUM,kBACVN,EAAUO,SAASJ,EACpB,KAEIvyB,KAAA0xB,SAAStwB,iBAAiB,YAAqBC,IAC9CrB,KAAK0xB,SAASttB,cAClBpE,KAAK0xB,SAASttB,YAAc+tB,EACxBnyB,KAAKmC,kBAAkBwW,GAC1B3Y,KAAKmC,OAAOyvB,QAAQnwB,EAAWC,cAAeywB,GAEhD,IAGK,MAAAS,EAAY,CAACvxB,EAAkB+iB,KAChC,GAAe,MAAfpkB,KAAKmC,OAER,YADAd,EAAMC,iBAGPD,EAAMwxB,aAAcC,WAAa,OACjCzxB,EAAMwxB,aAAcE,cAAgB,MAE9B,MAAAC,EAAUhzB,KAAKyxB,SAASvtB,IACxB+uB,EAAY,IAAIC,MAGlB,GAFJD,EAAU/uB,IAAM8uB,EAChB3xB,EAAMwxB,aAAcM,aAAaF,EAAW,GAAI,IAC5CjzB,KAAKmC,kBAAkBwW,EAAQ,CAClC,IAAIya,EAAkBpzB,KAAKmC,OAAO0U,SAAQ,GAC1CxV,EAAMwxB,aAAcQ,QAAQ,aAAczU,KAAK0U,OAAOC,gBAAgBhN,EAAYiN,SAASJ,KAC5F,CACApzB,KAAKkjB,WAAWkN,cAAcpwB,KAAKmC,OAAQnC,KAAK4U,UAAWwP,EAAI,EAG3DpkB,KAAAwxB,UAAUiC,YAAuBpyB,IACrCuxB,EAAUvxB,EAAO,IAEbrB,KAAA2xB,YAAY8B,YAAuBpyB,IACvCuxB,EAAUvxB,EAAO,IAGlB,MAAMqyB,EAAW1zB,KAAKC,SAASiB,uBAAuB,eAAe,GACrEma,MAAMqY,EAAU,CACfpY,QAAW,eACXC,WAAa,IAELmY,EAAAD,YAAuBpyB,IAC/BuxB,EAAUvxB,EAAO,IAGlB,MAAMsyB,EAAa3zB,KAAKC,SAASiB,uBAAuB,iBAAiB,GACzEma,MAAMsY,EAAY,CACjBrY,QAAW,kBACXC,WAAa,IAEHoY,EAAAvyB,iBAAiB,SAAkBC,IAC7CrB,KAAKkwB,UAAUzuB,EAAWC,cAAe,KAAM,MAGhD,IAAIkyB,EAAmB,EAClB5zB,KAAAC,SAAS4zB,YAAuBxyB,IACpCA,EAAMC,iBACNsyB,IACK5zB,KAAAC,SAASC,UAAUC,IAAI,SAAQ,EAEhCH,KAAAC,SAAS6zB,YAAuBzyB,IACpCA,EAAMC,iBACNsyB,IACIA,GAAoB,GAClB5zB,KAAAC,SAASC,UAAUid,OAAO,SAChC,EAEInd,KAAAC,SAAS8zB,WAAsB1yB,IACnCA,EAAMC,gBAAe,EAEjBtB,KAAAC,SAAS+zB,OAAkB3yB,IAC/B,IAAI4yB,EAAW5yB,EAAMwxB,aAAc5U,QAAQ,cAE3C5c,EAAMC,iBACasyB,EAAA,EACd5zB,KAAAC,SAASC,UAAUid,OAAO,UAEzB,MAAAtb,EAAUJ,EAAWC,cAC3BD,EAAW2U,gBAAe,KACzB,GAAyC,MAArCpW,KAAKkjB,WAAW2L,mBAAgD,GAAnBoF,EAASjgB,OACzD,OAGD,GAAIhU,KAAKkjB,WAAW4L,4BAA8B9uB,KAAK4U,UAEtD,YADA5U,KAAKkjB,WAAWuM,kBAIX,MAAAyE,EAAWl0B,KAAKkjB,WAAW6L,gBAE7B,IA3WmB,GA2WnB/uB,KAAKkjB,WAAW4L,2BAA0C,CAC7D,MAAMqF,EAAmBn0B,KAAKkjB,WAAW2M,gBAAgB7vB,KAAKkjB,WAAW4L,4BACzE,GAAgB,GAAZoF,EAA2B,CAC9BC,EAAiBjE,UAAUruB,EAAS7B,KAAKmC,OAAQ+xB,GAC7C,IAAAE,EAASp0B,KAAKyxB,SAASvtB,IACtBlE,KAAAyxB,SAASvtB,IAAMiwB,EAAiB1C,SAASvtB,IAC9CiwB,EAAiB1C,SAASvtB,IAAMkwB,CAAA,MACV,GAAZF,IACLl0B,KAAAyxB,SAASvtB,IAAMiwB,EAAiB1C,SAASvtB,IAC7BiwB,EAAAjE,UAAUruB,EAAS,KAAMqyB,GAEjC,MAAA,GAAqC,MAArCl0B,KAAKkjB,WAAW2L,kBAA2B,CAE/C,MAAAwF,EAASC,KAAKL,GACdM,EAAQ,IAAIC,WAAWH,EAAOrgB,QACpC,IAAA,IAASiJ,EAAI,EAAGA,EAAIsX,EAAMvgB,OAAQiJ,IAC3BsX,EAAAtX,GAAKoX,EAAOI,WAAWxX,GAExB,MAAAhL,EAAcsU,EAAYmO,WAAWH,GAEvC,IAAAI,EAAc,IAAIhc,EAAO9E,EAAa5B,GAAcjS,KAAKkjB,WAAW7L,UAAU1C,KACtEggB,EAAA3d,UAAUnV,EAASoQ,GAC/BjS,KAAKkjB,WAAW2L,kBAAoB8F,CACrC,CAEgB,GAAZT,EACEl0B,KAAAkwB,UAAUruB,EAAS7B,KAAKkjB,WAAW2L,kBAAmBrrB,MAAM3B,GAAUqyB,GAE3El0B,KAAKkwB,UAAUruB,EAAS7B,KAAKkjB,WAAW2L,kBAAmBqF,GAGnC,IAArBl0B,KAAKyxB,SAASvtB,MACjBlE,KAAKyxB,SAASvtB,IAAMsC,GAActE,QAAiBqO,GAC3CA,EAAO9J,MAAQkuB,EAAYluB,OAChC,GAAG/F,SAGPV,KAAKkjB,WAAWuM,oBAChB,EAGF,MAAMmF,EAAW50B,KAAKC,SAASiB,uBAAuB,eAAe,GACrEma,MAAMuZ,EAAU,CACftZ,QAAW,OACXC,WAAa,IAELqZ,EAAAxzB,iBAAiB,SAAkBC,IACvCrB,KAAKmC,kBAAkBwW,GACtB,IAAAkc,GAAkB70B,KAAKmC,OAC5B,IAGDnC,KAAKkjB,WAAW7L,UAAUoZ,uBAAuB7uB,IAAG,KACnD,MAAM8uB,EAAc1wB,KAAKkjB,WAAW7L,UAAUsZ,iBACxCC,EAAgB5wB,KAAKkjB,WAAW7L,UAAUwZ,mBAE1CiE,EAAYpE,GAAaK,UAAUgE,iBAAiB,CAAE5yB,OAAQnC,KAAK4U,YAAasc,KAAO,EACvFC,EAAeP,GAAeG,UAAUgE,iBAAiB,CAAE5yB,OAAQnC,KAAK4U,YAAasc,KAAO,EAE9F,GAAa,GAAb4D,GAAkC,GAAhB3D,EAGrB,OAFAnxB,KAAKuwB,cAAcnsB,YAAc,QACjCpE,KAAKwwB,mBAAmBpsB,YAAc,IAIvCpE,KAAKuwB,cAAcnsB,YAAc0wB,EAAU1D,QAAQ,GAE9CR,EAKLS,GAAoBrxB,KAAKwwB,mBAAoBW,EAAc2D,EAAW,GAJrE90B,KAAKwwB,mBAAmBpsB,YAAc,EAIgC,IAGxEpE,KAAKiY,QACN,CAEAiY,UAAUruB,EAAkB0vB,EAAyC2C,GAChE3C,GAAavxB,KAAKmC,SAItBnC,KAAKuwB,cAAcnsB,YAAc,GACjCpE,KAAKwwB,mBAAmBpsB,YAAc,GAEtC3C,EAAW2U,gBAAe,KAEzB,GADApW,KAAKmC,OAASovB,EACVA,aAAqB9c,GACxBzU,KAAKsxB,YAAYnJ,MAAM+H,UAAUruB,EAAS7B,KAAK4nB,MAAO,MAC5C2J,EAAArb,aAAarU,EAAS7B,KAAK4U,gBAAS,GACpC2c,aAAqB5Y,GAG/B,GAFA3Y,KAAKsxB,YAAYnJ,MAAM+H,UAAUruB,EAAS7B,KAAK4nB,MAAO2J,GAEtC,GAAZ2C,EAA0B,CACzB,GAAA1N,EAAW+K,EAAU9qB,MAAO,CAC/B,MAAMkgB,EAAQ3mB,KAAKkjB,WAAWtjB,KAAKo1B,WAC7BC,EAAWtO,EAAMuB,WAAkBgN,GAAsD,MAAtDl1B,KAAKkjB,WAAWtjB,KAAKS,wBAAwB60B,MAClE,GAAhBD,EACCtO,EAAM3S,OAAS,GACbhU,KAAAkjB,WAAWtjB,KAAKu1B,SAAStzB,EAAS8kB,EAAMnkB,OAAO,CAAC+uB,EAAUluB,qBAG1DsjB,EAAAsO,GAAY1D,EAAUluB,iBAC5BrD,KAAKkjB,WAAWtjB,KAAKu1B,SAAStzB,EAAS8kB,GAEzC,CAGI4K,EAAU9qB,MAAQnC,EAAKI,iBAwPhC,SAAsC7C,EAAkBM,GACjD,MAAA2X,EAAa3X,EAAOyX,iBAC1BE,EAAWD,gBAAkBub,GAAcjzB,EAAO2T,gBAC3C3T,EAAA4X,eAAelY,EAASiY,EAChC,CA3PMub,CAA6BxzB,EAAS0vB,GAC5BA,EAAU9qB,MAAQnC,EAAK0B,iBA2PvC,SAA8BnE,EAAkBM,GACzC,MAAA2X,EAAa3X,EAAOyX,iBAC1BE,EAAWI,oBAAsBkb,GAAcjzB,EAAO2T,gBAC/C3T,EAAA4X,eAAelY,EAASiY,EAChC,CA9PMwb,CAAqBzzB,EAAS0vB,EAEhC,OAEAvxB,KAAKsxB,YAAYnJ,MAAM+H,UAAUruB,EAAS7B,KAAK4nB,MAAO2J,GACtDvxB,KAAKsxB,YAAYnJ,MAAMxmB,kBAAkBgU,KAAK9T,EAC/C,IAGD7B,KAAKiY,SACN,CAEQA,SACY,MAAfjY,KAAKmC,QACHnC,KAAAC,SAASC,UAAUC,IAAI,SACvBH,KAAAC,SAASC,UAAUid,OAAO,YAC1Bnd,KAAAC,SAAS8D,MAAMC,gBAAkB,QACjChE,KAAAwxB,UAAU+D,aAAa,YAAa,SACpCv1B,KAAA2xB,YAAY4D,aAAa,YAAa,SAC3Cv1B,KAAK0xB,SAASttB,YAAc,GACvBpE,KAAA0xB,SAAS8D,gBAAgB,oBACpBx1B,KAAKmC,kBAAkBsS,IAC5BzU,KAAAC,SAASC,UAAUid,OAAO,SAC1Bnd,KAAAC,SAASC,UAAUC,IAAI,YAC5BH,KAAKC,SAAS8D,MAAMC,gBAAkBiS,EAAYD,EAAYhW,KAAKmC,OAAOsE,OACrEzG,KAAAwxB,UAAU+D,aAAa,YAAa,QACpCv1B,KAAA2xB,YAAY4D,aAAa,YAAa,QACtCv1B,KAAA0xB,SAASttB,YAAcpE,KAAKmC,OAAOwO,KACnC3Q,KAAA0xB,SAAS8D,gBAAgB,mBAC9Bx1B,KAAKyxB,SAASvtB,IAAMlE,KAAKmC,OAAOoT,SAAS7U,UAEpCV,KAAAC,SAASC,UAAUid,OAAO,SAC1Bnd,KAAAC,SAASC,UAAUid,OAAO,YAC/Bnd,KAAKC,SAAS8D,MAAMC,gBAAkBhE,KAAKmC,OAAOI,gBAC7CvC,KAAAwxB,UAAU+D,aAAa,YAAa,QACpCv1B,KAAA2xB,YAAY4D,aAAa,YAAa,QAC3Cv1B,KAAK0xB,SAASttB,YAAcpE,KAAKmC,OAAOszB,UACnCz1B,KAAA0xB,SAAS6D,aAAa,kBAAmB,IAC9Cv1B,KAAKyxB,SAASvtB,IAAMlE,KAAKmC,OAAOE,oBAElC,EAGD,MAAMwyB,WAA0Bzd,EAC/B1X,YAAYyC,GACLpC,MAAA8D,SAASgb,KAAM,uBAErB7e,KAAKC,SAASyU,GAAK,oBACnB1U,KAAKC,SAASe,UAAY,0EAKtB,IAAA00B,GAAY11B,KAAKC,UAAU,KAC9B01B,EAAE,sBAAsBC,SAAS9X,QACjC9d,KAAKC,SAASkd,YAGf,MAAM0Y,EAAa71B,KAAKC,SAASiB,uBAAuB,iBAAiB,GAClCmD,GAAAlC,EAAOsE,MAAOovB,EAAY1zB,GAE/DwzB,EAAA,sBAAsBC,OAAO,CAC9BE,WAAY,sBACZC,QAAS,KACR/1B,KAAKC,SAASkd,WAGjB,EAGD,MAAMoS,WAAwBnY,EAG7B1X,YAAYC,EAAqBujB,GAChCnjB,MAAMJ,EAAQ,0BACdK,KAAKkjB,WAAaA,EAElBljB,KAAKC,SAASe,UAAY,gcAcF,IAAIg1B,EAA4Bh2B,KAAKC,SAASiB,uBAAuB,oBAAoB,GAAmBlB,KAAM,CACzImE,MAAO,UACP8xB,aAAc,6CACdpa,OAAQ,CACP,CAAElL,KAAM,WAAY7P,MAAOsG,EAAQI,UACnC,CAAEmJ,KAAM,QAAS7P,MAAOsG,EAAQM,QAEjCqR,aAAe2D,GAA4B1c,KAAKkjB,WAAWtjB,KAAK+U,IAAIuhB,qBACpE51B,SAAWoc,GAA4B1c,KAAKkjB,WAAWtjB,KAAK+U,IAAI+a,aAChExW,SAAU,CAACrX,EAAkB6a,EAAyBnZ,KACrDvD,KAAKkjB,WAAWtjB,KAAK+U,IAAIwhB,WAAWt0B,EAAS0B,EAAQ,IAIjC,IAAIyyB,EAA4Bh2B,KAAKC,SAASiB,uBAAuB,kBAAkB,GAAmBlB,KAAM,CACrImE,MAAO,QACP8xB,aAAc,8EACdpa,OAAQ,CACP,CAAElL,KAAM,IAAK7P,MAAO,IAOrBiY,aAAe2D,GAA4B1c,KAAKkjB,WAAWtjB,KAAK+U,IAAIyhB,mBACpE91B,SAAWoc,GAA4B1c,KAAKkjB,WAAWtjB,KAAK+U,IAAIib,WAChE1W,SAAU,CAACrX,EAAkB6a,EAAyBnZ,KACrDvD,KAAKkjB,WAAWtjB,KAAK+U,IAAI0hB,SAASx0B,EAAS0B,EAAQ,IAIrD,MAAM+yB,EAAmBt2B,KAAKC,SAASiB,uBAAuB,qBAAqB,GACrEq1B,GAAApuB,GAAO1F,SAAoB+zB,IACpC,GAAAA,GAAYruB,EAAMyL,aACrB,OAGK,MAAA6X,EAAkBjlB,GAActE,WAAiB8T,EAAYzF,EAAO9J,OAAS+vB,IAC/E,GAA0B,GAA1B/K,EAAgBzX,OACnB,OAGK,MAAAyiB,EAAwB5yB,SAASC,cAAc,OAC/B2yB,EAAAv2B,UAAUC,IAAI,2BACpCm2B,EAAiB3zB,YAAY8zB,GAC7BA,EAAsB1yB,MAAMC,gBAAkB0yB,GAAUzgB,EAAYugB,GAAoB,IAExE/K,EAAAhpB,SAA0BmnB,IACnC,MAAA+M,EAAa9yB,SAASC,cAAc,OAC/B6yB,EAAAz2B,UAAUC,IAAI,iBACzBs2B,EAAsB9zB,YAAYg0B,GAE5B,MAAAC,EAAiB/yB,SAASC,cAAc,OAC/B8yB,EAAA12B,UAAUC,IAAI,sBAC7Bw2B,EAAWh0B,YAAYi0B,GACvBA,EAAe1yB,IAAM0lB,EAAelpB,QACpC2a,MAAMub,EAAgB,CACrBtb,QAAWsO,EAAe3hB,QAC1BsT,WAAa,IAGHob,EAAApB,aAAa,YAAa,QAC1BoB,EAAAlD,YAAuBpyB,IAC3B,MAAAQ,EAAUJ,EAAWC,cAC3BD,EAAW2U,gBAAe,KACnB,MAAA6c,EAAY,IAAIC,MACtBD,EAAU/uB,IAAM0lB,EAAelpB,QAC/BW,EAAMwxB,aAAcM,aAAaF,EAAW,GAAI,IAC1C5xB,EAAAwxB,aAAcQ,QAAQ,aAAc,IAC1ChyB,EAAMwxB,aAAcC,WAAa,OAG3B,MAAAvB,EAAY,IAAI5Y,EAAOiR,EAAenjB,KAAMzG,KAAKkjB,WAAWtjB,KAAK+U,KACvE4c,EAAUsF,oBAAoBh1B,GAC9B0vB,EAAUuF,QAAQj1B,EAAS+nB,EAAeziB,oBAAoBnH,KAAKkjB,WAAWC,sBACpEoO,EAAAwF,YAAYl1B,EAAS+nB,EAAeljB,UAC9C6qB,EAAUyF,iBAAiBn1B,EAAS+nB,EAAehjB,QAAQojB,eAC3DuH,EAAU0F,UAAUp1B,EAAS+nB,EAAehjB,QAAQqjB,QAAUiN,GAAOngB,UAC3Dwa,EAAAxX,eAAelY,EAAS+nB,EAAe9iB,aACvCyqB,EAAA4F,YAAYt1B,EAAS+nB,EAAe5iB,UACpCuqB,EAAAK,QAAQ/vB,EAAS+nB,EAAe1iB,aAC1CqqB,EAAU6F,eAAev1B,EAAS+nB,EAAe7hB,eAAesvB,aAAeC,GAAWC,aAC1FhG,EAAUiG,eAAe31B,EAAS+nB,EAAe7hB,eAAe0vB,aAAeH,GAAWI,eAC1FnG,EAAUoG,sBAAsB91B,EAAS+nB,EAAe7hB,eAAe6vB,oBAAsB,GAG7F53B,KAAKkjB,WAAWtjB,KAAK+U,IAAIkjB,cAAc7Y,MAAK,KACjCuS,EAAAuG,QACTj2B,EACA7B,KAAKkjB,WAAWtjB,KAAK+U,IAAIojB,oBACxBnO,EAAehiB,YAAY5H,KAAKkjB,WAAWC,qBAAqBnjB,KAAKkjB,WAAWyM,oBAAkB,IAGrG3vB,KAAKkjB,WAAWkN,cAAcmB,GAppBT,EAopBgC,EAAY,GACjE,CAAA,GAEF,IAGF,MAAMyG,EAAkBh4B,KAAKC,SAASiB,uBAAuB,qBAAqB,GAClFma,MAAM2c,EAAiB,CACtB1c,QAAW,uPACXC,WAAa,IAGd,MAAM0c,EAAoBj4B,KAAKC,SAASiB,uBAAuB,uBAAuB,GACxEq1B,GAAApuB,GAAO1F,SAAoB+zB,IACpC,GAAAA,GAAYruB,EAAMyL,aACrB,OAGD,MAAMskB,EAAmB1nB,GACvBtO,QAAO2O,GAAWmF,EAAYnF,EAAQpK,OAAS+vB,IAC/Ct0B,QAAkB2O,IAACA,EAAQH,aACzB,GAA2B,GAA3BwnB,EAAiBlkB,OACpB,OAGK,MAAAyiB,EAAwB5yB,SAASC,cAAc,OAC/B2yB,EAAAv2B,UAAUC,IAAI,2BACpC83B,EAAkBt1B,YAAY8zB,GAC9BA,EAAsB1yB,MAAMC,gBAAkB0yB,GAAUzgB,EAAYugB,GAAoB,IAEvE0B,EAAAz1B,SAA2B01B,IACrC,MAAAxB,EAAa9yB,SAASC,cAAc,OAC/B6yB,EAAAz2B,UAAUC,IAAI,iBACdw2B,EAAAz2B,UAAUC,IAAI,0BACzBs2B,EAAsB9zB,YAAYg0B,GAE5B,MAAAC,EAAiB/yB,SAASC,cAAc,OAC/B8yB,EAAA12B,UAAUC,IAAI,sBAC7Bw2B,EAAWh0B,YAAYi0B,GACvBA,EAAe1yB,IAAMi0B,EAAgBz3B,QACrC2a,MAAMub,EAAgB,CACrBtb,QAAW6c,EAAgBlwB,QAC3BsT,WAAa,IAGHob,EAAApB,aAAa,YAAa,QAC1BoB,EAAAlD,YAAuBpyB,IAC3B,MAAA4xB,EAAY,IAAIC,MACtBD,EAAU/uB,IAAMi0B,EAAgBz3B,QAChCW,EAAMwxB,aAAcM,aAAaF,EAAW,GAAI,IAC1C5xB,EAAAwxB,aAAcQ,QAAQ,aAAc,IAC1ChyB,EAAMwxB,aAAcC,WAAa,OAEjC9yB,KAAKkjB,WAAWkN,cAAc,IAAI3b,GAAQ0jB,EAAgB1nB,UAAWzQ,KAAKkjB,WAAW7L,UAAU1C,MAzsBzE,EAysB2F,EAAY,CAAA,GAE9H,GAEH,ECruBM,MAAMyjB,WAAoBhhB,EAGhC1X,YAAY8E,EAAyB6S,GACpCtX,MAAMyE,EAAY,qBAClBxE,KAAKqX,UAAYA,EAEjBrX,KAAKC,SAASe,UAAY,8HAM1B,MAAMq3B,EAAiBr4B,KAAKC,SAASiB,uBAAuB,0BAA0B,GAChFtB,EAAOI,KAAKqX,UAAU1C,IAAI/U,KAEhC,IAAA,IAASqd,EAAI,EAAGA,EAlBA,EAkBeA,IAAK,CAC7B,MAAAxE,EAAM5U,SAASC,cAAc,OAC/B2U,EAAAvY,UAAUC,IAAI,mBAClBk4B,EAAe11B,YAAY8V,GAErB,MAAAC,EAAa7U,SAASC,cAAc,QAC1C4U,EAAWtU,YAAmB,GAAL6Y,EAAS,YAAc,QAAQA,EAAI,IACjDvE,EAAAxY,UAAUC,IAAI,qBACzBsY,EAAI9V,YAAY+V,GAEV,MAAAE,EAAQ/U,SAASC,cAAc,QAC/B8U,EAAA1Y,UAAUC,IAAI,KAAM,kBAC1BsY,EAAI9V,YAAYiW,GAEhB,MAAM0f,EAAYrb,EACW,IAAAzd,GAAuBiZ,EAAK7Y,EAAMA,EAAM,CACpEkZ,gBAAiB,CAChB,eAEDlY,cAAe,aACfe,kBAAmB/B,EAAK+B,kBAExBoX,aAAenZ,GAAeA,EAAK24B,mBACnCj4B,SAAWV,GAAeA,EAAKo1B,WAAWsD,IAAch1B,IACxD4V,SAAU,CAACrX,EAAkBjC,EAAY2D,KAClC,MAAAojB,EAAQ/mB,EAAKo1B,WACnB,IAAA,IAAS/X,EAAI,EAAGA,EAAIqb,EAAWrb,IACzB0J,EAAM1J,IACJ0J,EAAAjL,KAAKpY,KAGbqjB,EAAM2R,GAAa/0B,EACdi1B,EAAArD,SAAStzB,EAAS8kB,EAAK,GAG/B,CACD,EC/BD,MAAM8R,GAAkC,GCpC7B,IDwCJ,cAAwBC,EAc9Bh5B,YAAY8E,EAAyB1E,GAC9BC,MAAAyE,EAAY,IAAIm0B,EAAO,CAC5BlyB,KAAM,KACNmyB,aAAwDC,EAAaC,WACrEC,aAAcj5B,EAAOi5B,aAAe,IAAIv2B,OAAOi2B,MAhBjDz4B,KAAQg5B,sBAAsD,KAC9Dh5B,KAAOkjB,WAAgC,KACvCljB,KAAQi5B,gBAA0C,KAGzCj5B,KAAA2B,kBAAoB,IAAIF,EACxBzB,KAAAsV,cAAgB,IAAI7T,EAEpBzB,KAAAywB,uBAAyB,IAAIhvB,EAUhCzB,KAAAC,SAASC,UAAUC,IAAI,eAE5BH,KAAKF,OAASA,EACdE,KAAKk5B,cAAgB,KAEhBl5B,KAAA2U,IAAI/U,KAAK+B,kBAAkBC,OAAc5B,KAAK2B,kBAAkBgU,KAAK9T,KAC1E7B,KAAK2U,IAAIwkB,oBAAmBroB,GAAa9Q,KAAK4Q,gBAAgBE,KAE9D,CACC9Q,KAAK2B,kBACL3B,KAAK2U,IAAIW,eACR7S,SAAQiT,GAAWA,EAAQ9T,IAAcC,GAAA7B,KAAKsV,cAAcK,KAAK9T,OAEnE7B,KAAK2U,IAAIkjB,cAAc7Y,MAAK,IAAMhf,KAAKo5B,iBAEvCp5B,KAAKq5B,uBACLr5B,KAAKs5B,sBACLt5B,KAAKu5B,aACLv5B,KAAKw5B,iBACLx5B,KAAKy5B,wBACLz5B,KAAK05B,YAEL15B,KAAKsV,cAAc1T,IAAG,IAAM5B,KAAK25B,2BAClC,CAEQP,eACD,MAAAQ,EAAcn4B,EAAWC,cAC/BD,EAAW2U,gBAAe,KACzB,IAAIyjB,GAAiB,EAErB,MAAMC,EAAgBzH,OAAO0H,aAAaC,QAAQh6B,KAAKi6B,yBACvD,GAAqB,MAAjBH,EACC,IACG,MAAAvkB,EAAWqI,EAAgBC,eAAeic,GAC3C95B,KAAAgX,UAAU4iB,EAAarkB,GACXskB,GAAA,CAGlB,OAFSK,GACA3a,QAAAoB,KAAK,mCAAqCuZ,EACnD,CAGIL,GACJ75B,KAAKm6B,cAAcP,GAIf55B,KAAAsV,cAAc1T,IAAcC,IAChC,MAAMu4B,EAAUxc,EAAgByc,aAAar6B,KAAK6W,WAClDwb,OAAO0H,aAAaO,QAAQt6B,KAAKi6B,wBAAyBG,EAAO,GACjE,GAEH,CAEQf,uBACFr5B,KAAAg5B,sBAAwBuB,GAAiBv6B,MACzCA,KAAAg5B,sBAAsB1jB,cAAc1T,IAAGC,GAAW7B,KAAKywB,uBAAuB9a,KAAK9T,IACzF,CAEQy3B,sBACFt5B,KAAAw6B,eHtGA,SAA0B/c,GAC1B,MAAAgd,EAAiB52B,SAASC,cAAc,OAC/B22B,EAAAv6B,UAAUC,IAAI,kBAAmB,qBAChDs6B,EAAez5B,UAAY,2QAK3B,MAAM05B,EAAWD,EAAev5B,uBAAuB,mBAAmB,GAC1Ema,MAAMqf,EAAU,CACfpf,QAAW,SACXC,WAAa,IAGd,MAAMof,EAAWF,EAAev5B,uBAAuB,iBAAiB,GAClE05B,EAAc,CAACz2B,EAAe02B,EAAuBC,KACpD,MAAAC,EAAWl3B,SAASC,cAAc,QAC/Bi3B,EAAA76B,UAAUC,IAAI,iBACvB46B,EAAS32B,YAAcD,EACd42B,EAAA35B,iBAAiB,QAAS05B,GACnCH,EAASh4B,YAAYo4B,EAAQ,EAMvB,OAHPH,EAAY,OAAQ,GAAO,IAAM,IAAIrd,GAAiBod,EAAUld,KAChEmd,EAAY,MAAO,GAAM,IAAM,IAAIvc,GAAgBsc,EAAUld,KAEtDgd,CACR,CG2EsBO,CAAiBh7B,OAChCA,KAAAw6B,eH1EA,SAA0B/c,GAC1B,MAAAwd,EAAiBp3B,SAASC,cAAc,OAC/Bm3B,EAAA/6B,UAAUC,IAAI,kBAAmB,qBAChD86B,EAAej6B,UAAY,2QAK3B,MAAM05B,EAAWO,EAAe/5B,uBAAuB,mBAAmB,GAC1Ema,MAAMqf,EAAU,CACfpf,QAAW,SACXC,WAAa,IAGd,MAAMof,EAAWM,EAAe/5B,uBAAuB,iBAAiB,GAWjE,MAVa,EAACiD,EAAe22B,KAC7B,MAAAC,EAAWl3B,SAASC,cAAc,QAC/Bi3B,EAAA76B,UAAUC,IAAI,iBACvB46B,EAAS32B,YAAcD,EACd42B,EAAA35B,iBAAiB,QAAS05B,GACnCH,EAASh4B,YAAYo4B,EAAQ,EAG9BH,CAAY,QAAQ,IAAM,IAAI7c,GAAiB4c,EAAUld,KAElDwd,CACR,CGgDsBC,CAAiBl7B,OAE/B,MAAAm7B,EAAet3B,SAASC,cAAc,QAC/Bq3B,EAAAj7B,UAAUC,IAAI,MAAO,UAClCkb,MAAM8f,EAAc,CACnB7f,QAAW,WACXC,WAAa,IAED4f,EAAA/5B,iBAAiB,SAAkBC,IAC3C,IAAA+5B,EAAap7B,KAAKC,SAAUD,KAAI,IAErCA,KAAKw6B,eAAeW,EACrB,CAEQ5B,aACFv5B,KAAAq7B,OAAO,OAAQ,WAAY,uKAS3Br7B,KAAAkjB,WAAa,IAAI0L,GAAW5uB,KAAKC,SAASiB,uBAAuB,eAAe,GAAmBlB,MAElG,MAAAs7B,EAAmB,IAAIC,EAAuCv7B,KAAKC,SAASiB,uBAAuB,uBAAuB,GAAmBlB,KAAM,CACxJmE,MAAO,OACPq3B,WAAYx7B,KAAKy7B,yBACjBxd,QAAU5G,GAAyBqkB,GAAU3kB,OAAO,CACnDnX,KAAMI,KAAK2U,IAAI/U,KAAKiX,UACpBoN,SAAUjkB,KAAKgwB,cAAc5tB,KAASoa,GAAAA,EAAE3F,YACxC+F,UAAW5c,KAAKi5B,gBAAiB7b,iBACjC6F,QAASjjB,KAAK2U,IAAI+a,aAClBiM,MAAO37B,KAAK2U,IAAIib,aAEjByD,QAAS,CAACxxB,EAAkBwV,EAAsBukB,KACjDn6B,EAAW2U,gBAAe,KACpBpW,KAAA2U,IAAI/U,KAAKoX,UAAUnV,EAAS+5B,EAAQh8B,MAAQokB,EAAUjN,UAC3D/W,KAAKkjB,WAAYgG,YAAYrnB,EAAS+5B,EAAQ3X,UAC9CjkB,KAAKi5B,gBAAiB5b,eAAexb,EAAS+5B,EAAQhf,WAAanC,EAAqB1D,UACpF6kB,EAAQ3Y,SAASjjB,KAAK2U,IAAIwhB,WAAWt0B,EAAS+5B,EAAQ3Y,SACtD2Y,EAAQD,OAAO37B,KAAK2U,IAAI0hB,SAASx0B,EAAS+5B,EAAQD,MAAK,GAC3D,EAEFE,eAAgB,CAAC77B,KAAKsV,cAAetV,KAAK2U,IAAIW,eAC9CvS,OAAQ,CAACwZ,EAAcC,IACfkf,GAAU34B,OAAOwZ,EAAGC,GAE5B4B,OAAS7B,GAAiBmf,GAAUtd,OAAO7B,GAC3Cuf,SAAWC,GAAaL,GAAUI,SAASC,KAE5C/7B,KAAK2U,IAAIkjB,cAAc7Y,MAAK,KAC3Bsc,EAAiBU,cAAa,GAEhC,CAEQxC,iBACFx5B,KAAAq7B,OAAO,WAAY,oBAAqB,miCA4B7C,MAAMY,EAAuBj8B,KAAKC,SAASiB,uBAAuB,0BAA0B,GAC5F,IAAIg7B,EAAgBD,EAAsBj8B,KAAK2U,IAAIyO,UAAW,CAC7D+Y,uBAAuB,GACrBn8B,MACG,MAAAo8B,EAAwB,IAAIb,EAA4Cv7B,KAAKC,SAASiB,uBAAuB,2BAA2B,GAAmBlB,KAAK2U,IAAIyO,UAAW,CACpLjf,MAAO,YACPq3B,WAAYx7B,KAAKq8B,8BACjBpe,QAAUmF,GAAyBkZ,GAAevlB,OAAO,CAAEqM,UAAWA,EAAUvM,YAChFwc,QAAS,CAACxxB,EAAkBuhB,EAAsBmZ,IAAiCnZ,EAAUpM,UAAUnV,EAAS06B,EAAanZ,WAC7HyY,eAAgB,CAAC77B,KAAK2U,IAAIyO,UAAU9N,eACpCvS,OAAQ,CAACwZ,EAAmBC,IAAsB8f,GAAev5B,OAAOwZ,EAAGC,GAC3E4B,OAAS7B,GAAsB+f,GAAele,OAAO7B,GACrDuf,SAAWC,GAAaO,GAAeR,SAASC,KAEjD/7B,KAAK2U,IAAIkjB,cAAc7Y,MAAK,KAC3Bod,EAAsBJ,cAAa,IAGpC,MAAMQ,EAAmBx8B,KAAKC,SAASiB,uBAAuB,qBAAqB,GACnFlB,KAAKi5B,gBAAkB,IAAI1e,GAAgBiiB,EAAkBx8B,MACxDA,KAAAi5B,gBAAgB3jB,cAAc1T,IAAGC,GAAW7B,KAAKsV,cAAcK,KAAK9T,KACzEwZ,MAAMmhB,EAAkB,CACvBlhB,QAASmhB,EACTlhB,WAAW,EACXmhB,UAAW,SAGc,IAAIvlB,GAAkBnX,KAAKC,SAASiB,uBAAuB,iCAAiC,GAAmBlB,MACrH,IAAIo4B,GAAYp4B,KAAKC,SAASiB,uBAAuB,2BAA2B,GAAmBlB,MAElFA,KAAAC,SAASiB,uBAAuB,yBAAyB,GAaxFlB,KAAAC,SAASiB,uBAAuB,yBAAyB,GAAoBE,iBAAiB,SAAkBC,IAC3F,MAAtBrB,KAAKk5B,eACRyD,YAAW,KACL38B,KAAAk5B,cAAgB,IAAI0D,MAAM,0BAAyB,GACtD,KAGJD,YAAW,KACV38B,KAAK25B,yBAAwB,GAC3B,IAAG,GAER,CAEQF,wBACFz5B,KAAAq7B,OAAO,mBAAoB,uBAAwB,8DAK5B,IAAAwB,EAAgB78B,KAAKC,SAASiB,uBAAuB,oBAAoB,GAAmBlB,KAAMA,KAAKg5B,sBACpI,CAEQU,YACF15B,KAAAq7B,OAAO,MAAO,UAAW,wDAKZ,IAAIyB,EAAU98B,KAAKC,SAASiB,uBAAuB,cAAc,GAAmBlB,KACvG,CAEQ25B,0BACH35B,KAAKk5B,cAGT7G,OAAO0K,cAAc,IAAIC,MAAM,UAChC,CAEQpsB,gBAAgBE,GAElB9Q,KAAAgwB,cAAcvtB,SAAmBoO,IACrC,MAAME,EAAaD,EAAUoB,QAAQrB,EAAQgF,iBAC7C,IAAK9E,EACJ,MAAM,IAAIyE,MAAM,mCAAqC3E,EAAQgF,iBAE9DhF,EAAQ0E,SAAS3E,gBAAgBC,EAASC,EAAWC,EAAU,IAIhE,MAAMgM,EAAc/c,KAAK8c,cAAc3U,EAAM4G,cACvCkuB,EAAuBj9B,KAAKi5B,gBAAiB7b,iBAClC/M,GAAA5N,SAAgBgE,IAC1B,MAAAy2B,EAAepsB,EAAUoB,QAC7B9P,KAAa+lB,GAAAA,EAAMhW,QAAQjQ,QAAOC,GAAUA,EAAOwR,OAASxL,EAAMyL,cAAgBC,EAAa1R,IAAWsE,MAC1G02B,OAEFF,EAAqBtgB,SAASla,SAAQ,CAAC26B,EAASngB,KAC3CA,GAAKF,IAILqgB,EAAQxgB,UAAUnW,IAASqV,EAAUK,gBACxC+gB,EAAaz6B,SAAQwP,GAAeA,EAAYjB,MAAOqsB,iBAAkB,IAC/DD,EAAQxgB,UAAUnW,IAASqV,EAAUM,gBAC/C8gB,EAAaz6B,SAAuBwP,GAAAA,EAAYjB,MAAOssB,gBAAkBlsB,EAAeiB,yBAC9E+qB,EAAQxgB,UAAUnW,IAASqV,EAAUO,iBAC/C6gB,EAAaz6B,SAAuBwP,GAAAA,EAAYjB,MAAOusB,iBAAmBnsB,EAAeiB,yBAC/E+qB,EAAQxgB,UAAUnW,IAASqV,EAAUQ,qBAC/C4gB,EAAaz6B,SAAQwP,GAAeA,EAAYjB,MAAOwsB,qBAAsB,IAC9E,GACA,GAEH,CAEA7M,iBACC,OAAI3wB,KAAKg5B,sBACDh5B,KAAKg5B,sBAAsBrI,iBAE3B,IAET,CAEAE,mBACC,OAAI7wB,KAAKg5B,sBACDh5B,KAAKg5B,sBAAsBnI,mBAE3B,IAET,CAEA/T,cAAc2gB,GACb,OAAOz9B,KAAK2U,IAAI/U,KAAKkd,cAAc2gB,GAChCz9B,KAAKgwB,cACL9tB,QAAkB2O,GAAAA,EAAQkF,YAAc0nB,IAAazpB,MACzD,CAEAgc,cACQ,OAAAhwB,KAAKkjB,WAAY8M,aACzB,CAEA9G,YAAYrnB,EAAkB67B,GACxB19B,KAAAkjB,WAAYgG,YAAYrnB,EAAS67B,EACvC,CAEAC,cAAc97B,GACb7B,KAAKkjB,WAAYgG,YAAYrnB,EAAS,GACvC,CAEA6X,wBACC,MAAMvH,EAAUnS,KAAK2U,IAAI/U,KAAKqC,aACxBgiB,EAAWjkB,KAAKgwB,cAEhB4N,EAA0DzrB,EAAQ0S,QAKjE,OAJEZ,EAAAxhB,SAAmBoO,IACR+sB,EAAA/sB,EAAQiF,gBAAkBjF,CAAA,IAGvC+sB,CACR,CAEAzD,cAAct4B,GACbJ,EAAW2U,gBAAe,KACzBpW,KAAK2U,IAAI/U,KAAKoX,UAAUnV,EAASmiB,EAAUjN,UACtC/W,KAAA2U,IAAIyO,UAAU+W,cAAct4B,GACjC7B,KAAK2U,IAAIwlB,cAAct4B,GAAS,GAAM,GACjC7B,KAAA2U,IAAIkpB,qBAAqBh8B,GAAS,EAAI,GAE7C,CAEAgV,UACC,OAAO+G,EAAgB7G,OAAO,CAC7BxB,SAAUvV,KAAK2U,IAAIkC,UACnBjX,KAAMI,KAAK2U,IAAI/U,KAAKiX,SAAQ,GAC5BoN,SAAUjkB,KAAKgwB,cAAc5tB,KAASoa,GAAAA,EAAE3F,YACxC+F,UAAW5c,KAAKi5B,gBAAiB7b,iBACjCgG,UAAWpjB,KAAK2U,IAAIyO,UAAUvM,WAEhC,CAEAinB,SACO,MAAA7mB,EAAQjX,KAAK6W,UAEnBI,EAAM1B,cAAW,EAEX,MAAAwoB,EAAangB,EAAgB4V,SAASvc,GACtC+mB,EAAWC,KAAKC,QAAQH,EAAY,CAAEI,GAAI,WAC1CC,EAAUxf,KAAK0U,OAAOC,gBAAgByK,IAEtCK,EAAU,IAAIC,IAAIjM,OAAOkM,SAASC,MAExC,OADAH,EAAQI,KAAOL,EACRC,EAAQ3d,UAChB,CAEA1J,UAAUnV,EAAkB0T,GAC3B9T,EAAW2U,gBAAe,KACrBb,EAASA,UACZvV,KAAK2U,IAAIqC,UAAUnV,EAAS0T,EAASA,UAEjCvV,KAAA2U,IAAI/U,KAAKoX,UAAUnV,EAAS0T,EAAS3V,MAAQokB,EAAUjN,UACvD/W,KAAA2U,IAAIyO,UAAUpM,UAAUnV,EAAS0T,EAAS6N,WAAaC,EAAetM,UAC3E/W,KAAKkjB,WAAYgG,YAAYrnB,EAAS0T,EAAS0O,UAC/CjkB,KAAKi5B,gBAAiB5b,eAAexb,EAAS0T,EAASqH,WAAanC,EAAqB1D,SAAQ,GAEnG,CAEAqK,UAAUvf,GACJ7B,KAAA2U,IAAI/U,KAAK8+B,MAAM78B,GACpB7B,KAAK29B,cAAc97B,EACpB,CAGA88B,cAAcC,GACb,MAAO,iBAAmBA,CAC3B,CAEAnD,yBACQ,OAAAz7B,KAAK2+B,cAAc,gBAC3B,GC1awB96B,SAASgb,KAAM,CAAE"}